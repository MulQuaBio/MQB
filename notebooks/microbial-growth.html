
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Microbial Growth rates in R &#8212; MulQuaBio</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=01a0bdc2" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/microbial-growth';</script>
    <script src="https://cdn.jsdelivr.net/npm/@iframe-resizer/child@latest"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Model Fitting using Maximum Likelihood" href="mle.html" />
    <link rel="prev" title="Nonlinear least squares (NLLS) in Python" href="nlls-python.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="MulQuaBio - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="MulQuaBio - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to The Multilingual Quantitative Biologist!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Computing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../part-computing.html">Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="unix.html">UNIX and Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="shell-scripting.html">Shell scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="git.html">Version control with Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="latex.html">Scientific documents with <span class="math notranslate nohighlight">\(\LaTeX\)</span></a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="python.html">Biological Computing in Python</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="object-oriented-programming.html">Object-Oriented Programming</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="r.html">Biological Computing in R</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Basic Data Analyses and Statistics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../part-basic-stats.html">Basic Data Analyses and Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-r.html">Data Management and Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="exp-design.html">Experimental design and Data exploration</a></li>
<li class="toctree-l1"><a class="reference internal" href="t-f-tests.html">Basic hypothesis testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="regress.html">Linear Models: regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="anova.html">Linear Models: Analysis of variance</a></li>
<li class="toctree-l1"><a class="reference internal" href="mul-expl.html">Linear Models: Multiple explanatory variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="mul-expl-inter.html">Linear Models: Multiple variables with interactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="model-simp.html">Model simplification</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Advanced Modelling &amp; Statistics Pre-work</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../part-prework.html">Advanced Modelling &amp; Statistics Pre-work</a></li>
<li class="toctree-l1"><a class="reference internal" href="mqb-prework-exercises.html">EnE Modelling and Advanced Data Science Pre-work</a></li>







</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Ecological &amp; Evolutionary Modelling</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../part-eemodelling.html">Ecological &amp; Evolutionary Modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="metabolic-basis.html">The Metabolic Basis of Ecology and Evolutionary dynamics</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="populations.html">Single Populations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="populations-practicals.html">Populations: Practicals</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="interactions.html">Species interactions</a></li>


<li class="toctree-l1 has-children"><a class="reference internal" href="competitive-dynamics.html">Competitive dynamics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="competitive-dynamics-practicals.html">Competitive Dynamics: Practicals</a></li>




</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="predator-prey.html">Predator–prey dynamics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="predator-prey-practicals.html">Predator–prey dynamics: Practicals</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="epidemiology.html">Epidemiological dynamics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="epidemiology-practicals.html">Epidemiological dynamics: Practicals</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Advanced Data Analyses and Statistics</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../part-advanced-stats.html">Advanced Data Analyses and Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="glms.html">Generalised Linear Models</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="nlls.html">Model Fitting using Non-linear Least-squares</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="nlls-python.html">Nonlinear least squares (NLLS) in Python</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Microbial Growth rates in R</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="mle.html">Model Fitting using Maximum Likelihood</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Assignments and Assessments</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../part-assignments.html">Assignments and Assessments</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix-assessment.html">MQB Coursework Assessment</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix-mini-proj.html">The Computing Miniproject</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../part-appendices.html">Appendices</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../appendices/tooling.html">Tooling and Environments</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="appendix-jupy-intro.html">Introduction to Jupyter</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendix-databases.html">Databases <span class="tocSkip"></span></a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../appendices/data-python.html">Data Analysis in Python (Optional)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="appendix-data-python.html">Data analyses  with Python &amp; Jupyter</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../appendices/maths.html">Maths and Quantitative Foundations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="appendix-maths.html">Mathematical models in Jupyter</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendix-mathsforbiologists/maths-for-biologists.html">Maths for Biologists</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../appendices/performance.html">Performance, Scaling, and Compute</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="appendix-high-performance-computing.html">Introduction to High-Performance Computing (HPC)</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">References</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../references.html">References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/MulQuaBio/MQB/master?urlpath=lab/tree/notebooks/microbial-growth.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/MulQuaBio/MQB/blob/master/notebooks/microbial-growth.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/MulQuaBio/MQB" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/MulQuaBio/MQB/issues/new?title=Issue%20on%20page%20%2Fnotebooks/microbial-growth.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/microbial-growth.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Microbial Growth rates in R</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">Prerequisites</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-linear-approaches">Basic linear approaches</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rolling-regression">rolling regression</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nls-model-fitting">nls model fitting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#alternative-starting-parameters">Alternative starting parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#doubling-time">Doubling Time</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">references</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="microbial-growth-rates-in-r">
<h1>Microbial Growth rates in R<a class="headerlink" href="#microbial-growth-rates-in-r" title="Link to this heading">#</a></h1>
<p>There are various ways to estimate microbial population growth rates from different types of abundance data. Here we will take a look at some different approaches, from applying linear models to the exponential phase, through to fitting non-linear models to the full growth curve.</p>
<p>We’re going to use various r packages: ggplot for nice figures, minpack.lm for levenberg marquardt nls fitting, zoo and dplyr for useful functions to perform a rolling regression (you’ll see later), and finally <a class="reference external" href="https://github.com/padpadpadpad/nls.multstart">nls.multstart</a> for an alternative to estimating nls starting parameters.</p>
<section id="learning-goals">
<h2>Learning goals<a class="headerlink" href="#learning-goals" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Fit microbial growth curves using linear and nonlinear approaches</p></li>
<li><p>Estimate key growth parameters (lag, maximum growth rate, carrying capacity)</p></li>
<li><p>Compare alternative growth models using AIC and diagnostics</p></li>
<li><p>Compute and interpret doubling times from fitted models</p></li>
</ul>
</section>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>The NLLS chapter and comfort fitting models in R</p></li>
<li><p>R packages used in the notebook installed (e.g. ggplot2, minpack.lm, dplyr)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># If you run this locally and get &quot;there is no package called ...&quot;:</span>
<span class="c1"># install.packages(c(&quot;ggplot2&quot;, &quot;minpack.lm&quot;, &quot;zoo&quot;, &quot;dplyr&quot;, &quot;nls.multstart&quot;))</span>

<span class="nf">library</span><span class="p">(</span><span class="s">&quot;ggplot2&quot;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">&quot;minpack.lm&quot;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">&quot;zoo&quot;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">&quot;dplyr&quot;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">&quot;nls.multstart&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>First off, lets make an example dataset of microbial popultion growth by cell counts which produces a plausible looking sigmoidal growth curve</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">t</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">22</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
<span class="n">N</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">32500</span><span class="p">,</span><span class="w"> </span><span class="m">33000</span><span class="p">,</span><span class="w"> </span><span class="m">38000</span><span class="p">,</span><span class="w"> </span><span class="m">105000</span><span class="p">,</span><span class="w"> </span><span class="m">445000</span><span class="p">,</span><span class="w"> </span><span class="m">1430000</span><span class="p">,</span><span class="w"> </span><span class="m">3020000</span><span class="p">,</span><span class="w"> </span><span class="m">4720000</span><span class="p">,</span><span class="w"> </span><span class="m">5670000</span><span class="p">,</span><span class="w"> </span><span class="m">5870000</span><span class="p">,</span><span class="w"> </span><span class="m">5930000</span><span class="p">,</span><span class="w"> </span><span class="m">5940000</span><span class="p">)</span>

<span class="nf">set.seed</span><span class="p">(</span><span class="m">1234</span><span class="p">)</span><span class="w"> </span><span class="c1"># set seed to ensure you always get the same random sequence  </span>

<span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">Time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">rnorm</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">))</span><span class="w"> </span><span class="c1"># add some random error</span>

<span class="nf">head</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 6 × 2</caption>
<thead>
	<tr><th></th><th scope=col>Time</th><th scope=col>N</th></tr>
	<tr><th></th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td> 0</td><td>  32499.88</td></tr>
	<tr><th scope=row>2</th><td> 2</td><td>  33000.03</td></tr>
	<tr><th scope=row>3</th><td> 4</td><td>  38000.11</td></tr>
	<tr><th scope=row>4</th><td> 6</td><td> 104999.77</td></tr>
	<tr><th scope=row>5</th><td> 8</td><td> 445000.04</td></tr>
	<tr><th scope=row>6</th><td>10</td><td>1430000.05</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Now let’s plot these “data”:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">    </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Time (Hours)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Population size (cells)&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">theme_bw</span><span class="p">(</span><span class="n">base_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/4faa4ce60bdafe77a84f3bfa0a239533452ac58f055f26873b8a325822578f23.png"><img alt="../_images/4faa4ce60bdafe77a84f3bfa0a239533452ac58f055f26873b8a325822578f23.png" src="../_images/4faa4ce60bdafe77a84f3bfa0a239533452ac58f055f26873b8a325822578f23.png" style="width: 420px; height: 420px;" />
</a>
</div>
</div>
</section>
<section id="basic-linear-approaches">
<h2>Basic linear approaches<a class="headerlink" href="#basic-linear-approaches" title="Link to this heading">#</a></h2>
<p>OK, so how do we calculate the growth rate from these data?</p>
<p>The size of an exponentially growing population (<span class="math notranslate nohighlight">\(N\)</span>) at any given time (<span class="math notranslate nohighlight">\(t\)</span>) is given by:</p>
<p><span class="math notranslate nohighlight">\(
N(t) = N_0 \cdot e^{rt} ,
\)</span></p>
<p>where <span class="math notranslate nohighlight">\(N_0\)</span> is the initial population size and <span class="math notranslate nohighlight">\(r\)</span> is the growth rate. We can re-arrange this to give:</p>
<p><span class="math notranslate nohighlight">\(
r = \frac{\log(N(t)) - \log(N_0)}{t} ,
\)</span></p>
<p>i.e. in exponential growth at a constant rate, the growth rate can be simply calculated as the difference in the log of two population sizes, over time. We will log-transform the data and estimate by eye where growth looks to be exponential.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">$</span><span class="n">LogN</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">N</span><span class="p">)</span>
<span class="n">data</span><span class="o">$</span><span class="n">Log10N</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">log10</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="c1"># for later</span>

<span class="c1"># visualise</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LogN</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">    </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Time (Hours)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;log(cell number)&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">theme_bw</span><span class="p">(</span><span class="n">base_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/e37da2fc246c9eeb7db0670c718a83f3af43ce724c694da48f5db091205faa32.png"><img alt="../_images/e37da2fc246c9eeb7db0670c718a83f3af43ce724c694da48f5db091205faa32.png" src="../_images/e37da2fc246c9eeb7db0670c718a83f3af43ce724c694da48f5db091205faa32.png" style="width: 420px; height: 420px;" />
</a>
</div>
</div>
<p>By eye the logged data looks fairly linear between hours 4 and 10, so we’ll use that time-period to calculate the growth rate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">$</span><span class="n">Time</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">10</span><span class="p">,]</span><span class="o">$</span><span class="n">LogN</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">$</span><span class="n">Time</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">4</span><span class="p">,]</span><span class="o">$</span><span class="n">LogN</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="m">10-4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">0.604640124187932</div></div>
</div>
<p>So our first, most basic estimate of <span class="math notranslate nohighlight">\(r\)</span> is around 0.6.</p>
<p>But we can do better than this. To account for some error in measurement, we shouldn’t really take the data points directly, but fit a linear model through them instead, where the slope gives our growth rate. This is pretty much the “traditional” way to calculate microbial growth rates - draw a straight line through the linear part on log-transformed data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">lm_growth</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">LogN</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">$</span><span class="n">Time</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">Time</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">12</span><span class="p">,])</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">lm_growth</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
lm(formula = LogN ~ Time, data = data[data$Time &gt; 2 &amp; data$Time &lt; 
    12, ])

Residuals:
        3         4         5         6 
 0.072972 -0.143423  0.067930  0.002521 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  8.00684    0.20297   39.45 0.000642 ***
Time         0.61638    0.02762   22.32 0.002002 ** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1235 on 2 degrees of freedom
Multiple R-squared:  0.996,	Adjusted R-squared:  0.994 
F-statistic:   498 on 1 and 2 DF,  p-value: 0.002002
</pre></div>
</div>
</div>
</div>
<p>About the same <span class="math notranslate nohighlight">\(r \approx 0.62\)</span>.</p>
<p>But this is still not great, we only estimated the exponential phase by eye, we could do it better by iterating through different windows of points, comparing the slopes and finding which the highest is to give the maximum growth rate, <span class="math notranslate nohighlight">\(r_{max}\)</span>. This is called a rolling regression.</p>
</section>
<section id="rolling-regression">
<h2>rolling regression<a class="headerlink" href="#rolling-regression" title="Link to this heading">#</a></h2>
<p>I’m going to borrow the code from one of Dan Padfield’s github posts to do it: <a class="reference external" href="https://padpadpadpad.github.io/post/calculating-microbial-growth-rates-from-od-using-rolling-regression/">https://padpadpadpad.github.io/post/calculating-microbial-growth-rates-from-od-using-rolling-regression/</a>
This requires zoo::rollapplyr() and dplyr::do()</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># create the rolling regression function</span>
<span class="n">roll_regress</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span>
<span class="w">  </span><span class="n">temp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="w">  </span><span class="n">mod</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
<span class="w">  </span><span class="n">temp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">slope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">coef</span><span class="p">(</span><span class="n">mod</span><span class="p">)[[</span><span class="m">2</span><span class="p">]],</span>
<span class="w">                     </span><span class="n">slope_lwr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">confint</span><span class="p">(</span><span class="n">mod</span><span class="p">)[</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="p">][[</span><span class="m">1</span><span class="p">]],</span>
<span class="w">                     </span><span class="n">slope_upr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">confint</span><span class="p">(</span><span class="n">mod</span><span class="p">)[</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="p">][[</span><span class="m">2</span><span class="p">]],</span>
<span class="w">                     </span><span class="n">intercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">coef</span><span class="p">(</span><span class="n">mod</span><span class="p">)[[</span><span class="m">1</span><span class="p">]],</span>
<span class="w">                     </span><span class="n">rsq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span><span class="o">$</span><span class="n">r.squared</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span>
<span class="w">  </span><span class="kr">return</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># define window - here every ~8 hours (window of 4 points)</span>
<span class="n">num_points</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">4</span>

<span class="c1"># run rolling regression on LogN ~ Time</span>
<span class="n">models</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">do</span><span class="p">(</span><span class="nf">cbind</span><span class="p">(</span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">LogN</span><span class="p">,</span><span class="w"> </span><span class="n">Time</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">             </span><span class="n">zoo</span><span class="o">::</span><span class="nf">rollapplyr</span><span class="p">(</span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">num_points</span><span class="p">,</span><span class="w"> </span><span class="n">roll_regress</span><span class="p">,</span><span class="w"> </span><span class="n">by.column</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">align</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;center&#39;</span><span class="p">),</span>
<span class="w">           </span><span class="n">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">Time</span><span class="p">),</span>
<span class="w">           </span><span class="n">ln_od</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">LogN</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">rename_all</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">gsub</span><span class="p">,</span><span class="w"> </span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;model.&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">replacement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="p">)</span>

<span class="c1"># create predictions</span>
<span class="n">preds</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">models</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">slope</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">Time</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">do</span><span class="p">(</span><span class="nf">data.frame</span><span class="p">(</span><span class="n">time2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">Time</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">.</span><span class="o">$</span><span class="n">Time</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">4</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">left_join</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">models</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">slope</span><span class="o">*</span><span class="n">time2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">intercept</span><span class="p">)</span>

<span class="n">growth_rate</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">models</span><span class="p">,</span><span class="w"> </span><span class="n">slope</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">slope</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span>

<span class="c1"># plot rolling regression</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">LogN</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_line</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">preds</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time2</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pred</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Time</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;red&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme_bw</span><span class="p">(</span><span class="n">base_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">annotate</span><span class="p">(</span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;text&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">paste</span><span class="p">(</span><span class="s">&#39;r_max = &#39;</span><span class="p">,</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">growth_rate</span><span class="o">$</span><span class="n">slope</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="s">&#39; hr-1\n95%CI:(&#39;</span><span class="p">,</span><span class="nf">round</span><span class="p">(</span><span class="n">growth_rate</span><span class="o">$</span><span class="n">slope_lwr</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">growth_rate</span><span class="o">$</span><span class="n">slope_upr</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;)&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Time (hours)&quot;</span><span class="p">,</span>
<span class="w">       </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;log(cell number)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Joining with `by = join_by(Time)`
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/a5ceaefd63f021a36d7a89e525fa907044438df16b09ff2d681a537f6265ce28.png"><img alt="../_images/a5ceaefd63f021a36d7a89e525fa907044438df16b09ff2d681a537f6265ce28.png" src="../_images/a5ceaefd63f021a36d7a89e525fa907044438df16b09ff2d681a537f6265ce28.png" style="width: 420px; height: 420px;" />
</a>
</div>
</div>
<p>There we go, same answer as before, but we’ve done it iteratively to find the highest slope rather than estimate it by eye.</p>
<p>This is fine, but probably quite computationally intensive were we trying to do this for a large dataset of different growth curves. It would be better to just fit a single model to the full curve and pull out the growth rate that way.</p>
</section>
<section id="nls-model-fitting">
<h2>nls model fitting<a class="headerlink" href="#nls-model-fitting" title="Link to this heading">#</a></h2>
<p>One seemingly useful model would be the logistic growth equation where the growth rate slows as the population size nears carrying capacity (usually given as <span class="math notranslate nohighlight">\(K\)</span> in the ecological literature, but here we’ll use <span class="math notranslate nohighlight">\(N_{max}\)</span>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">logistic_model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">r_max</span><span class="p">,</span><span class="w"> </span><span class="n">N_max</span><span class="p">,</span><span class="w"> </span><span class="n">N_0</span><span class="p">){</span><span class="w"> </span><span class="c1"># The classic logistic equation</span>
<span class="w">  </span><span class="kr">return</span><span class="p">(</span><span class="n">N_0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">N_max</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">exp</span><span class="p">(</span><span class="n">r_max</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">N_max</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">N_0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nf">exp</span><span class="p">(</span><span class="n">r_max</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">)))</span>
<span class="p">}</span>

<span class="c1"># first we need some starting parameters for the model</span>
<span class="n">N_0_start</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="c1"># lowest population size</span>
<span class="n">N_max_start</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="c1"># highest population size</span>
<span class="n">r_max_start</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.62</span><span class="w"> </span><span class="c1"># use our linear estimate from before</span>

<span class="n">fit_logistic</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">nlsLM</span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">logistic_model</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">r_max</span><span class="p">,</span><span class="w"> </span><span class="n">N_max</span><span class="p">,</span><span class="w"> </span><span class="n">N_0</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="p">,</span>
<span class="w">                      </span><span class="nf">list</span><span class="p">(</span><span class="n">r_max</span><span class="o">=</span><span class="n">r_max_start</span><span class="p">,</span><span class="w"> </span><span class="n">N_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N_0_start</span><span class="p">,</span><span class="w"> </span><span class="n">N_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N_max_start</span><span class="p">))</span>

<span class="nf">summary</span><span class="p">(</span><span class="n">fit_logistic</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Formula: N ~ logistic_model(t = Time, r_max, N_max, N_0)

Parameters:
       Estimate Std. Error t value Pr(&gt;|t|)    
r_max 6.379e-01  1.444e-02  44.186 7.78e-12 ***
N_0   2.993e+03  5.051e+02   5.925 0.000222 ***
N_max 5.988e+06  2.935e+04 204.044  &lt; 2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 48220 on 9 degrees of freedom

Number of iterations to convergence: 11 
Achieved convergence tolerance: 1.49e-08
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot it:</span>
<span class="n">timepoints</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">22</span><span class="p">,</span><span class="w"> </span><span class="m">0.1</span><span class="p">)</span>

<span class="n">logistic_points</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">logistic_model</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">timepoints</span><span class="p">,</span><span class="w"> </span><span class="n">r_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">coef</span><span class="p">(</span><span class="n">fit_logistic</span><span class="p">)[</span><span class="s">&quot;r_max&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">N_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">coef</span><span class="p">(</span><span class="n">fit_logistic</span><span class="p">)[</span><span class="s">&quot;N_max&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">N_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">coef</span><span class="p">(</span><span class="n">fit_logistic</span><span class="p">)[</span><span class="s">&quot;N_0&quot;</span><span class="p">])</span>
<span class="n">df1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">timepoints</span><span class="p">,</span><span class="w"> </span><span class="n">logistic_points</span><span class="p">)</span>
<span class="n">df1</span><span class="o">$</span><span class="n">model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;Logistic&quot;</span>
<span class="nf">names</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Time&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;N&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;model&quot;</span><span class="p">)</span>

<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_line</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df1</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span><span class="p">),</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme_bw</span><span class="p">(</span><span class="n">base_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c1"># make the background white</span>
<span class="w">  </span><span class="nf">theme</span><span class="p">(</span><span class="n">aspect.ratio</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="c1"># make the plot square </span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Time&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Cell number&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning message:
“Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
<span class=" -Color -Color-Cyan">ℹ</span> Please use `linewidth` instead.”
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/db54a11e61ae3686be6a2553444e5b4b747aed2247fbe6907329d491022e7ad2.png"><img alt="../_images/db54a11e61ae3686be6a2553444e5b4b747aed2247fbe6907329d491022e7ad2.png" src="../_images/db54a11e61ae3686be6a2553444e5b4b747aed2247fbe6907329d491022e7ad2.png" style="width: 420px; height: 420px;" />
</a>
</div>
</div>
<p>That looks nice, and it gives us an <span class="math notranslate nohighlight">\(r_{max}\)</span> estimate fairly close to what we had before: 0.64. Note that we’ve done this fitting to the original non transformed data, whilst the linear regressions earlier were on log transformed data. What would this function look like on a log-transformed axis?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">head</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 6 × 4</caption>
<thead>
	<tr><th></th><th scope=col>Time</th><th scope=col>N</th><th scope=col>LogN</th><th scope=col>Log10N</th></tr>
	<tr><th></th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td> 0</td><td>  32499.88</td><td>10.38899</td><td>4.511882</td></tr>
	<tr><th scope=row>2</th><td> 2</td><td>  33000.03</td><td>10.40426</td><td>4.518514</td></tr>
	<tr><th scope=row>3</th><td> 4</td><td>  38000.11</td><td>10.54534</td><td>4.579785</td></tr>
	<tr><th scope=row>4</th><td> 6</td><td> 104999.77</td><td>11.56171</td><td>5.021188</td></tr>
	<tr><th scope=row>5</th><td> 8</td><td> 445000.04</td><td>13.00583</td><td>5.648360</td></tr>
	<tr><th scope=row>6</th><td>10</td><td>1430000.05</td><td>14.17319</td><td>6.155336</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">$</span><span class="n">LogN</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">N</span><span class="p">)</span><span class="w"> </span>
<span class="n">data</span><span class="o">$</span><span class="n">Log10N</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">log10</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LogN</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_line</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df1</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span><span class="p">),</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme_bw</span><span class="p">(</span><span class="n">base_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nf">theme</span><span class="p">(</span><span class="n">aspect.ratio</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Time&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;log(Cell number)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/95124e65151dedf7e151a0be44c500e587be6327acd4f517438188334396dd9a.png"><img alt="../_images/95124e65151dedf7e151a0be44c500e587be6327acd4f517438188334396dd9a.png" src="../_images/95124e65151dedf7e151a0be44c500e587be6327acd4f517438188334396dd9a.png" style="width: 420px; height: 420px;" />
</a>
</div>
</div>
<p>Aha, something weird happens at the lower end where our model diverges from the data. This is because the logistic model assumes that the population is growing from the start, however this is not true to reality for batch cultures of bacteria.</p>
<p>When bacteria are sub-cultured into fresh media, they take some time to acclimate to their new surroundings, activating genes involved in nutrient uptake and metabolic processes before beginning exponential growth. This is called the lag phase and can be seen in our example data where exponential growth doesn’t properly begin until around the 4th hour.</p>
<p>Various models have been devised to describe bacterial growth curves which include a lag phase before exponential growth begins. Here we will look at 3 - Gomertz, Baranyi and Buchanan. These all contain our three parameters from before (<span class="math notranslate nohighlight">\(N_0\)</span>, <span class="math notranslate nohighlight">\(N_{max}\)</span> and <span class="math notranslate nohighlight">\(r_{max}\)</span>) and introduce a new one which describes the length of the lag period - (<span class="math notranslate nohighlight">\(t_{lag}\)</span>).</p>
<p>The Buchanan model (or “three-phase logistic”; Buchanan, 1997) is very simplistic, based on the idea that you can get a decent estimate of bacterial growth from a simple straight line through the exponential phase on the logged data (similar to what we did earlier). It says that at <span class="math notranslate nohighlight">\(N_0\)</span> and <span class="math notranslate nohighlight">\(N_{max}\)</span>, growth rate is zero, and between those points, growth rate is constant and <span class="math notranslate nohighlight">\(r_{max}\)</span> is simply the slope of the line.</p>
<p>The Gompertz (using the log-transformed formulation of Zwietering, 1990) and Baranyi (Baranyi, 1993) models are mathematical functions describing the shape of the curve, where the maximum growth rate is estimated as the slope of the tangent to the inflection point of the curve.</p>
<p>First, specify the model functions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">gompertz_model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">r_max</span><span class="p">,</span><span class="w"> </span><span class="n">N_max</span><span class="p">,</span><span class="w"> </span><span class="n">N_0</span><span class="p">,</span><span class="w"> </span><span class="n">t_lag</span><span class="p">){</span><span class="w"> </span><span class="c1"># Modified gompertz growth model (Zwietering 1990)</span>
<span class="w">  </span><span class="kr">return</span><span class="p">(</span><span class="n">N_0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">N_max</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">N_0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="nf">exp</span><span class="p">(</span><span class="n">r_max</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">exp</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">t_lag</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">N_max</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">N_0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="m">10</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">)))</span>
<span class="p">}</span>

<span class="n">baranyi_model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">r_max</span><span class="p">,</span><span class="w"> </span><span class="n">N_max</span><span class="p">,</span><span class="w"> </span><span class="n">N_0</span><span class="p">,</span><span class="w"> </span><span class="n">t_lag</span><span class="p">){</span><span class="w">  </span><span class="c1"># Baranyi model (Baranyi 1993)</span>
<span class="w">  </span><span class="kr">return</span><span class="p">(</span><span class="n">N_max</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">log10</span><span class="p">((</span><span class="m">-1</span><span class="o">+</span><span class="nf">exp</span><span class="p">(</span><span class="n">r_max</span><span class="o">*</span><span class="n">t_lag</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">exp</span><span class="p">(</span><span class="n">r_max</span><span class="o">*</span><span class="n">t</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="nf">exp</span><span class="p">(</span><span class="n">r_max</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">exp</span><span class="p">(</span><span class="n">r_max</span><span class="o">*</span><span class="n">t_lag</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">10</span><span class="o">^</span><span class="p">(</span><span class="n">N_max</span><span class="o">-</span><span class="n">N_0</span><span class="p">))))</span>
<span class="p">}</span>

<span class="n">buchanan_model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">r_max</span><span class="p">,</span><span class="w"> </span><span class="n">N_max</span><span class="p">,</span><span class="w"> </span><span class="n">N_0</span><span class="p">,</span><span class="w"> </span><span class="n">t_lag</span><span class="p">){</span><span class="w"> </span><span class="c1"># Buchanan model - three phase logistic (Buchanan 1997)</span>
<span class="w">  </span><span class="kr">return</span><span class="p">(</span><span class="n">N_0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">t_lag</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="p">(</span><span class="n">t_lag</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">N_max</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">N_0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="m">10</span><span class="p">)</span><span class="o">/</span><span class="n">r_max</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r_max</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t_lag</span><span class="p">)</span><span class="o">/</span><span class="nf">log</span><span class="p">(</span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">t_lag</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">t_lag</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">N_max</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">N_0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="m">10</span><span class="p">)</span><span class="o">/</span><span class="n">r_max</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">N_max</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">N_0</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>For added complication, note that these are written in log to the base 10, which means that we must use data transformed to log base 10, not the natural log as we did earlier. These could also be written in the natural log too, in which case you would natural log transform the data to fit them.</p>
<p>Now let’s generate some starting values for the nlls fitting, using some functions to derive these values from the  actual data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Note that we&#39;re using Log10N now</span>
<span class="n">N_0_start</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Log10N</span><span class="p">)</span>
<span class="n">N_max_start</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Log10N</span><span class="p">)</span>
<span class="n">t_lag_start</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">Time</span><span class="p">[</span><span class="nf">which.max</span><span class="p">(</span><span class="nf">diff</span><span class="p">(</span><span class="nf">diff</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Log10N</span><span class="p">)))]</span>
<span class="n">r_max_start</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="nf">diff</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Log10N</span><span class="p">))</span><span class="o">/</span><span class="nf">mean</span><span class="p">(</span><span class="nf">diff</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Time</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Now fit the models:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">fit_gompertz</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">nlsLM</span><span class="p">(</span><span class="n">Log10N</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">gompertz_model</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">r_max</span><span class="p">,</span><span class="w"> </span><span class="n">N_max</span><span class="p">,</span><span class="w"> </span><span class="n">N_0</span><span class="p">,</span><span class="w"> </span><span class="n">t_lag</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="p">,</span>
<span class="w">                      </span><span class="nf">list</span><span class="p">(</span><span class="n">t_lag</span><span class="o">=</span><span class="n">t_lag_start</span><span class="p">,</span><span class="w"> </span><span class="n">r_max</span><span class="o">=</span><span class="n">r_max_start</span><span class="p">,</span><span class="w"> </span><span class="n">N_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N_0_start</span><span class="p">,</span><span class="w"> </span><span class="n">N_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N_max_start</span><span class="p">))</span>

<span class="n">fit_baranyi</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">nlsLM</span><span class="p">(</span><span class="n">Log10N</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">baranyi_model</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">r_max</span><span class="p">,</span><span class="w"> </span><span class="n">N_max</span><span class="p">,</span><span class="w"> </span><span class="n">N_0</span><span class="p">,</span><span class="w"> </span><span class="n">t_lag</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="p">,</span>
<span class="w">                     </span><span class="nf">list</span><span class="p">(</span><span class="n">t_lag</span><span class="o">=</span><span class="n">t_lag_start</span><span class="p">,</span><span class="w"> </span><span class="n">r_max</span><span class="o">=</span><span class="n">r_max_start</span><span class="p">,</span><span class="w"> </span><span class="n">N_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N_0_start</span><span class="p">,</span><span class="w"> </span><span class="n">N_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N_max_start</span><span class="p">))</span>

<span class="n">fit_buchanan</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">nlsLM</span><span class="p">(</span><span class="n">Log10N</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">buchanan_model</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">r_max</span><span class="p">,</span><span class="w"> </span><span class="n">N_max</span><span class="p">,</span><span class="w"> </span><span class="n">N_0</span><span class="p">,</span><span class="w"> </span><span class="n">t_lag</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="p">,</span>
<span class="w">                      </span><span class="nf">list</span><span class="p">(</span><span class="n">t_lag</span><span class="o">=</span><span class="n">t_lag_start</span><span class="p">,</span><span class="w"> </span><span class="n">r_max</span><span class="o">=</span><span class="n">r_max_start</span><span class="p">,</span><span class="w"> </span><span class="n">N_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N_0_start</span><span class="p">,</span><span class="w"> </span><span class="n">N_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N_max_start</span><span class="p">))</span>

<span class="nf">summary</span><span class="p">(</span><span class="n">fit_baranyi</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">fit_buchanan</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">fit_gompertz</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Formula: Log10N ~ baranyi_model(t = Time, r_max, N_max, N_0, t_lag)

Parameters:
      Estimate Std. Error t value Pr(&gt;|t|)    
t_lag  4.75157    0.26603   17.86 9.89e-08 ***
r_max  0.78662    0.04063   19.36 5.26e-08 ***
N_0    4.47239    0.03389  131.98 1.21e-14 ***
N_max  6.75633    0.02187  308.90  &lt; 2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.0461 on 8 degrees of freedom

Number of iterations to convergence: 9 
Achieved convergence tolerance: 1.49e-08
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Formula: Log10N ~ buchanan_model(t = Time, r_max, N_max, N_0, t_lag)

Parameters:
      Estimate Std. Error t value Pr(&gt;|t|)    
t_lag  3.69676    0.27026   13.68 7.86e-07 ***
r_max  0.56812    0.02251   25.24 6.51e-09 ***
N_0    4.51520    0.04372  103.27 8.63e-14 ***
N_max  6.74860    0.02765  244.05  &lt; 2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.06183 on 8 degrees of freedom

Number of iterations to convergence: 6 
Achieved convergence tolerance: 1.49e-08
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Formula: Log10N ~ gompertz_model(t = Time, r_max, N_max, N_0, t_lag)

Parameters:
      Estimate Std. Error t value Pr(&gt;|t|)    
t_lag 4.518857   0.080943   55.83 1.18e-11 ***
r_max 0.755878   0.013951   54.18 1.49e-11 ***
N_0   4.511152   0.011236  401.48  &lt; 2e-16 ***
N_max 6.799625   0.009583  709.57  &lt; 2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.01693 on 8 degrees of freedom

Number of iterations to convergence: 8 
Achieved convergence tolerance: 1.49e-08
</pre></div>
</div>
</div>
</div>
<p>We’re in and around the same ballpark figure for r_max again, though Baranyi and Gompertz estimate higher than Buchanan. Note that <span class="math notranslate nohighlight">\(N_0\)</span> and <span class="math notranslate nohighlight">\(N_{max}\)</span> are estimated based on our log transformation, so the true carrying capacity in terms of cell number would be <span class="math notranslate nohighlight">\(10^{N_{max}}\)</span> for instance.</p>
<p>Plot them all together to see how the fits look.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">timepoints</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">22</span><span class="p">,</span><span class="w"> </span><span class="m">0.1</span><span class="p">)</span>

<span class="n">baranyi_points</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">baranyi_model</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">timepoints</span><span class="p">,</span><span class="w"> </span><span class="n">r_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">coef</span><span class="p">(</span><span class="n">fit_baranyi</span><span class="p">)[</span><span class="s">&quot;r_max&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">N_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">coef</span><span class="p">(</span><span class="n">fit_baranyi</span><span class="p">)[</span><span class="s">&quot;N_max&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">N_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">coef</span><span class="p">(</span><span class="n">fit_baranyi</span><span class="p">)[</span><span class="s">&quot;N_0&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">t_lag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">coef</span><span class="p">(</span><span class="n">fit_baranyi</span><span class="p">)[</span><span class="s">&quot;t_lag&quot;</span><span class="p">])</span>

<span class="n">buchanan_points</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">buchanan_model</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">timepoints</span><span class="p">,</span><span class="w"> </span><span class="n">r_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">coef</span><span class="p">(</span><span class="n">fit_buchanan</span><span class="p">)[</span><span class="s">&quot;r_max&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">N_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">coef</span><span class="p">(</span><span class="n">fit_buchanan</span><span class="p">)[</span><span class="s">&quot;N_max&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">N_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">coef</span><span class="p">(</span><span class="n">fit_buchanan</span><span class="p">)[</span><span class="s">&quot;N_0&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">t_lag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">coef</span><span class="p">(</span><span class="n">fit_buchanan</span><span class="p">)[</span><span class="s">&quot;t_lag&quot;</span><span class="p">])</span>

<span class="n">gompertz_points</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">gompertz_model</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">timepoints</span><span class="p">,</span><span class="w"> </span><span class="n">r_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">coef</span><span class="p">(</span><span class="n">fit_gompertz</span><span class="p">)[</span><span class="s">&quot;r_max&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">N_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">coef</span><span class="p">(</span><span class="n">fit_gompertz</span><span class="p">)[</span><span class="s">&quot;N_max&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">N_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">coef</span><span class="p">(</span><span class="n">fit_gompertz</span><span class="p">)[</span><span class="s">&quot;N_0&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">t_lag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">coef</span><span class="p">(</span><span class="n">fit_gompertz</span><span class="p">)[</span><span class="s">&quot;t_lag&quot;</span><span class="p">])</span>

<span class="n">df2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">timepoints</span><span class="p">,</span><span class="w"> </span><span class="n">baranyi_points</span><span class="p">)</span>
<span class="n">df2</span><span class="o">$</span><span class="n">model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;Baranyi&quot;</span>
<span class="nf">names</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Time&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Log10N&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;model&quot;</span><span class="p">)</span>

<span class="n">df3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">timepoints</span><span class="p">,</span><span class="w"> </span><span class="n">buchanan_points</span><span class="p">)</span>
<span class="n">df3</span><span class="o">$</span><span class="n">model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;Buchanan&quot;</span>
<span class="nf">names</span><span class="p">(</span><span class="n">df3</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Time&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Log10N&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;model&quot;</span><span class="p">)</span>

<span class="n">df4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">timepoints</span><span class="p">,</span><span class="w"> </span><span class="n">gompertz_points</span><span class="p">)</span>
<span class="n">df4</span><span class="o">$</span><span class="n">model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;Gompertz&quot;</span>
<span class="nf">names</span><span class="p">(</span><span class="n">df4</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Time&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Log10N&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;model&quot;</span><span class="p">)</span>

<span class="n">model_frame</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rbind</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span><span class="w"> </span><span class="n">df3</span><span class="p">,</span><span class="w"> </span><span class="n">df4</span><span class="p">)</span>

<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Log10N</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_line</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model_frame</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Log10N</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span><span class="p">),</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme_bw</span><span class="p">(</span><span class="n">base_size</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nf">theme</span><span class="p">(</span><span class="n">aspect.ratio</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Time&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;log10(Cell number)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/465e95a56368437fd2b2141a5387f5d5e0aec2cd17a01f79b993ab09cd917c54.png"><img alt="../_images/465e95a56368437fd2b2141a5387f5d5e0aec2cd17a01f79b993ab09cd917c54.png" src="../_images/465e95a56368437fd2b2141a5387f5d5e0aec2cd17a01f79b993ab09cd917c54.png" style="width: 420px; height: 420px;" />
</a>
</div>
</div>
<p>So they look like they do a pretty nice job of fitting the full exponential growth curve, but we should use some model selection to choose the best one for our dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">AIC</span><span class="p">(</span><span class="n">fit_gompertz</span><span class="p">,</span><span class="w"> </span><span class="n">fit_baranyi</span><span class="p">,</span><span class="w"> </span><span class="n">fit_buchanan</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 3 × 2</caption>
<thead>
	<tr><th></th><th scope=col>df</th><th scope=col>AIC</th></tr>
	<tr><th></th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>fit_gompertz</th><td>5</td><td>-58.69545</td></tr>
	<tr><th scope=row>fit_baranyi</th><td>5</td><td>-34.65831</td></tr>
	<tr><th scope=row>fit_buchanan</th><td>5</td><td>-27.61096</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>So for these data, Gompertz seems to be the best fit (lowest AIC).</p>
<p>We could also check the confidence intervals on the parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">confint</span><span class="p">(</span><span class="n">fit_gompertz</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Waiting for profiling to be done...
</pre></div>
</div>
<div class="output text_html"><table class="dataframe">
<caption>A matrix: 4 × 2 of type dbl</caption>
<thead>
	<tr><th></th><th scope=col>2.5%</th><th scope=col>97.5%</th></tr>
</thead>
<tbody>
	<tr><th scope=row>t_lag</th><td>4.3332398</td><td>4.6991080</td></tr>
	<tr><th scope=row>r_max</th><td>0.7253675</td><td>0.7882898</td></tr>
	<tr><th scope=row>N_0</th><td>4.4851698</td><td>4.5367871</td></tr>
	<tr><th scope=row>N_max</th><td>6.7779349</td><td>6.8217828</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>So our <span class="math notranslate nohighlight">\(r_{max}\)</span> estimate from the best fitting model (Gompertz) is 0.76 with CIs 0.73-0.79. Job done.</p>
</section>
<section id="alternative-starting-parameters">
<h2>Alternative starting parameters<a class="headerlink" href="#alternative-starting-parameters" title="Link to this heading">#</a></h2>
<p>But this is just for our single curve, fitting these models to a whole database of different growth rate measurements can pose more problems. In particular, these nls models can be quite fussy about their paramater starting values and fail to converge if these are too far from reality. We implemented some functions to estimate the starting parameters, but these can fail to give decent estimations if there are some oddities in the data. One nice way of getting around this is using the nls.multstart package (from Dan Padfield again - <a class="github reference external" href="https://github.com/padpadpadpad/nls.multstart">padpadpadpad/nls.multstart</a>) which allows you to specify a general range of starting parameters which it iterates across. It attempts to fit with each set of starting parameters and then chooses the best model fit based on AIC scores. Lets use this on our Gompertz fitting code from before.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># fit gompertz model with multiple starting parameters</span>
<span class="n">fit_gompertz_multi</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">nls_multstart</span><span class="p">(</span><span class="n">Log10N</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">gompertz_model</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">r_max</span><span class="p">,</span><span class="w"> </span><span class="n">N_max</span><span class="p">,</span><span class="w"> </span><span class="n">N_0</span><span class="p">,</span><span class="w"> </span><span class="n">t_lag</span><span class="p">),</span>
<span class="w">                                    </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">start_lower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">t_lag</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">r_max</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">N_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">N_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">),</span>
<span class="w">                                    </span><span class="n">start_upper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">t_lag</span><span class="o">=</span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">r_max</span><span class="o">=</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">N_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">N_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">),</span>
<span class="w">                                    </span><span class="n">lower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">t_lag</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">r_max</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">N_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">N_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span>
<span class="w">                                    </span><span class="n">iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">500</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">supp_errors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Y&quot;</span><span class="p">)</span>

<span class="n">fit_gompertz_multi</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nonlinear regression model
  model: Log10N ~ gompertz_model(t = Time, r_max, N_max, N_0, t_lag)
   data: data
 r_max  N_max    N_0  t_lag 
0.7559 6.7996 4.5112 4.5189 
 residual sum-of-squares: 0.002294

Number of iterations to convergence: 16 
Achieved convergence tolerance: 1.49e-08
</pre></div>
</div>
</div>
</div>
<p>Good, that’s bang on what we got before. So if you see lots of “singular gradient matrix at initial parameter estimates” error messages when trying to do nls fitting, starting parameters are likely a problem and this package offers a way to easily get around that.</p>
</section>
<section id="doubling-time">
<h2>Doubling Time<a class="headerlink" href="#doubling-time" title="Link to this heading">#</a></h2>
<p>Just a side-note that sometimes doubling times (or generation times) are reported in the literature rather than growth rates, but it is simple to work back the growth rate from the doubling time. Similar to the exponential growth function earlier, the formula for the doubling of a population can be given by:</p>
<p><span class="math notranslate nohighlight">\(
N(t) = N_0 \cdot 2^{n} ,
\)</span></p>
<p>where <span class="math notranslate nohighlight">\(n\)</span> is the number of generations over the time period. The doubling time (the period of time for a population to double in size, <span class="math notranslate nohighlight">\(T_d\)</span>) is given by <span class="math notranslate nohighlight">\(T_d = t/n\)</span>, therefore:</p>
<p><span class="math notranslate nohighlight">\(
N(t) = N_0 \cdot 2^{t/T_d} .
\)</span></p>
<p>Taking the log of both sides we get:</p>
<p><span class="math notranslate nohighlight">\(
\log(N(t)) = \log(N_0) + \frac{t}{T_d} \cdot \log(2) .
\)</span></p>
<p>After some re-arrangement, we can find that:</p>
<p><span class="math notranslate nohighlight">\(
T_d \frac{\log(N(t)) - \log(N_0)}{t} = \log(2).
\)</span></p>
<p>If we remember from earlier than the specific growth rate, <span class="math notranslate nohighlight">\(r_{max}\)</span> (or sometimes, <span class="math notranslate nohighlight">\(\mu\)</span>) can be given by:</p>
<p><span class="math notranslate nohighlight">\(
r_{max} = \frac{\log(N(t)) - \log(N_0)}{t} ,
\)</span></p>
<p>then we can substitute this into our equation and with a little more rearranging find:</p>
<p><span class="math notranslate nohighlight">\(
T_d  = \frac{\log(2)}{r_{max}} .
\)</span></p>
<p>So it is simple to work back the growth rate from the doubling time, or vice-versa.</p>
</section>
<section id="references">
<h2>references<a class="headerlink" href="#references" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Zweitering, Jongenburger, rombouts and Van ‘T riet, “Modelling of the bacterial growth curve”, <em>Applied and Environmental Microbiology</em>, 1990.</p></li>
<li><p>Buchanan, Whiting and Damert, “When is simple good enough: a comparison of the Gompertz, Baranyi, and three-phase linear models for fitting bacterial growth curves”, <em>Food Microbiology</em>, 1997.</p></li>
<li><p>Baranyi, roberts and McClure, “A non-autonomous differential equation to model bacterial growth”, <em>Food Microbiology</em>, 1993.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            name: "ir",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="nlls-python.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Nonlinear least squares (NLLS) in Python</p>
      </div>
    </a>
    <a class="right-next"
       href="mle.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Model Fitting using Maximum Likelihood</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">Prerequisites</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-linear-approaches">Basic linear approaches</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rolling-regression">rolling regression</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nls-model-fitting">nls model fitting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#alternative-starting-parameters">Alternative starting parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#doubling-time">Doubling Time</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">references</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By MulQuaBio collective!
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>