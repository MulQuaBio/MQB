
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Time series analysis in R &#8212; MulQuaBio</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=01a0bdc2" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/experimental/time-series';</script>
    <script src="https://cdn.jsdelivr.net/npm/@iframe-resizer/child@latest"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="MulQuaBio - Home"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="MulQuaBio - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Welcome to The Multilingual Quantitative Biologist!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Computing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../part-computing.html">Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unix.html">UNIX and Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shell-scripting.html">Shell scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../git.html">Version control with Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="../latex.html">Scientific documents with <span class="math notranslate nohighlight">\(\LaTeX\)</span></a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../python.html">Biological Computing in Python</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../object-oriented-programming.html">Object-Oriented Programming</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../r.html">Biological Computing in R</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Basic Data Analyses and Statistics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../part-basic-stats.html">Basic Data Analyses and Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-r.html">Data Management and Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exp-design.html">Experimental design and Data exploration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../t-f-tests.html">Basic hypothesis testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../regress.html">Linear Models: regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../anova.html">Linear Models: Analysis of variance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mul-expl.html">Linear Models: Multiple explanatory variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mul-expl-inter.html">Linear Models: Multiple variables with interactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model-simp.html">Model simplification</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Advanced Modelling &amp; Statistics Pre-work</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../part-prework.html">Advanced Modelling &amp; Statistics Pre-work</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mqb-prework-exercises.html">EnE Modelling and Advanced Data Science Pre-work</a></li>







</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Ecological &amp; Evolutionary Modelling</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../part-eemodelling.html">Ecological &amp; Evolutionary Modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metabolic-basis.html">The Metabolic Basis of Ecology and Evolutionary dynamics</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../populations.html">Single Populations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../populations-practicals.html">Populations: Practicals</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../interactions.html">Species interactions</a></li>


<li class="toctree-l1 has-children"><a class="reference internal" href="../competitive-dynamics.html">Competitive dynamics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../competitive-dynamics-practicals.html">Competitive Dynamics: Practicals</a></li>




</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Advanced Data Analyses and Statistics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../part-advanced-stats.html">Advanced Data Analyses and Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glms.html">Generalised Linear Models</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../nlls.html">Model Fitting using Non-linear Least-squares</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../nlls-python.html">Nonlinear least squares (NLLS) in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../microbial-growth.html">Microbial Growth rates in R</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../mle.html">Model Fitting using Maximum Likelihood</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Assignments and Assessments</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../part-assignments.html">Assignments and Assessments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix-assessment.html">MQB Coursework Assessment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix-mini-proj.html">The Computing Miniproject</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../part-appendices.html">Appendices</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../appendices/tooling.html">Tooling and Environments</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../appendix-jupy-intro.html">Introduction to Jupyter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../appendix-databases.html">Databases <span class="tocSkip"></span></a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../appendices/data-python.html">Data Analysis in Python (Optional)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../appendix-data-python.html">Data analyses  with Python &amp; Jupyter</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../appendices/maths.html">Maths and Quantitative Foundations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../appendix-maths.html">Mathematical models in Jupyter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../appendix-mathsforbiologists/maths-for-biologists.html">Maths for Biologists</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../appendices/performance.html">Performance, Scaling, and Compute</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../appendix-high-performance-computing.html">Introduction to High-Performance Computing (HPC)</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">References</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../references.html">References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/MulQuaBio/MQB/master?urlpath=lab/tree/notebooks/experimental/time-series.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/MulQuaBio/MQB/blob/master/notebooks/experimental/time-series.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/MulQuaBio/MQB" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/MulQuaBio/MQB/issues/new?title=Issue%20on%20page%20%2Fnotebooks/experimental/time-series.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/notebooks/experimental/time-series.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Time series analysis in R</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-a-time-series">What is a time series?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-problem-with-time-series">The “problem” with time series</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#examples-of-time-series">Examples of time series</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-note-on-time-series">A note on time series</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-the-purpose-of-time-series-analysis">What is the purpose of time series analysis?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forecasting">Forecasting</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#smoothing-filtering-and-cleaning">Smoothing, filtering, and cleaning</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#trending-and-regression">Trending and regression</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-started-in-r">Getting started in R</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-tsibble">The <code class="docutils literal notranslate"><span class="pre">tsibble</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting">Plotting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dealing-with-missing-values">Dealing with missing values</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#seasonality-plots">Seasonality plots</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lag-plots">Lag plots</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#autocorrelation-plots">Autocorrelation plots</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#decomposition">Decomposition</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#trend">Trend</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#seasonality">Seasonality</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-noise-or-the-remainder-component">random noise (or the remainder component)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#challenge">Challenge</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#additive-decompositions">Additive decompositions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#multiplicative-decomposition">Multiplicative decomposition</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-decomposition">Advanced decomposition</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Forecasting</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mean">Mean</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#naive">Naive</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#seasonal-naive">Seasonal naive</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-trend">Linear trend</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#drift">Drift</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-forecasting-using-fable">Simple forecasting using <code class="docutils literal notranslate"><span class="pre">fable</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-forecasting-exercise">Simple forecasting exercise</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#forecasting-from-decomposition">Forecasting from decomposition</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transformations">Transformations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exponential-smoothing">Exponential smoothing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ets-parameters"><code class="docutils literal notranslate"><span class="pre">ETS()</span></code> parameters</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#error"><code class="docutils literal notranslate"><span class="pre">error()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2"><code class="docutils literal notranslate"><span class="pre">trend()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#season"><code class="docutils literal notranslate"><span class="pre">season()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#unstable-formulations">Unstable formulations</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-exponential-smoothing">Simple exponential smoothing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#holt-s-linear-trend-damped-trend-approaches">Holt’s linear trend &amp; Damped trend approaches</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#holt-winters-method">Holt-Winters’ method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#examples">Examples</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-note-on-periodicity">A note on periodicity</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#another-forecasting-exercise">Another forecasting exercise</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-statistics">Summary Statistics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basics">Basics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#autocovariance-and-autocorrelation">Autocovariance and Autocorrelation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cross-correlation">Cross-correlation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#decomposition-statistics">Decomposition statistics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#others">Others</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#autoregressive-and-arima-models">Autoregressive and ArIMA models</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#autoregression-ar">Autoregression (Ar)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#moving-averages-ma">Moving Averages (MA)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#differencing-i">Differencing (I)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#seasonal-differencing">Seasonal Differencing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#notation">Notation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sarima-models">SArIMA models</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-for-stationarity">Testing for stationarity</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-s-arima-models">Fitting (S)ArIMA models</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-s-arima-models-using-fable">Fitting (S)ArIMA models using <code class="docutils literal notranslate"><span class="pre">fable</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-time">Fitting time!</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#helpful-equivalents">Helpful equivalents</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#final-exercise">Final exercise</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#predictive-covariates">Predictive covariates</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-regression">Dynamic regression</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#time-series-checklist">Time Series Checklist</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sources">Sources</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="time-series-analysis-in-r">
<h1>Time series analysis in R<a class="headerlink" href="#time-series-analysis-in-r" title="Link to this heading">#</a></h1>
<div class="admonition-learning-goals admonition">
<p class="admonition-title">Learning goals</p>
<p><strong>By the end of this chapter you should be able to:</strong></p>
<ul class="simple">
<li><p>Recognise temporal autocorrelation and explain why it violates independence assumptions</p></li>
<li><p>Decompose time series into trend, seasonal, and irregular components</p></li>
<li><p>Compute and interpret autocorrelation functions (ACF) and partial ACF (PACF)</p></li>
<li><p>Fit basic time-series models (ARIMA, exponential smoothing) in R</p></li>
<li><p>Evaluate time-series model fit using residual diagnostics and information criteria</p></li>
<li><p>Generate short-term forecasts with prediction intervals and assess forecast accuracy</p></li>
<li><p>Critically evaluate time-series analyses and avoid common pitfalls (spurious correlation, overfitting)</p></li>
</ul>
</div>
<div class="tip admonition">
<p class="admonition-title">Prerequisites</p>
<p><strong>Before starting this chapter, you should:</strong></p>
<ul class="simple">
<li><p>Have covered regression fundamentals (residuals, model checking, interpretation) from <a class="reference internal" href="#../part-basic-stats"><span class="xref myst">Basic Data Analyses and Statistics</span></a></p></li>
<li><p>Have some experience working with date/time data in R (<code class="docutils literal notranslate"><span class="pre">lubridate</span></code> or base <code class="docutils literal notranslate"><span class="pre">Date</span></code> class)</p></li>
<li><p>Have some basic data wrangling with <code class="docutils literal notranslate"><span class="pre">dplyr</span></code> and plotting with <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code></p></li>
<li><p>know linear regression model basics and checking</p></li>
<li><p>be familiar with the idea of autocorrelation and seasonality</p></li>
<li><p>This notebook uses the <strong>tidy time series</strong> ecosystem: Install <code class="docutils literal notranslate"><span class="pre">tsibble</span></code>, <code class="docutils literal notranslate"><span class="pre">fable</span></code>, <code class="docutils literal notranslate"><span class="pre">feasts</span></code>. If you prefer a single meta-package, <code class="docutils literal notranslate"><span class="pre">fpp3</span></code> installs the tidy forecasting stack used in many textbooks. Also, in places, the classic <strong>forecast</strong> package.</p></li>
</ul>
</div>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>This chapter extends <strong>Advanced Data Analyses and Statistics</strong> to data where observations are <em>ordered in time</em> and therefore not independent.</p>
<p>Time is an indelible part of biology: living organisms and populations are constantly in a state of flux.</p>
<p>As biologists, we are often interested in characterising these changes over time, and predicting what will happen in the future - whether it be the levels of a particular molecule in a cell over several days or the number of organisms caught in a trap over several years.</p>
<p>A set of observations of a variable repeated over time points is typically called a “time series”, and there are specific methods (collectively called, you guessed it, “time series analysis”) that have been developed to characterise them. These methods are necessary because time series violate the basic assumptions underlying traditional statistical techniques like linear models.</p>
<p>This tutorial will introduce you to what time series are, what makes them so unique, and some of the standard methods used to analyse them.</p>
</section>
<section id="what-is-a-time-series">
<h2>What is a time series?<a class="headerlink" href="#what-is-a-time-series" title="Link to this heading">#</a></h2>
<p>In essence, a time series is any dataset where repeated observations are made over time at regular intervals.</p>
<p>Time has an arrow: it only moves forward, and—within a chosen frame of reference—it flows at a constant rate of one second per second (setting aside the small rate changes predicted by Einstein’s special relativity!).</p>
<p>Given this unidirectionality, we can say that effects at time <span class="math notranslate nohighlight">\(t\)</span> cannot be affected by conditions at time <span class="math notranslate nohighlight">\(t+1\)</span>. Events in a time series can only be <em>dependent</em> on conditions that have happened previously (or are happening “now”).</p>
<section id="the-problem-with-time-series">
<h3>The “problem” with time series<a class="headerlink" href="#the-problem-with-time-series" title="Link to this heading">#</a></h3>
<p>From a statistical perspective, the biggest problem with time series data is that time-dependent variables are not “independent and identically distributed (i.i.d.)”, a common requirement for classical statistical approaches.</p>
<p>This is because if one data point depends on a previous data point, it <em>cannot</em> be independent. As such, we require a different set of approaches that take this into account. Hence: <em>time series analysis</em>.</p>
</section>
<section id="examples-of-time-series">
<h3>Examples of time series<a class="headerlink" href="#examples-of-time-series" title="Link to this heading">#</a></h3>
<a class="reference internal image-reference" href="https://yanshuo.quarto.pub/nus-ts-book/01-intro_files/figure-html/fig-intro-globtemp-1.png"><img alt="https://yanshuo.quarto.pub/nus-ts-book/01-intro_files/figure-html/fig-intro-globtemp-1.png" src="https://yanshuo.quarto.pub/nus-ts-book/01-intro_files/figure-html/fig-intro-globtemp-1.png" style="width: 800px;" />
</a>
<p>Time series data appear across a wide range of different fields:</p>
<ul class="simple">
<li><p>Climate data in environmental science</p></li>
<li><p>Disease incidence in epidemiology</p></li>
<li><p>Population abundances in ecology</p></li>
<li><p>and many <em>many</em> more</p></li>
</ul>
</section>
<section id="a-note-on-time-series">
<h3>A note on time series<a class="headerlink" href="#a-note-on-time-series" title="Link to this heading">#</a></h3>
<p>Not all datasets with a time component are inherently time series, data with irregularly-spaced sampling points may not be suitable for time series analysis without further aggregation.</p>
</section>
</section>
<section id="what-is-the-purpose-of-time-series-analysis">
<h2>What is the purpose of time series analysis?<a class="headerlink" href="#what-is-the-purpose-of-time-series-analysis" title="Link to this heading">#</a></h2>
<p>Fundamentally, like with any data analysis, time series analysis looks to extract some sort signal from data. Some goals may be as follows:</p>
<section id="forecasting">
<h3>Forecasting<a class="headerlink" href="#forecasting" title="Link to this heading">#</a></h3>
<p>Sometimes you want to know what may happen next given a previous time series, this is called “forecasting”, a term you may be familiar with from meterology.</p>
<p>A weather forecast aims to predict weather patterns from previous data and the current conditions. If it was hot yesterday, it may well be hot today (or we may get a major rainstorm!)</p>
<p>Alternatively, epidemiologists may be interested in the progression of disease incidence in a population, and may be actively monitoring an outbreak. Time series analysis can be a useful tool in this process.</p>
</section>
<section id="smoothing-filtering-and-cleaning">
<h3>Smoothing, filtering, and cleaning<a class="headerlink" href="#smoothing-filtering-and-cleaning" title="Link to this heading">#</a></h3>
<p>Time series data are often noisy and hard to see direct signals within. Smoothing and filtering can be useful to extract the “signal” from the surrounding “noise”.</p>
</section>
<section id="trending-and-regression">
<h3>Trending and regression<a class="headerlink" href="#trending-and-regression" title="Link to this heading">#</a></h3>
<p>Often one may be interested in the relationship between different variables, accounting for the effect of time.</p>
<p>This is where time series regression can allow us to both consider how the dependent variable changes over time, and also elucidate the effect of any independent variables of interest.</p>
<p>For instance we may wish to understand the effect of urbanisation on the population dynamics of mosquitoes. Time series regression may allow us to seperate human effects from the typical seasonal cycles of mosquito population.</p>
</section>
</section>
<section id="getting-started-in-r">
<h2>Getting started in R<a class="headerlink" href="#getting-started-in-r" title="Link to this heading">#</a></h2>
<p>Before we go any further it is advisable to install the packages required for this workshop <code class="docutils literal notranslate"><span class="pre">fpp3</span></code>, <code class="docutils literal notranslate"><span class="pre">astsa</span></code>, <code class="docutils literal notranslate"><span class="pre">tidyverse</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">GGally</span></code>. <code class="docutils literal notranslate"><span class="pre">fp33</span></code> actually installs a bunch of other useful packages such as <code class="docutils literal notranslate"><span class="pre">tsibble</span></code>, <code class="docutils literal notranslate"><span class="pre">feasts</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">fable</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">install.packages</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="n">fpp3</span><span class="p">)</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="n">astsa</span><span class="p">)</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="n">GGally</span><span class="p">)</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="n">devtools</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>It will also be worthwhile installing the hub’s own <code class="docutils literal notranslate"><span class="pre">ohvbd</span></code> package:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">devtools</span><span class="o">::</span><span class="nf">install_github</span><span class="p">(</span><span class="s">&quot;fwimp/ohvbd&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">build_vignettes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TrUE</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>If you do not have much time, you can install the package without building the vignettes locally, using:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">devtools</span><span class="o">::</span><span class="nf">install_github</span><span class="p">(</span><span class="s">&quot;fwimp/ohvbd&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The documentation for ohvbd as a whole can be found <a class="reference external" href="https://fwimp.github.io/ohvbd/">here</a></p>
<p>Once you have installed these (it may take a while if you have not previously installed tidyverse in particular), it’s time to load the fpp3 and ohvbd packages:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">suppressWarnings</span><span class="p">(</span><span class="nf">suppressPackageStartupMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="n">fpp3</span><span class="p">)))</span>
<span class="nf">suppressWarnings</span><span class="p">(</span><span class="nf">suppressPackageStartupMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="n">ohvbd</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p>This loads a bunch of other packages such as some <code class="docutils literal notranslate"><span class="pre">tidyverse</span></code> packages, and a few others such as <code class="docutils literal notranslate"><span class="pre">tsibble</span></code> and <code class="docutils literal notranslate"><span class="pre">fable</span></code>.</p>
<p>These last two packages are time-series-specific packages that aid in the processing of time-series data.</p>
<p>If you are running on Linux (or potentially on MacOS), you will also need to run the following command to set up <code class="docutils literal notranslate"><span class="pre">ohvbd</span></code> to properly pull from some databases:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">set_ohvbd_compat</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">✔</span> Set compatibility mode = <span class=" -Color -Color-Blue">TrUE</span>
</pre></div>
</div>
</div>
</div>
<p>If you want to know what this does and why it is needed, feel free to ask me for details.</p>
<p>Now I just need to set up some internal things for this notebook. Ignore the following code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Just for prettier markdown here, you don&#39;t need to do this</span>
<span class="nf">options</span><span class="p">(</span><span class="n">repr.matrix.max.rows</span><span class="o">=</span><span class="m">10</span><span class="p">)</span>
<span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="n">repr.plot.height</span><span class="o">=</span><span class="m">10</span><span class="p">)</span>
<span class="nf">theme_set</span><span class="p">(</span><span class="nf">theme_gray</span><span class="p">(</span><span class="n">base_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">18</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<section id="the-tsibble">
<h3>The <code class="docutils literal notranslate"><span class="pre">tsibble</span></code><a class="headerlink" href="#the-tsibble" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">tsibble</span></code> is the time-series equivalent of a <code class="docutils literal notranslate"><span class="pre">tibble</span></code>, a common data structure for holding general tabular data. <code class="docutils literal notranslate"><span class="pre">tsibble</span></code> contains extra metadata to define the time series completely, a few of which are different from a standard <code class="docutils literal notranslate"><span class="pre">tibble</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">key</span></code> is a variable that uniquely defines a given sub-series within a full time series.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">index</span></code> defines the time point at which an individual measurement is taken. This should be a column that is already in some sort of time/date format.</p>
<p>So as a very simple example, imagine we have performed tick drags every day for the month of May 2024 in three different sites. Our data may look something like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">ticktest</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">tsibble</span><span class="p">(</span>
<span class="w">  </span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">as_date</span><span class="p">(</span><span class="s">&quot;2024-05-01&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0</span><span class="o">:</span><span class="m">30</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span>
<span class="w">  </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">rpois</span><span class="p">(</span><span class="m">31</span><span class="p">,</span><span class="m">20</span><span class="p">),</span><span class="w"> </span><span class="nf">rpois</span><span class="p">(</span><span class="m">31</span><span class="p">,</span><span class="m">10</span><span class="p">),</span><span class="w"> </span><span class="nf">rpois</span><span class="p">(</span><span class="m">31</span><span class="p">,</span><span class="m">50</span><span class="p">)),</span>
<span class="w">  </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="s">&quot;Silwood Bottom&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">31</span><span class="p">),</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="s">&quot;Water Meadow&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">31</span><span class="p">),</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="s">&quot;rookery Slope&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">31</span><span class="p">)),</span>
<span class="w">  </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">group</span><span class="p">,</span>
<span class="w">  </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">date</span>
<span class="w">  </span><span class="p">)</span>
<span class="n">ticktest</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tbl_ts: 93 × 3</caption>
<thead>
	<tr><th scope=col>date</th><th scope=col>value</th><th scope=col>group</th></tr>
	<tr><th scope=col>&lt;date&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><td>2024-05-01</td><td>50</td><td>rookery Slope</td></tr>
	<tr><td>2024-05-02</td><td>53</td><td>rookery Slope</td></tr>
	<tr><td>2024-05-03</td><td>60</td><td>rookery Slope</td></tr>
	<tr><td>2024-05-04</td><td>41</td><td>rookery Slope</td></tr>
	<tr><td>2024-05-05</td><td>54</td><td>rookery Slope</td></tr>
	<tr><td>⋮</td><td>⋮</td><td>⋮</td></tr>
	<tr><td>2024-05-27</td><td>10</td><td>Water Meadow</td></tr>
	<tr><td>2024-05-28</td><td> 8</td><td>Water Meadow</td></tr>
	<tr><td>2024-05-29</td><td>13</td><td>Water Meadow</td></tr>
	<tr><td>2024-05-30</td><td>15</td><td>Water Meadow</td></tr>
	<tr><td>2024-05-31</td><td>14</td><td>Water Meadow</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tsibble</span><span class="o">::</span><span class="nf">interval</span><span class="p">(</span><span class="n">ticktest</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;interval[1]&gt;
[1] 1D
</pre></div>
</div>
</div>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">tsibble</span></code> structures makes basic time series analysis much easier (as it plays well with other time series packages), however it is not entirely necessary to convert to <code class="docutils literal notranslate"><span class="pre">tsibble</span></code> in all scenarios. Your decision will likely depend on your usecase.</p>
<p>When you print a <code class="docutils literal notranslate"><span class="pre">tsibble</span></code> object, generally the output will start with a few descriptive lines that are worthwhile knowing how to interpret.</p>
<p>In the following example, this <code class="docutils literal notranslate"><span class="pre">tsibble</span></code> is a 93 line dataset, with a period (time between observations) of 1 day (<code class="docutils literal notranslate"><span class="pre">[1D]</span></code>) and 3 groups.</p>
</section>
</section>
<section id="plotting">
<h2>Plotting<a class="headerlink" href="#plotting" title="Link to this heading">#</a></h2>
<p>Plotting a time series in a <code class="docutils literal notranslate"><span class="pre">tsibble</span></code> is made exceptionally easy using the <code class="docutils literal notranslate"><span class="pre">autoplot()</span></code> function originally from <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code>. If you feed a <code class="docutils literal notranslate"><span class="pre">tsibble</span></code> object into <code class="docutils literal notranslate"><span class="pre">autoplot()</span></code> using a pipe (<code class="docutils literal notranslate"><span class="pre">|&gt;</span></code>) then it will try its best to plot the time series in a sensible manner:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">ticktest</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">autoplot</span><span class="p">(</span><span class="n">.vars</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/71b6495f2d75da0c588c8295b74fa3bf52e90978852daa015b5d5fe0d0572c4e.png"><img alt="../../_images/71b6495f2d75da0c588c8295b74fa3bf52e90978852daa015b5d5fe0d0572c4e.png" src="../../_images/71b6495f2d75da0c588c8295b74fa3bf52e90978852daa015b5d5fe0d0572c4e.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>If you do not provide the name of a column to the <code class="docutils literal notranslate"><span class="pre">.vars</span></code> argument, it does try to work out the most sensible column, but will also throw a warning when it does. As such it’s usually best to include this argument.</p>
<p>Now this data was just randomly generated with no real signal, however we can just use real data to see some more usable time series</p>
</section>
<section id="dealing-with-missing-values">
<h2>Dealing with missing values<a class="headerlink" href="#dealing-with-missing-values" title="Link to this heading">#</a></h2>
<p>Some time series data has missing values that can really get in the way of proper modelling. For an example let’s look at some data in <code class="docutils literal notranslate"><span class="pre">vecdyn</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ohvbd.ids</span><span class="p">(</span><span class="m">526</span><span class="p">,</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;vd&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="c1"># Decide what data we want to pull, and from where</span>
<span class="w">  </span><span class="nf">fetch</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="c1"># Fetch the data from vecdyn</span>
<span class="w">  </span><span class="nf">extract</span><span class="p">(</span><span class="n">cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;location_description&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sample_value&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sample_start_date&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="c1"># Extract the columns we want from the responses</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span>
<span class="w">    </span><span class="n">sample_start_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as_date</span><span class="p">(</span><span class="n">sample_start_date</span><span class="p">),</span>
<span class="w">    </span><span class="n">sample_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">sample_value</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="c1"># Wrangle the columns into appropriate data formats</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Cyan">ℹ</span> Found <span class=" -Color -Color-Blue">249</span> rows of data.

<span class=" -Color -Color-Cyan">ℹ</span> Predicted to take ~<span class=" -Color -Color-Blue">2s</span>.
</pre></div>
</div>
</div>
</div>
<p>Now if we try to convert this week-interval data to a tsibble straight-out we will encounter a problem:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">tsibble</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Using `sample_start_date` as index variable.
</pre></div>
</div>
<div class="output text_html"><table class="dataframe">
<caption>A tbl_ts: 249 × 3</caption>
<thead>
	<tr><th scope=col>location_description</th><th scope=col>sample_value</th><th scope=col>sample_start_date</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;date&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Alps</td><td>0</td><td>2010-05-28</td></tr>
	<tr><td>Alps</td><td>0</td><td>2010-06-04</td></tr>
	<tr><td>Alps</td><td>0</td><td>2010-06-11</td></tr>
	<tr><td>Alps</td><td>0</td><td>2010-06-18</td></tr>
	<tr><td>Alps</td><td>0</td><td>2010-06-25</td></tr>
	<tr><td>⋮</td><td>⋮</td><td>⋮</td></tr>
	<tr><td>Alps</td><td>17.855340</td><td>2019-10-06</td></tr>
	<tr><td>Alps</td><td> 0.000000</td><td>2019-10-13</td></tr>
	<tr><td>Alps</td><td> 3.032694</td><td>2019-10-20</td></tr>
	<tr><td>Alps</td><td> 0.000000</td><td>2019-10-27</td></tr>
	<tr><td>Alps</td><td> 0.000000</td><td>2019-11-19</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">tsibble</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">tsibble</span><span class="o">::</span><span class="nf">interval</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Using `sample_start_date` as index variable.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;interval[1]&gt;
[1] 1D
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">A</span> <span class="pre">tsibble:</span> <span class="pre">249</span> <span class="pre">x</span> <span class="pre">3</span> <span class="pre">[1D]</span></code> line here shows that tsibble has decided this is a dataset taken at 1-day intervals.</p>
<p>remember a time series must have equally spaced intervals, so in the case where there are varying intervals, it will take the lowest common denominator. In this case that is simply daily data.</p>
<p>However these data are weekly egg data, taken just before the mosquito season in Italy starts, and continuing until no more mosquito eggs are found in the ovitraps.</p>
<p>To deal with this we need to do some slightly messy wrangling. Let’s first replace all the missing values in our time series.</p>
<p>Luckily we know (using our own ecological intuition) that any time out of season, the mosquito population will be essentially 0, so we can replace any missing values with 0s.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dfibble</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">tsibble</span><span class="p">(</span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">location_description</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_start_date</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="c1"># Convert to tsibble</span>
<span class="w">  </span><span class="nf">arrange</span><span class="p">(</span><span class="n">sample_start_date</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="c1"># Arrange by start date</span>
<span class="w">  </span><span class="nf">fill_gaps</span><span class="p">(</span><span class="n">sample_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="c1"># Fill missing values with 0s (as it&#39;s out of mosquito season)</span>
<span class="n">dfibble</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tbl_ts: 3463 × 3</caption>
<thead>
	<tr><th scope=col>location_description</th><th scope=col>sample_value</th><th scope=col>sample_start_date</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;date&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Alps</td><td>0</td><td>2010-05-28</td></tr>
	<tr><td>Alps</td><td>0</td><td>2010-05-29</td></tr>
	<tr><td>Alps</td><td>0</td><td>2010-05-30</td></tr>
	<tr><td>Alps</td><td>0</td><td>2010-05-31</td></tr>
	<tr><td>Alps</td><td>0</td><td>2010-06-01</td></tr>
	<tr><td>⋮</td><td>⋮</td><td>⋮</td></tr>
	<tr><td>Alps</td><td>0</td><td>2019-11-15</td></tr>
	<tr><td>Alps</td><td>0</td><td>2019-11-16</td></tr>
	<tr><td>Alps</td><td>0</td><td>2019-11-17</td></tr>
	<tr><td>Alps</td><td>0</td><td>2019-11-18</td></tr>
	<tr><td>Alps</td><td>0</td><td>2019-11-19</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>This still isn’t right though. We now have days within the mosquito season getting filled with 0s.</p>
<p>We can see that by just getting the data from 2019.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dfibble</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="nf">year</span><span class="p">(</span><span class="n">sample_start_date</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2019</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">autoplot</span><span class="p">(</span><span class="n">.vars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_value</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/3aadc0b0a0132c6e27f40867ccbe2b30332c8402fd62998415e099304f759731.png"><img alt="../../_images/3aadc0b0a0132c6e27f40867ccbe2b30332c8402fd62998415e099304f759731.png" src="../../_images/3aadc0b0a0132c6e27f40867ccbe2b30332c8402fd62998415e099304f759731.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>It appears as though the sample value keeps dropping to zero within the season.</p>
<p>This is because the original data was sampled once per week! We must then reaggregate the dataset to a weekly scale.</p>
<p>This sort of thing is a fairly common occurrence within time series analysis, especially when your data are not nicely-behaved toy datasets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dfibble</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dfibble</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">index_by</span><span class="p">(</span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">yearweek</span><span class="p">(</span><span class="n">.</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="c1"># Aggregate to week-level (as original data is week-level)</span>
<span class="w">  </span><span class="nf">summarise</span><span class="p">(</span><span class="n">sample_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">sample_value</span><span class="p">))</span><span class="w"> </span><span class="c1"># Find the max value (as there is only a maximum of 1 value per week that is non-0)</span>

<span class="n">dfibble</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="nf">year</span><span class="p">(</span><span class="n">date</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2019</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">  </span><span class="nf">autoplot</span><span class="p">(</span><span class="n">.vars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_value</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/178e8a093d39fe9fd2b365fcaee98e4d89225ce270c29efcf7797828b9a9802c.png"><img alt="../../_images/178e8a093d39fe9fd2b365fcaee98e4d89225ce270c29efcf7797828b9a9802c.png" src="../../_images/178e8a093d39fe9fd2b365fcaee98e4d89225ce270c29efcf7797828b9a9802c.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>That looks much better, and now we have a fully-functional time series:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dfibble</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">autoplot</span><span class="p">(</span><span class="n">.vars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_value</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/265d78a1e5d0c2e904834d17952f382f4456be971d348d425e40242c815b336c.png"><img alt="../../_images/265d78a1e5d0c2e904834d17952f382f4456be971d348d425e40242c815b336c.png" src="../../_images/265d78a1e5d0c2e904834d17952f382f4456be971d348d425e40242c815b336c.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<blockquote>
<div><p><strong>Beware</strong>, you cannot always just assume that any missing values are 0s. This is a decision you can only make by <em>actually understanding your data</em>.</p>
</div></blockquote>
<p>There is actually a whole area of statistics related to imputation (filling in gaps) in time series data. We’re not going to cover this here as we are dealing with relatively “kind” datasets, but if you are interested in the deep dynamical models used to do this, a good place to start would be to look at the <a class="reference external" href="https://en.wikipedia.org/wiki/Kalman_filter">Kalman filter</a> which can be combined with ArIMA models to impute missing data.</p>
<p>Generally speaking the easiest way to deal with missing data, though, is with aggregation.</p>
</section>
<section id="seasonality-plots">
<h2>Seasonality plots<a class="headerlink" href="#seasonality-plots" title="Link to this heading">#</a></h2>
<p>Given that each year has different distinct seasons, and each season is similar between years, another way to look at time series data across years is using something called a seasonality plot. This overlays the years on top of one another and allows us to easily compare data between the years.</p>
<p>We can do that using the <code class="docutils literal notranslate"><span class="pre">gg_season()</span></code> function, defined in <code class="docutils literal notranslate"><span class="pre">feasts</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dfibble</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">gg_season</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_value</span><span class="p">,</span><span class="w"> </span><span class="n">max_col_discrete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/9916800d81c862a48e299624c40d52b24f82cffc75404993d1eb29927100ddec.png"><img alt="../../_images/9916800d81c862a48e299624c40d52b24f82cffc75404993d1eb29927100ddec.png" src="../../_images/9916800d81c862a48e299624c40d52b24f82cffc75404993d1eb29927100ddec.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>Now this is already pretty cool. We can see that all years peak <em>approximately</em> at the same time, but I’m sure you’ll agree it’s pretty messy.</p>
<p>As such, let’s reaggregate this data temporarily to monthly data and re-make the seasonality plot.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dfibble</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">index_by</span><span class="p">(</span><span class="n">yearmonth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">yearmonth</span><span class="p">(</span><span class="n">.</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="c1"># reaggregate to month-level, we must use a new column name for reasons unbeknownst to me</span>
<span class="w">  </span><span class="nf">summarise</span><span class="p">(</span><span class="n">sample_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">sample_value</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">gg_season</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_value</span><span class="p">,</span><span class="w"> </span><span class="n">max_col_discrete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/e46d86e696e27bfc84297ee94f9cb12288010255e9230aee32724e1331f3fac5.png"><img alt="../../_images/e46d86e696e27bfc84297ee94f9cb12288010255e9230aee32724e1331f3fac5.png" src="../../_images/e46d86e696e27bfc84297ee94f9cb12288010255e9230aee32724e1331f3fac5.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>Isn’t that better? We can now more clearly see that the data from 2015 peaked earlier and fairly high, similar to the data from 2019.</p>
</section>
<section id="lag-plots">
<h2>Lag plots<a class="headerlink" href="#lag-plots" title="Link to this heading">#</a></h2>
<p>Another plot that can be exceedingly useful is a lag plot. This plots values at time <span class="math notranslate nohighlight">\(t\)</span> (on the x axis) against their values at time <span class="math notranslate nohighlight">\(t - l\)</span> where <span class="math notranslate nohighlight">\(l\)</span> is the lag distance.</p>
<p><span class="math notranslate nohighlight">\(l\)</span> is in the same units as the interval of the data (in our case, weeks).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dfibble</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">gg_lag</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_value</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;point&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/53322ec19e4df243c6a3126ae6a5e6d55b39824efdb4ab4903d074d574fb65ca.png"><img alt="../../_images/53322ec19e4df243c6a3126ae6a5e6d55b39824efdb4ab4903d074d574fb65ca.png" src="../../_images/53322ec19e4df243c6a3126ae6a5e6d55b39824efdb4ab4903d074d574fb65ca.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>When looking at this data, the colour of the dots indicates the week in the year from which the data originates.</p>
<p>Purple dots are at the head of the season, and yellow dots are towards the end. Is there any trend that you see here?</p>
</section>
<section id="autocorrelation-plots">
<h2>Autocorrelation plots<a class="headerlink" href="#autocorrelation-plots" title="Link to this heading">#</a></h2>
<p>Another useful tool for investigating the lag in a dataset is to directly investigate the autocorrelation within the data.</p>
<p>One excellent visual tool for this is to use the autocorrelation measures at different time lags.</p>
<p>This represents the correlation between the point at time <span class="math notranslate nohighlight">\(t\)</span> and at time <span class="math notranslate nohighlight">\(t-l\)</span> where <span class="math notranslate nohighlight">\(l\)</span> is the lag.</p>
<p>We can do this using the <code class="docutils literal notranslate"><span class="pre">ACF()</span></code> function from <code class="docutils literal notranslate"><span class="pre">feasts</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dfibble</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">ACF</span><span class="p">(</span><span class="n">sample_value</span><span class="p">,</span><span class="w"> </span><span class="n">lag_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">52</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tbl_cf: 52 × 2</caption>
<thead>
	<tr><th scope=col>lag</th><th scope=col>acf</th></tr>
	<tr><th scope=col>&lt;cf_lag&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1W</td><td>0.8646474</td></tr>
	<tr><td>2W</td><td>0.7640465</td></tr>
	<tr><td>3W</td><td>0.6737971</td></tr>
	<tr><td>4W</td><td>0.5468455</td></tr>
	<tr><td>5W</td><td>0.4419175</td></tr>
	<tr><td>⋮</td><td>⋮</td></tr>
	<tr><td>48W</td><td>0.4433745</td></tr>
	<tr><td>49W</td><td>0.5246661</td></tr>
	<tr><td>50W</td><td>0.6038654</td></tr>
	<tr><td>51W</td><td>0.6344849</td></tr>
	<tr><td>52W</td><td>0.6519339</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>This is all well and good but a dataframe of these values is not the easiest to interpret. Here is where the stunning <code class="docutils literal notranslate"><span class="pre">autoplot()</span></code> feature comes back into play.</p>
<p>If we pipe this ACF dataframe into the <code class="docutils literal notranslate"><span class="pre">autoplot()</span></code> we end up with something known as an ACF plot:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dfibble</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">ACF</span><span class="p">(</span><span class="n">sample_value</span><span class="p">,</span><span class="w"> </span><span class="n">lag_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">52</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">autoplot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/b436a3993f1d38c9eaa2572ca6f9fc5d6aaf9e3d0911a5f1938a1f0bbe72f59a.png"><img alt="../../_images/b436a3993f1d38c9eaa2572ca6f9fc5d6aaf9e3d0911a5f1938a1f0bbe72f59a.png" src="../../_images/b436a3993f1d38c9eaa2572ca6f9fc5d6aaf9e3d0911a5f1938a1f0bbe72f59a.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>In this plot we can clearly see that there’s some sort of trend going on, specifically it sort of looks like the graph of a cosine function of period 52.</p>
<p>That’s because it pretty much is! This is a direct view into the seasonality of the data in this scenario. Where a given value in the height of the egg-laying season is compared with the value 26 weeks earlier, that is comparing to the value when nothing is laying eggs, so we end up with a calculated anticorrelation. However when comparing to data 52 weeks prior we see a decent positive correlation, as data one year in the past is similar to that at present!</p>
<p>Take a few minutes to look at this plot and try to make sure it makes sense. It’s a very useful tool to have in your back pocket!</p>
</section>
<section id="decomposition">
<h2>Decomposition<a class="headerlink" href="#decomposition" title="Link to this heading">#</a></h2>
<p>Decomposition is the process of breaking an object into its component parts. When talking about time series data, these components generally fall into three categories:</p>
<ol class="arabic simple">
<li><p>A trend</p></li>
<li><p>Seasonal components</p></li>
<li><p>random noise</p></li>
</ol>
<p>For the examples in this first section about decomposition, let’s pull some temperature data from another hub-linked source, the ArEAdata project (AD).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">addata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">fetch_ad</span><span class="p">(</span><span class="n">use_cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TrUE</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">extract</span><span class="p">(</span><span class="n">places</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;United Kingdom&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">  </span><span class="c1"># Get only UK temperature date</span>
<span class="w">  </span><span class="nf">enframe</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">  </span><span class="c1"># Convert into a df</span>
<span class="w">  </span><span class="nf">rename</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">temperature</span><span class="o">=</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">  </span><span class="c1"># rename columns</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="nf">as_date</span><span class="p">(</span><span class="n">date</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">  </span><span class="c1"># Make sure the date column is actually a date</span>
<span class="w">  </span><span class="nf">tsibble</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">date</span><span class="p">)</span><span class="w">  </span><span class="c1"># Convert to a tsibble as usual</span>

<span class="c1"># And plot it to take a look:</span>
<span class="n">addata</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">autoplot</span><span class="p">(</span><span class="n">.vars</span><span class="o">=</span><span class="n">temperature</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>❯ Loading ArEAdata cache: temp-0 ...

<span class=" -Color -Color-Green">✔</span> Loaded ArEAdata cache temp-0.

❯ Loading ArEAdata cache: temp-0 ...

</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/d45e1019e405a7b98af15f155086068b1db0af9da768c66f41d0fac045ebc97e.png"><img alt="../../_images/d45e1019e405a7b98af15f155086068b1db0af9da768c66f41d0fac045ebc97e.png" src="../../_images/d45e1019e405a7b98af15f155086068b1db0af9da768c66f41d0fac045ebc97e.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>This data is the day-by-day mean temperature for the United Kingdom between 2020 and 2024.</p>
<p>It’s very high resolution, so just for exploring it a bit easier, let’s once again reaggregate it, this time to monthly data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">addata_monthly</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">addata</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">index_by</span><span class="p">(</span><span class="n">ym</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">yearmonth</span><span class="p">(</span><span class="n">.</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">summarise</span><span class="p">(</span><span class="n">temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">temperature</span><span class="p">))</span>

<span class="n">addata_monthly</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">autoplot</span><span class="p">(</span><span class="n">.vars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temperature</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/ecf9af4dc34e30e2f29dbfbf9986e349494e17084eeb4b84905f7c95cc8829ae.png"><img alt="../../_images/ecf9af4dc34e30e2f29dbfbf9986e349494e17084eeb4b84905f7c95cc8829ae.png" src="../../_images/ecf9af4dc34e30e2f29dbfbf9986e349494e17084eeb4b84905f7c95cc8829ae.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>That’s better! For this next bit don’t focus so much on the code we are using.</p>
<p>We’ll cover a lot of it in much more detail later, for now just look at the outputs.</p>
<p>Here is our full decomposition to refer back to:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">addata_monthly_components</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">addata_monthly</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">model</span><span class="p">(</span>
<span class="w">  </span><span class="nf">STL</span><span class="p">(</span><span class="n">temperature</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">trend</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">season</span><span class="p">(</span><span class="n">period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">))</span>
<span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">components</span><span class="p">()</span>

<span class="n">addata_monthly_components</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">autoplot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/2245f2738c05d9cd753def0411c9f6b4804317cf5fa9bddf6339edf0105f0041.png"><img alt="../../_images/2245f2738c05d9cd753def0411c9f6b4804317cf5fa9bddf6339edf0105f0041.png" src="../../_images/2245f2738c05d9cd753def0411c9f6b4804317cf5fa9bddf6339edf0105f0041.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<section id="trend">
<h3>Trend<a class="headerlink" href="#trend" title="Link to this heading">#</a></h3>
<p>The trend of a time series is its general movement over time. If the overall value is increasing in general, the trend will go up.</p>
<p>If there are moments in time where the value is significantly lower than “usual”, you may see a dip in the trend.</p>
<p>Here we can see that there is a bit of a dip around the winter of 2020/2021.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">addata_monthly_components</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ym</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">trend</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">geom_line</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/d060ca42e5439f516cf39eee156267391b761e73acaf8d8bfe318393c38c40ab.png"><img alt="../../_images/d060ca42e5439f516cf39eee156267391b761e73acaf8d8bfe318393c38c40ab.png" src="../../_images/d060ca42e5439f516cf39eee156267391b761e73acaf8d8bfe318393c38c40ab.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>Maybe we could <a class="reference external" href="https://www.metoffice.gov.uk/research/climate/maps-and-data/uk-temperature-rainfall-and-sunshine-anomaly-graphs">verify</a> that this <a class="reference external" href="https://en.wikipedia.org/wiki/2020%E2%80%9321_European_windstorm_season#Storm_Christoph">really happened</a> by looking at <a class="reference external" href="https://www.metoffice.gov.uk/about-us/news-and-media/media-centre/weather-and-climate-news/2021/2021-a-year-in-weather-a-review">some other</a> <a class="reference external" href="https://www.bbc.co.uk/weather/features/56944299">data sources</a>.</p>
<p>Generally it’s a good idea to verify that your analysis techniques are working by finding other information to assess whether your approach is valid.</p>
</section>
<section id="seasonality">
<h3>Seasonality<a class="headerlink" href="#seasonality" title="Link to this heading">#</a></h3>
<p>Seasonality is the name given to cyclic effects within a time series. These could be yearly cycles corresponding to changing temperatures across the year. They could also be daily cycles corresponding to people’s work schedules.</p>
<p>In this case we expect a yearly cycle of temperatures corresponding to the different seasons within the UK.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">addata_monthly_components</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ym</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">season_12</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">geom_line</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/a0d10b3a0de955cc467ae5328fc108d5fa83d1ae4f7be010f42a02bb027267ec.png"><img alt="../../_images/a0d10b3a0de955cc467ae5328fc108d5fa83d1ae4f7be010f42a02bb027267ec.png" src="../../_images/a0d10b3a0de955cc467ae5328fc108d5fa83d1ae4f7be010f42a02bb027267ec.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>The amount of time between repeats of a cycle is known as the <strong>period</strong> of the seasonality.</p>
<p>Often the period of a seasonal signal is directly related to the physical mechanism/s that causes said signal.</p>
</section>
<section id="random-noise-or-the-remainder-component">
<h3>random noise (or the remainder component)<a class="headerlink" href="#random-noise-or-the-remainder-component" title="Link to this heading">#</a></h3>
<p>The final component is generally a “noise” component. This contains any extra variability present in the data once the general trend and seasonal components have been removed.</p>
<p>This is often quite unpredictable and uncorrelated. Very generally speaking, we expect the random noise in most cases to be approximately <a class="reference external" href="https://en.wikipedia.org/wiki/Stationary_process">stationary</a> and in an <em>additive</em> model, to be centred around 0.</p>
<p><strong>Note:</strong> if a process has a steady mean and variance over time, it is referred to as <em>stationary</em>. This is an important word that you may well come across when reading papers about time series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">addata_monthly_components</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ym</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">remainder</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">geom_line</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/74359ce874c30ba35d2ce7c0614c525dbea289f4ba439f05a43ac0decdc6f227.png"><img alt="../../_images/74359ce874c30ba35d2ce7c0614c525dbea289f4ba439f05a43ac0decdc6f227.png" src="../../_images/74359ce874c30ba35d2ce7c0614c525dbea289f4ba439f05a43ac0decdc6f227.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
</section>
<section id="challenge">
<h3>Challenge<a class="headerlink" href="#challenge" title="Link to this heading">#</a></h3>
<p>Time for an exercise! Don’t worry about what the code does for now, instead just focus on the plot outputs.</p>
<ol class="arabic simple">
<li><p>Adapt the following code to get data for different countries. Have a look at their trend and seasonality components.</p></li>
<li><p>Use the code to specifically investigate one of the following countries: <code class="docutils literal notranslate"><span class="pre">Indonesia</span></code>, <code class="docutils literal notranslate"><span class="pre">Ecuador</span></code>, <code class="docutils literal notranslate"><span class="pre">Singapore</span></code>. What do you notice?</p></li>
</ol>
<p>remember to look carefully at the scale of the y axis on each subplot!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">fetch_ad</span><span class="p">(</span><span class="n">use_cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TrUE</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">extract</span><span class="p">(</span><span class="n">places</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;United Kingdom&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">  </span><span class="c1"># Change the place name here!</span>
<span class="w">  </span><span class="nf">enframe</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">rename</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">temperature</span><span class="o">=</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="nf">as_date</span><span class="p">(</span><span class="n">date</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">tsibble</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">date</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">index_by</span><span class="p">(</span><span class="n">ym</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">yearmonth</span><span class="p">(</span><span class="n">.</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">summarise</span><span class="p">(</span><span class="n">temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">temperature</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">model</span><span class="p">(</span>
<span class="w">    </span><span class="nf">STL</span><span class="p">(</span><span class="n">temperature</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">trend</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">season</span><span class="p">(</span><span class="n">period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">))</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">components</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">autoplot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Note:</strong> If you are struggling to find the given name for a country within AD, enter the following command into r to get a list of all country names:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">rownames</span><span class="p">(</span><span class="nf">fetch_ad</span><span class="p">(</span><span class="n">use_cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TrUE</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section id="additive-decompositions">
<h3>Additive decompositions<a class="headerlink" href="#additive-decompositions" title="Link to this heading">#</a></h3>
<p>Now you’ve taken a look at the components of a time series decomposition, it’s probably best to understand a little more about how to put one together yourself.</p>
<p>The simplest form of time series decomposition is known as a <em>classical decomposition</em>.</p>
<p>Classical decompositions contain a few assumptions about the components of the time series in question.</p>
<p>Generally a decomposition (specifically an <em>additive</em> decomposition) expects that a time series <span class="math notranslate nohighlight">\(x_t\)</span> can be written as the equation:</p>
<div class="math notranslate nohighlight">
\[x_t = T_t + S_t + r_t\]</div>
<p>where <span class="math notranslate nohighlight">\(T_t\)</span> is the trend, <span class="math notranslate nohighlight">\(S_t\)</span> is a regular seasonal component, and <span class="math notranslate nohighlight">\(r_t\)</span> is the random noise (or the “remainder”).</p>
<p>In a classical decomposition:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(S_t\)</span> and <span class="math notranslate nohighlight">\(r_t\)</span> are both assumed to have a mean of approximately 0</p></li>
<li><p><span class="math notranslate nohighlight">\(S_{t+p} = S_t\)</span> for a given period <span class="math notranslate nohighlight">\(p\)</span></p></li>
</ul>
<p>Let’s run an additive classical decomposition on the data we previously retrieved from <code class="docutils literal notranslate"><span class="pre">vecdyn</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dfibble</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">model</span><span class="p">(</span><span class="nf">classical_decomposition</span><span class="p">(</span><span class="n">sample_value</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;additive&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="c1"># Define the classical decompostion model to fit</span>
<span class="w">  </span><span class="nf">components</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="c1"># Extract the components from the fitted model</span>
<span class="w">  </span><span class="nf">autoplot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning message:
“removed 26 rows containing missing values or values outside the scale range
(`geom_line()`).”
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/2aea194d808bde0b1cbf91af7c248b65db51dfc8bd8d90eda264245650d127d6.png"><img alt="../../_images/2aea194d808bde0b1cbf91af7c248b65db51dfc8bd8d90eda264245650d127d6.png" src="../../_images/2aea194d808bde0b1cbf91af7c248b65db51dfc8bd8d90eda264245650d127d6.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>Okay, not a terrible fit at all. It’s successfully derived a 52-week seasonal signal, and the random noise is somewhat random at the places where real data was located (remember that we filled in the intermediate gaps with 0s).</p>
<p>Let’s shift to a different data set for some more examples. Specifically there is a dataset included with <code class="docutils literal notranslate"><span class="pre">fpp3</span></code> called <code class="docutils literal notranslate"><span class="pre">aus_arrivals</span></code>. This is a quarterly time series of tourist arrivals into Australia between 1981 and 2011, by country of origin.</p>
<p>Let’s quickly take a look at arrivals just from the UK</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">aus_arrivals</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">Origin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;UK&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">autoplot</span><span class="p">(</span><span class="n">.vars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrivals</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/362d18ec0db7facfeb5cd9abadf8b4a76dc255326feb497a1095e1ce5eb6502b.png"><img alt="../../_images/362d18ec0db7facfeb5cd9abadf8b4a76dc255326feb497a1095e1ce5eb6502b.png" src="../../_images/362d18ec0db7facfeb5cd9abadf8b4a76dc255326feb497a1095e1ce5eb6502b.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>You may notice something different here, let’s try an additive classical decomposition to see how that looks:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">aus_arrivals</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">Origin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;UK&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">model</span><span class="p">(</span>
<span class="w">    </span><span class="nf">classical_decomposition</span><span class="p">(</span><span class="n">Arrivals</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;additive&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">components</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">autoplot</span><span class="p">(</span><span class="n">.vars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrivals</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning message:
“removed 2 rows containing missing values or values outside the scale range
(`geom_line()`).”
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/86ee79aa0b883d56ba780eb8d07e7b35a7887668460d355129599dbf14387e45.png"><img alt="../../_images/86ee79aa0b883d56ba780eb8d07e7b35a7887668460d355129599dbf14387e45.png" src="../../_images/86ee79aa0b883d56ba780eb8d07e7b35a7887668460d355129599dbf14387e45.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>Hmm, generally we got a sensible trend out, but that random part is looking a bit odd. The scale of it is all over the place!</p>
<p>If you look back at the raw data (top segment of this plot) you can see that as the mean arrivals grows larger, the seasonal variance also seems to get wider.</p>
<p>This is a classic indication of a <em>multiplicative</em> process.</p>
</section>
<section id="multiplicative-decomposition">
<h3>Multiplicative decomposition<a class="headerlink" href="#multiplicative-decomposition" title="Link to this heading">#</a></h3>
<p>A multiplicative decomposition uses a slightly different equation to additive decomposition. You may already be able to guess its form:</p>
<div class="math notranslate nohighlight">
\[x_t = T_t S_t r_t\]</div>
<p>Out of interest, due to the magic of <em>logarithms</em> this is functionally identical to stating the following additive process:</p>
<div class="math notranslate nohighlight">
\[\log{x_t} = \log{T_t} + \log{S_t} + \log{r_t}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">aus_arrivals</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">Origin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;UK&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">model</span><span class="p">(</span>
<span class="w">    </span><span class="nf">classical_decomposition</span><span class="p">(</span><span class="n">Arrivals</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;mult&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">components</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">autoplot</span><span class="p">(</span><span class="n">.vars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrivals</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning message:
“removed 2 rows containing missing values or values outside the scale range
(`geom_line()`).”
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/74c69ac49b2b32d3396e2451a6c124e403d695cb06fc8214c4c75e0efc866212.png"><img alt="../../_images/74c69ac49b2b32d3396e2451a6c124e403d695cb06fc8214c4c75e0efc866212.png" src="../../_images/74c69ac49b2b32d3396e2451a6c124e403d695cb06fc8214c4c75e0efc866212.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>Whilst the trend and seasonal signal period are basically the same here, the random noise component seems a lot more nicely behaved and fairly stationary. (remember, <em>stationary</em> processes have a steady mean and variance over time.)</p>
<p>Let’s take a look at another multiplicative decomposition from this data, specifically the arrivals from Japan:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">aus_arrivals</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">Origin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Japan&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">model</span><span class="p">(</span>
<span class="w">    </span><span class="nf">classical_decomposition</span><span class="p">(</span><span class="n">Arrivals</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;mult&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">components</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">autoplot</span><span class="p">(</span><span class="n">.vars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrivals</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning message:
“removed 2 rows containing missing values or values outside the scale range
(`geom_line()`).”
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/e325cc9cc626507fa7ea922bda96f1d7300ceb8f6d6e4a785d2f16b1966bb956.png"><img alt="../../_images/e325cc9cc626507fa7ea922bda96f1d7300ceb8f6d6e4a785d2f16b1966bb956.png" src="../../_images/e325cc9cc626507fa7ea922bda96f1d7300ceb8f6d6e4a785d2f16b1966bb956.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>This is a bit more troubling. That random component is still varying over time, and there seems to be some periodic signal in the first years of data.</p>
<p>It seems like the seasonality of this data changes at around 1995, however classical decomposition assumes a constant seasonality throughout the dataset.</p>
<p><a class="reference external" href="https://images2.minutemediacdn.com/image/upload/c_fill,w_1200,ar_4:3,f_auto,q_auto,g_auto/shape/cover/sport/screen-shot-2020-05-14-at-12-15-19-pm-a831ebd9882da268434b34ed117a9410.jpg">We’re gonna need a bigger boat.</a></p>
</section>
<section id="advanced-decomposition">
<h3>Advanced decomposition<a class="headerlink" href="#advanced-decomposition" title="Link to this heading">#</a></h3>
<p>There are more advanced methods of time series decomposition, the best known of which is called <em>STL</em> decomposition (you may have seen this earlier if you paid close attention to the plot labels in the earlier temperature exercise).</p>
<p>STL decomposition stands for <em>Seasonal and Trend decomposition using LOESS</em>. LOESS is a form of nonparametric smoothing using local regression, and is used throughout the STL process.</p>
<p>Let’s have another go at that japan arrivals time series, but this time using STL:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">aus_arrivals</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">Origin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Japan&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">model</span><span class="p">(</span>
<span class="w">    </span><span class="nf">STL</span><span class="p">(</span><span class="n">Arrivals</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">trend</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">season</span><span class="p">())</span><span class="w">  </span><span class="c1"># You may recognise this syntax from fitting linear models!</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">components</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">autoplot</span><span class="p">(</span><span class="n">.vars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrivals</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/b10721a2bf4327c8ff92470d5fcf82d76958d5061bdd674c3e4fb80be60e7387.png"><img alt="../../_images/b10721a2bf4327c8ff92470d5fcf82d76958d5061bdd674c3e4fb80be60e7387.png" src="../../_images/b10721a2bf4327c8ff92470d5fcf82d76958d5061bdd674c3e4fb80be60e7387.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>This is looking a lot better in general, seasonality is now allowed to vary over time (mirroring what seems to be happening in the underlying process and thus in the data).</p>
<p>That has lead to a random (remainder) component with no repeating patterns or other weirdness. Seems like a much better decomposition!</p>
<p>Let’s try doing an STL decomposition on the <code class="docutils literal notranslate"><span class="pre">vecdyn</span></code> data we pulled earlier:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dfibble</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">model</span><span class="p">(</span>
<span class="w">    </span><span class="nf">STL</span><span class="p">(</span><span class="n">sample_value</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">trend</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="nf">season</span><span class="p">(</span><span class="n">period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">52</span><span class="p">))</span><span class="w">  </span><span class="c1"># We have a 52 week periodicity as there is one major peak in the year.</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">components</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">autoplot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/0ab6ca753800feb6d80b2f83c8d9efd296646bc4cf44cefedf534e7fb47aef4b.png"><img alt="../../_images/0ab6ca753800feb6d80b2f83c8d9efd296646bc4cf44cefedf534e7fb47aef4b.png" src="../../_images/0ab6ca753800feb6d80b2f83c8d9efd296646bc4cf44cefedf534e7fb47aef4b.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>The trend here looks a lot better than it did before! This is because the moving average method used by the classical decomposition estimation (provided by <code class="docutils literal notranslate"><span class="pre">stats::decompose()</span></code>) is using an inappropriate window size for the scale of the data, whilst LOESS handles it much more clearly.</p>
<p>It is actually possible to change this manually for classical decomposition, but frankly it’s a bit of an arcane process.</p>
<p><strong>Note:</strong> when deciding on an appropriate periodicity to encode into an STL model, you <em>must</em> keep in mind the fundamental resolution of your data.</p>
<p>For this <code class="docutils literal notranslate"><span class="pre">vecdyn</span></code> data, it is in weekly form, so we cannot have a useful periodicity of 1 week or below.</p>
<p>STL decompositions can also handle multiple seasonal signals with different periods. This can be achieved by simply adding extra <code class="docutils literal notranslate"><span class="pre">+</span> <span class="pre">season()</span></code> lines within the <code class="docutils literal notranslate"><span class="pre">STL()</span></code> call.</p>
</section>
</section>
<section id="id1">
<h2>Forecasting<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<p>A major goal in time series analysis is <em>forecasting</em>. This is essentially asking the following question:</p>
<blockquote>
<div><p>Given this data for the past, what will the data in the future look like?</p>
</div></blockquote>
<p>There are many different approaches to forecasting, and the “correct” (or “incorrect”) one to use is determined by a number of things. If you only care about the mean in a relatively stationary time series, that is very different to requiring accurate representation of processes with multiple seasonal components.</p>
<p>Next let’s explore few of the simplest forecasting methods. Each of these will be represented as a simple statement of the idea followed by a small explanation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">addata_fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">addata_monthly</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">model</span><span class="p">(</span>
<span class="w">      </span><span class="n">Mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">MEAN</span><span class="p">(</span><span class="n">temperature</span><span class="p">),</span>
<span class="w">      </span><span class="n">Naive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">NAIVE</span><span class="p">(</span><span class="n">temperature</span><span class="p">),</span>
<span class="w">      </span><span class="n">SeasonalNaive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">SNAIVE</span><span class="p">(</span><span class="n">temperature</span><span class="p">),</span>
<span class="w">      </span><span class="n">LinearTrend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">TSLM</span><span class="p">(</span><span class="n">temperature</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">trend</span><span class="p">()),</span>
<span class="w">      </span><span class="n">Drift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">NAIVE</span><span class="p">(</span><span class="n">temperature</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">drift</span><span class="p">())</span>
<span class="w">      </span><span class="p">)</span>
<span class="n">addata_fc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">addata_fit</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">forecast</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="m">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="mean">
<h3>Mean<a class="headerlink" href="#mean" title="Link to this heading">#</a></h3>
<blockquote>
<div><p>The mean of the historical values will be all future values</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">addata_fc</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">.model</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Mean&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">  </span><span class="nf">autoplot</span><span class="p">(</span><span class="n">addata_monthly</span><span class="p">,</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/ba8c1b640c48a3f737c0902c290b7dd8a2775152068056162c2f117e537091f1.png"><img alt="../../_images/ba8c1b640c48a3f737c0902c290b7dd8a2775152068056162c2f117e537091f1.png" src="../../_images/ba8c1b640c48a3f737c0902c290b7dd8a2775152068056162c2f117e537091f1.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>This is simple as it comes. Essentially we predict that the mean of all the data is the value we care about, and predict forwards linearly.</p>
</section>
<section id="naive">
<h3>Naive<a class="headerlink" href="#naive" title="Link to this heading">#</a></h3>
<blockquote>
<div><p>The most recent historical value will be all future values</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">addata_fc</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">.model</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Naive&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">  </span><span class="nf">autoplot</span><span class="p">(</span><span class="n">addata_monthly</span><span class="p">,</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/e30030bbadb8138e7e69b789a71aded28c843e09509b3c77f5bf38449cbd7899.png"><img alt="../../_images/e30030bbadb8138e7e69b789a71aded28c843e09509b3c77f5bf38449cbd7899.png" src="../../_images/e30030bbadb8138e7e69b789a71aded28c843e09509b3c77f5bf38449cbd7899.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>This is another very simple model, it’s good when a system has settled to a steady state after some sort of ramping up period.</p>
<p>It is also good if the underlying process is what is known as a <a class="reference external" href="https://en.wikipedia.org/wiki/Martingale_(probability_theory)">martingale </a>.</p>
</section>
<section id="seasonal-naive">
<h3>Seasonal naive<a class="headerlink" href="#seasonal-naive" title="Link to this heading">#</a></h3>
<blockquote>
<div><p>The most recent season will be all future seasons</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">addata_fc</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">.model</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;SeasonalNaive&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">  </span><span class="nf">autoplot</span><span class="p">(</span><span class="n">addata_monthly</span><span class="p">,</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/5fdaf20cb87ede126c325c86645ebc52a639253a57fdfa1b6a2df93a1489d5a0.png"><img alt="../../_images/5fdaf20cb87ede126c325c86645ebc52a639253a57fdfa1b6a2df93a1489d5a0.png" src="../../_images/5fdaf20cb87ede126c325c86645ebc52a639253a57fdfa1b6a2df93a1489d5a0.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>Seasonal naive models are generally pretty competent where a system has a strong and repeated seasonal component dominating the variation. Such as in this example of temperature across a year in the UK.</p>
</section>
<section id="linear-trend">
<h3>Linear trend<a class="headerlink" href="#linear-trend" title="Link to this heading">#</a></h3>
<blockquote>
<div><p>The linear trend of all historical values will continue onwards</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">addata_fc</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">.model</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;LinearTrend&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">  </span><span class="nf">autoplot</span><span class="p">(</span><span class="n">addata_monthly</span><span class="p">,</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/8d3eb16f5ab4093653e6d29c11063396135e4387075d5eeba10ea6b2446493ab.png"><img alt="../../_images/8d3eb16f5ab4093653e6d29c11063396135e4387075d5eeba10ea6b2446493ab.png" src="../../_images/8d3eb16f5ab4093653e6d29c11063396135e4387075d5eeba10ea6b2446493ab.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>The linear trend assumes that the data linearly trends in a particular direction, and extrapolates that general trend forwards. It is good when…well…the data has a significant linear trend.</p>
</section>
<section id="drift">
<h3>Drift<a class="headerlink" href="#drift" title="Link to this heading">#</a></h3>
<blockquote>
<div><p>The trend between the first and last historical values will continue onwards</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">addata_fc</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">.model</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Drift&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">  </span><span class="nf">autoplot</span><span class="p">(</span><span class="n">addata_monthly</span><span class="p">,</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/55a652e74f385a8773184b6cc4a0612f200a97cd2deba8756c0fa45197786bc6.png"><img alt="../../_images/55a652e74f385a8773184b6cc4a0612f200a97cd2deba8756c0fa45197786bc6.png" src="../../_images/55a652e74f385a8773184b6cc4a0612f200a97cd2deba8756c0fa45197786bc6.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>The drift method is a variant of the linear trend, however instead of fitting a linear model, it instead approximates the rate of change across the data using the difference between the first and last data points.</p>
<p>This can generally deal better with time series containing more extreme random fluctuations, but could be nonsensical if the data does not contain a full set of complete seasonal periods.</p>
</section>
</section>
<section id="simple-forecasting-using-fable">
<h2>Simple forecasting using <code class="docutils literal notranslate"><span class="pre">fable</span></code><a class="headerlink" href="#simple-forecasting-using-fable" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">fable</span></code> package has already been used quite a lot throughout this lesson so far. Its main purpose is to make the process of constructing and fitting models to time series data easy and reliable.</p>
<p>The following code generates all of the models listed above for the UK temperature data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">addata_fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">addata_monthly</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">model</span><span class="p">(</span><span class="w">  </span><span class="c1"># Specify the forecasting models to fit</span>
<span class="w">      </span><span class="n">Mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">MEAN</span><span class="p">(</span><span class="n">temperature</span><span class="p">),</span>
<span class="w">      </span><span class="n">Naive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">NAIVE</span><span class="p">(</span><span class="n">temperature</span><span class="p">),</span>
<span class="w">      </span><span class="n">SeasonalNaive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">SNAIVE</span><span class="p">(</span><span class="n">temperature</span><span class="p">),</span>
<span class="w">      </span><span class="n">LinearTrend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">TSLM</span><span class="p">(</span><span class="n">temperature</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">trend</span><span class="p">()),</span>
<span class="w">      </span><span class="n">Drift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">NAIVE</span><span class="p">(</span><span class="n">temperature</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">drift</span><span class="p">())</span>
<span class="w">      </span><span class="p">)</span>

<span class="n">addata_fc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">addata_fit</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">forecast</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="m">12</span><span class="p">)</span><span class="w"> </span><span class="c1"># Generate a forecast of 12 time steps</span>

<span class="n">addata_fc</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">autoplot</span><span class="p">(</span>
<span class="w">  </span><span class="n">addata_monthly</span><span class="p">,</span><span class="w">  </span><span class="c1"># Plot the original data alongside the model data, !! IMPOrTANT !!</span>
<span class="w">  </span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="w">     </span><span class="c1"># Suppresses confidence intervals for now with the level argument</span>
<span class="w">  </span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/1b4e6d23a43d1a66b9e1b29711e273802a80a25345438b0c78152d63cc1a6d5e.png"><img alt="../../_images/1b4e6d23a43d1a66b9e1b29711e273802a80a25345438b0c78152d63cc1a6d5e.png" src="../../_images/1b4e6d23a43d1a66b9e1b29711e273802a80a25345438b0c78152d63cc1a6d5e.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<section id="simple-forecasting-exercise">
<h3>Simple forecasting exercise<a class="headerlink" href="#simple-forecasting-exercise" title="Link to this heading">#</a></h3>
<p>Try fitting a few of these models to the <code class="docutils literal notranslate"><span class="pre">vecdyn</span></code> data we pulled above (currently in the variable <code class="docutils literal notranslate"><span class="pre">dfibble</span></code>).</p>
<p>Are any models particularly bad or good? Why do you think that might be?</p>
<p><em>rather than copying the above code from the workbook, try to type it out yourself!</em></p>
</section>
</section>
<section id="forecasting-from-decomposition">
<h2>Forecasting from decomposition<a class="headerlink" href="#forecasting-from-decomposition" title="Link to this heading">#</a></h2>
<p>Whilst the previous forecasting methods were good for time series with simple patterns underlying them, most data you will encounter from ecological systems are more complex.</p>
<p>They may well have odd trends, multiple seasonal components, or complex random elements at play.</p>
<p>Luckily we have already got ways to separate out the seasonality and other factors. We can then predict these individually and put them back together at the end to have a seasonally-aware forecast.</p>
<p>More formally, when forecasting using decomposition, we use a modified version of the typical time series equation. This splits the signal into a <strong>seasonal</strong> (<span class="math notranslate nohighlight">\(S_t\)</span>) and a <strong>seasonally-adjusted</strong> (<span class="math notranslate nohighlight">\(A_t\)</span>) component:</p>
<div class="math notranslate nohighlight">
\[x_t = S_t + A_t\]</div>
<p>Where <span class="math notranslate nohighlight">\(A_t = T_t + r_t\)</span>.</p>
<p><code class="docutils literal notranslate"><span class="pre">fable</span></code> makes such an approach relatively trivial. So let’s do it on the <code class="docutils literal notranslate"><span class="pre">vecdyn</span></code> data we used in the simple forecasting exercise above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dfibble</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">model</span><span class="p">(</span><span class="n">StlModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">decomposition_model</span><span class="p">(</span><span class="w">  </span><span class="c1"># Specify that we are doing a decomposition</span>
<span class="w">    </span><span class="nf">STL</span><span class="p">(</span><span class="n">sample_value</span><span class="p">),</span><span class="w">  </span><span class="c1"># Method for decomposition</span>
<span class="w">    </span><span class="nf">TSLM</span><span class="p">(</span><span class="n">season_adjust</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">trend</span><span class="p">()),</span><span class="w">  </span><span class="c1"># Model for seasonally adjusted component</span>
<span class="w">    </span><span class="nf">SNAIVE</span><span class="p">(</span><span class="n">season_year</span><span class="p">)</span><span class="w">  </span><span class="c1"># Model the seasonal component</span>
<span class="w">  </span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">forecast</span><span class="p">(</span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">104</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">autoplot</span><span class="p">(</span><span class="n">dfibble</span><span class="p">,</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/7bf167bc58e81166382f1dbe4cbebbe97f80729c3cd642fcd698e20924688007.png"><img alt="../../_images/7bf167bc58e81166382f1dbe4cbebbe97f80729c3cd642fcd698e20924688007.png" src="../../_images/7bf167bc58e81166382f1dbe4cbebbe97f80729c3cd642fcd698e20924688007.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<section id="transformations">
<h3>Transformations<a class="headerlink" href="#transformations" title="Link to this heading">#</a></h3>
<p>We have not covered transformations in great detail during this tutorial, however I’m going to mention one here specifically to solve a problem.</p>
<p>If we look at the forecast from our model here, everything looks good except the baseline out-of-season values seem to be going up (and are no longer 0)!</p>
<p>This is a problem. From a process-focused perspective this has arisen because the vector dynamics shown here are actually borne from two distinct processes:</p>
<ol class="arabic simple">
<li><p>The survival of adult mosquitoes</p></li>
<li><p>The breeding cycle of adult mosquitoes</p></li>
</ol>
<p>Within a year, process 2 is fundamentally dependent on process 1 (you can’t have eggs being laid if there are no mosquitoes to lay them)!</p>
<p>As such, the time series has vastly different local variance depending on where in the season you are. This means that no matter which way you look at it overall, either the peaks or the flat troughs are kind of “outliers”, which is skewing the overall trend slightly upwards when it shouldn’t.</p>
<p>One way we can deal with such a problem in this <em>particular</em> circumstance is to perform a transformation of the input data, and a back transform of the resultant forecast.</p>
<p>A log transform would squash down the difference magnitude between the breeding and fallow seasons, however you cannot take the log of 0!</p>
<p>Luckily there is another similar transformation called <code class="docutils literal notranslate"><span class="pre">log1p()</span></code>, which performs a log transform after adding a small amount to every data point. We must then reverse this after forecasting, <strong>however</strong> this is something <code class="docutils literal notranslate"><span class="pre">fable</span></code> can do for us automagically!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dfibble</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">model</span><span class="p">(</span><span class="n">StlModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">decomposition_model</span><span class="p">(</span>
<span class="w">    </span><span class="nf">STL</span><span class="p">(</span><span class="nf">log1p</span><span class="p">(</span><span class="n">sample_value</span><span class="p">)),</span><span class="w">  </span><span class="c1"># Now we are working on the transformed variable</span>
<span class="w">    </span><span class="nf">TSLM</span><span class="p">(</span><span class="n">season_adjust</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">trend</span><span class="p">()),</span><span class="w">  </span><span class="c1"># Everything else is the same</span>
<span class="w">    </span><span class="nf">SNAIVE</span><span class="p">(</span><span class="n">season_year</span><span class="p">)</span>
<span class="w">  </span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">forecast</span><span class="p">(</span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">104</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">autoplot</span><span class="p">(</span><span class="n">dfibble</span><span class="p">,</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/654e1f239a5d3d53cb0b60f18fcc58f98293e8c86eeae3eaedd308740ec6404a.png"><img alt="../../_images/654e1f239a5d3d53cb0b60f18fcc58f98293e8c86eeae3eaedd308740ec6404a.png" src="../../_images/654e1f239a5d3d53cb0b60f18fcc58f98293e8c86eeae3eaedd308740ec6404a.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>And look at that! The prediction looks pretty damn good! (If I do say so myself).</p>
</section>
</section>
<section id="exponential-smoothing">
<h2>Exponential smoothing<a class="headerlink" href="#exponential-smoothing" title="Link to this heading">#</a></h2>
<p>One family of easily fit (but very capable) forecasting methods is called <em>exponential smoothing</em>.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">fable</span></code> these are all fit using the <code class="docutils literal notranslate"><span class="pre">ETS()</span></code> function (Error, Trend, Seasonal) with slightly different parameter setups.</p>
<p>All calls follow the same basic form, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ETS</span><span class="p">(</span><span class="n">sample_value</span> <span class="o">~</span> <span class="n">error</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">trend</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">season</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">))</span>
</pre></div>
</div>
<section id="ets-parameters">
<h3><code class="docutils literal notranslate"><span class="pre">ETS()</span></code> parameters<a class="headerlink" href="#ets-parameters" title="Link to this heading">#</a></h3>
<p>Any call to <code class="docutils literal notranslate"><span class="pre">ETS()</span></code> in fable is constructed in a similar manner, with three individual components.</p>
<section id="error">
<h4><code class="docutils literal notranslate"><span class="pre">error()</span></code><a class="headerlink" href="#error" title="Link to this heading">#</a></h4>
<p>The error function determines the structure of the “noise” term of the model.</p>
<p>This could be either <code class="docutils literal notranslate"><span class="pre">&quot;A&quot;</span></code> for additive noise, or <code class="docutils literal notranslate"><span class="pre">&quot;M&quot;</span></code> for multiplicative noise.</p>
</section>
<section id="id2">
<h4><code class="docutils literal notranslate"><span class="pre">trend()</span></code><a class="headerlink" href="#id2" title="Link to this heading">#</a></h4>
<p>Trend is used to specify the form of the trend within the data, and to parameterise any smoothing or dampening performed on the trend.</p>
<p>This could be <code class="docutils literal notranslate"><span class="pre">&quot;A&quot;/&quot;M&quot;</span></code> as in <code class="docutils literal notranslate"><span class="pre">error()</span></code>, however it can also be dampened versions of these (<code class="docutils literal notranslate"><span class="pre">&quot;Ad&quot;/&quot;Md&quot;</span></code> respectively). Finally it can also be <code class="docutils literal notranslate"><span class="pre">&quot;N&quot;</span></code> to signify no trend term.</p>
</section>
<section id="season">
<h4><code class="docutils literal notranslate"><span class="pre">season()</span></code><a class="headerlink" href="#season" title="Link to this heading">#</a></h4>
<p>Season (predictably) specifies the seasonal component of the data. This can again be <code class="docutils literal notranslate"><span class="pre">&quot;A&quot;/&quot;M&quot;/&quot;N&quot;</span></code> for Additive, Multiplicative, or None.</p>
</section>
<section id="unstable-formulations">
<h4>Unstable formulations<a class="headerlink" href="#unstable-formulations" title="Link to this heading">#</a></h4>
<p>Whilst generally each term can be freely set to whatever combination of settings you choose, there are some combinations that are pretty unstable and will not fit reliably.</p>
<p>These are <code class="docutils literal notranslate"><span class="pre">ETS(A,</span> <span class="pre">A,</span> <span class="pre">M)</span></code>, <code class="docutils literal notranslate"><span class="pre">ETS(A,</span> <span class="pre">N,</span> <span class="pre">M)</span></code> and <code class="docutils literal notranslate"><span class="pre">ETS(A,</span> <span class="pre">Ad,</span> <span class="pre">M)</span></code>.</p>
<p>Also when time series contain 0 or negative values, an error term of <code class="docutils literal notranslate"><span class="pre">&quot;M&quot;</span></code> will not work.</p>
<p>For full details of the ETS formulation and associated terms, use the command <code class="docutils literal notranslate"><span class="pre">?ETS</span></code> in your r console to bring up the documentation.</p>
</section>
</section>
<section id="simple-exponential-smoothing">
<h3>Simple exponential smoothing<a class="headerlink" href="#simple-exponential-smoothing" title="Link to this heading">#</a></h3>
<p>Instead of weighting all data equally (e.g. the mean method) or only considering the final point (the naive method), simple exponential smoothing (SES) weights more recent values highly.</p>
<p>The formula for this weighting is a bit complicated, however there are two parameters of interest.</p>
<p><span class="math notranslate nohighlight">\(\alpha\)</span> is the weighting of the most recent observation. This also determines the <em>rate of decay</em> of the weighting.</p>
<p><span class="math notranslate nohighlight">\(j_0\)</span> determines the scale for the final forecast output. It is in the same units as the response variable.</p>
<p>The general weighting for <span class="math notranslate nohighlight">\(\alpha = 0.2\)</span> looks something like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.2</span>
<span class="n">weights</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">tibble</span><span class="p">(</span><span class="n">lag_amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="o">:</span><span class="m">10</span><span class="p">,</span>
<span class="w">                  </span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">alpha</span><span class="p">)</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="n">lag_amount</span><span class="p">)</span>
<span class="n">weights</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lag_amount</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">weight</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">ylim</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0.2</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_x_reverse</span><span class="p">(</span><span class="n">limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">-2</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Distance from Most recent&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Weight&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/5acd8d02fc9df45fc1e1f67273d13876469814d96a1dadb5e8dc2bbb928dda30.png"><img alt="../../_images/5acd8d02fc9df45fc1e1f67273d13876469814d96a1dadb5e8dc2bbb928dda30.png" src="../../_images/5acd8d02fc9df45fc1e1f67273d13876469814d96a1dadb5e8dc2bbb928dda30.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p><strong>Note:</strong> There is a reversed x-axis here. Time series typically proceed from left to right, and as such it is most intuitive to look at it this way (in my humble opinion).</p>
<p>A SES model can be fit using the following ETS formulation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ETS</span><span class="p">(</span><span class="n">X</span> <span class="o">~</span> <span class="n">error</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">trend</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">season</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="holt-s-linear-trend-damped-trend-approaches">
<h3>Holt’s linear trend &amp; Damped trend approaches<a class="headerlink" href="#holt-s-linear-trend-damped-trend-approaches" title="Link to this heading">#</a></h3>
<p>Holt’s linear trend is similar to a mix of the basic linear trend / drift approaches explored earlier, and a more naive approach by employing exponential smoothing.</p>
<p>In essence it fits an SES version of the trend and then calculates the difference between this and the best estimate for a given position on the time series. It then performs a set of weighted averages to calculate a local linear model that accounts for the general trend within the local region. Finally this linear model is simply extended to the number of extra time steps one wishes to forecast.</p>
<p>The damped trend variant is almost exactly the same, but with an extra condition. Holt’s linear trend tends to projects very optimistically that a given local trend with continue indefinitely. Over large scales this can lead to a trend that just shoots off in an unrealistic manner.</p>
<p>To compensate for this, the damped trend assumes that any significant change will probably level out over time, and so forces the trend to instead asymptote more and more quickly using a damping factor called <span class="math notranslate nohighlight">\(\phi\)</span>. As <span class="math notranslate nohighlight">\(\phi\)</span> approaches 0, the damping effect increases, with a value of 0 being equivalent to a truly naive model from earlier and a value of 1 simply being the Holt’s linear trend.</p>
<p>These are formulated as follows in ETS:</p>
<p>Holt’s linear trend:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ETS</span><span class="p">(</span><span class="n">X</span> <span class="o">~</span> <span class="n">error</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">trend</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">season</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>Damped method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ETS</span><span class="p">(</span><span class="n">X</span> <span class="o">~</span> <span class="n">error</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">trend</span><span class="p">(</span><span class="s2">&quot;Ad&quot;</span><span class="p">,</span> <span class="n">phi</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">)</span> <span class="o">+</span> <span class="n">season</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="holt-winters-method">
<h3>Holt-Winters’ method<a class="headerlink" href="#holt-winters-method" title="Link to this heading">#</a></h3>
<p>The final form of Exponential smoothing we will consider here is the Holt-Winters’ method.</p>
<p>This extends the previous methods to incorporate seasonality through concepts from time-series decomposition, and can be performed both additively and multiplicatively as you see in typical decomposition.</p>
<p>In essence this performs the same sort of weighted average between a smoothed trend and a local best-fit, however it also includes a seasonal component to override some of the local linearity.</p>
<p>Damping Holt-Winters’ models <em>only applies damping to the trend component</em> whilst keeping the seasonality component as is. This means that with low <span class="math notranslate nohighlight">\(\phi\)</span> values, instead of tending towards an asymptote, the seasonal component dominates the predicted response more and more.</p>
<p>Additive Holt-Winters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ETS</span><span class="p">(</span><span class="n">X</span> <span class="o">~</span> <span class="n">error</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">trend</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">season</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>Multiplicative Holt-Winters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ETS</span><span class="p">(</span><span class="n">X</span> <span class="o">~</span> <span class="n">error</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">trend</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">season</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>Damped additive Holt-Winters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ETS</span><span class="p">(</span><span class="n">X</span> <span class="o">~</span> <span class="n">error</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">trend</span><span class="p">(</span><span class="s2">&quot;Ad&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">season</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>Damped multiplicative Holt-Winters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ETS</span><span class="p">(</span><span class="n">X</span> <span class="o">~</span> <span class="n">error</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">trend</span><span class="p">(</span><span class="s2">&quot;Ad&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">season</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">addata_monthly</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">model</span><span class="p">(</span><span class="n">SNaive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">SNAIVE</span><span class="p">(</span><span class="n">temperature</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">drift</span><span class="p">()),</span>
<span class="w">        </span><span class="n">Naive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">NAIVE</span><span class="p">(</span><span class="n">temperature</span><span class="p">),</span>
<span class="w">        </span><span class="n">SES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ETS</span><span class="p">(</span><span class="n">temperature</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">trend</span><span class="p">(</span><span class="s">&quot;N&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">season</span><span class="p">(</span><span class="s">&quot;N&quot;</span><span class="p">)),</span>
<span class="w">        </span><span class="n">HoltLinear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ETS</span><span class="p">(</span><span class="n">temperature</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">trend</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">season</span><span class="p">(</span><span class="s">&quot;N&quot;</span><span class="p">)),</span>
<span class="w">        </span><span class="n">Damped50</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ETS</span><span class="p">(</span><span class="n">temperature</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">trend</span><span class="p">(</span><span class="s">&quot;Ad&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">phi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">season</span><span class="p">(</span><span class="s">&quot;N&quot;</span><span class="p">)),</span>
<span class="w">        </span><span class="n">Damped80</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ETS</span><span class="p">(</span><span class="n">temperature</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">trend</span><span class="p">(</span><span class="s">&quot;Ad&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">phi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.8</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">season</span><span class="p">(</span><span class="s">&quot;N&quot;</span><span class="p">)),</span>
<span class="w">        </span><span class="n">Damped0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ETS</span><span class="p">(</span><span class="n">temperature</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">trend</span><span class="p">(</span><span class="s">&quot;Ad&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">phi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">season</span><span class="p">(</span><span class="s">&quot;N&quot;</span><span class="p">)),</span><span class="w"> </span><span class="c1"># Same as Naive</span>
<span class="w">        </span><span class="n">Damped100</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ETS</span><span class="p">(</span><span class="n">temperature</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">trend</span><span class="p">(</span><span class="s">&quot;Ad&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">phi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">season</span><span class="p">(</span><span class="s">&quot;N&quot;</span><span class="p">)),</span><span class="w"> </span><span class="c1"># Same as HoltLinear</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">forecast</span><span class="p">(</span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">autoplot</span><span class="p">(</span><span class="n">addata_monthly</span><span class="p">,</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/09a1b08ef65700febfbe54914073d5b00f31000f43fbb9f30ce70f4e3fee975e.png"><img alt="../../_images/09a1b08ef65700febfbe54914073d5b00f31000f43fbb9f30ce70f4e3fee975e.png" src="../../_images/09a1b08ef65700febfbe54914073d5b00f31000f43fbb9f30ce70f4e3fee975e.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">addata_monthly</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">model</span><span class="p">(</span><span class="n">SNaive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">SNAIVE</span><span class="p">(</span><span class="n">temperature</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">drift</span><span class="p">()),</span><span class="w"> </span><span class="c1"># Contains exactly the noise profile from the last period</span>
<span class="w">        </span><span class="n">Additive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ETS</span><span class="p">(</span><span class="n">temperature</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">trend</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">season</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">)),</span>
<span class="w">        </span><span class="n">Multiplicative</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ETS</span><span class="p">(</span><span class="n">temperature</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="s">&quot;M&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">trend</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">season</span><span class="p">(</span><span class="s">&quot;M&quot;</span><span class="p">)),</span>
<span class="w">        </span><span class="n">AdditiveDamped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ETS</span><span class="p">(</span><span class="n">temperature</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">trend</span><span class="p">(</span><span class="s">&quot;Ad&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">season</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">)),</span>
<span class="w">        </span><span class="n">MultiplicativeDamped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ETS</span><span class="p">(</span><span class="n">temperature</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="s">&quot;M&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">trend</span><span class="p">(</span><span class="s">&quot;Ad&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">season</span><span class="p">(</span><span class="s">&quot;M&quot;</span><span class="p">))</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">forecast</span><span class="p">(</span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">autoplot</span><span class="p">(</span><span class="n">addata_monthly</span><span class="p">,</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/000c2c9eaa2c9f1022ce594740c953436968e377ff9f328af13a3df9888a5ccb.png"><img alt="../../_images/000c2c9eaa2c9f1022ce594740c953436968e377ff9f328af13a3df9888a5ccb.png" src="../../_images/000c2c9eaa2c9f1022ce594740c953436968e377ff9f328af13a3df9888a5ccb.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
</section>
<section id="a-note-on-periodicity">
<h3>A note on periodicity<a class="headerlink" href="#a-note-on-periodicity" title="Link to this heading">#</a></h3>
<p>ETS models as implemented in fable do not cope well with periods of more than 24 time steps. As such if you want to use them on data with periods longer than this you will need to reaggregate your data to a coarser time scale or move to the <code class="docutils literal notranslate"><span class="pre">forecast::stlf()</span></code> functions, however this is not covered in this tutorial.</p>
</section>
<section id="another-forecasting-exercise">
<h3>Another forecasting exercise<a class="headerlink" href="#another-forecasting-exercise" title="Link to this heading">#</a></h3>
<p>Try forecasting using some of these Exponential Smoothing models to the <code class="docutils literal notranslate"><span class="pre">aus_arrivals</span></code> dataset.</p>
<p>I’ve started you off here with a reminder that we need to filter a particular country to get just one time series:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">aus_arrivals</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">filter</span><span class="p">(</span><span class="n">Origin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Japan&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="kc">...</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="summary-statistics">
<h2>Summary Statistics<a class="headerlink" href="#summary-statistics" title="Link to this heading">#</a></h2>
<p>Just like in non-time-series-world, it can be really nice to pick out some useful summary statistics to understand a time series from a quantitative perspective.</p>
<p>Luckily, the <code class="docutils literal notranslate"><span class="pre">feasts</span></code> package provides lots of functions and methods to retrieve such statistics.</p>
<section id="basics">
<h3>Basics<a class="headerlink" href="#basics" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">features()</span></code> from <code class="docutils literal notranslate"><span class="pre">fabletools</span></code> is a function to allow one to compute arbitrary summary statistics from time series data.</p>
<p>Let’s start by simply computing a few key features of the temperature data from earlier. We’re going to use the original (non-aggregated) data for this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">addata</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">features</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span>
<span class="w">           </span><span class="n">features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="n">variance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">var</span><span class="p">,</span><span class="w"> </span><span class="n">quantile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">quantile</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 1 × 7</caption>
<thead>
	<tr><th scope=col>mean</th><th scope=col>variance</th><th scope=col>quantile_0%</th><th scope=col>quantile_25%</th><th scope=col>quantile_50%</th><th scope=col>quantile_75%</th><th scope=col>quantile_100%</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>10.19121</td><td>20.30817</td><td>-2.425439</td><td>6.671144</td><td>10.11261</td><td>13.73158</td><td>24.84771</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>If we run this same command but on <code class="docutils literal notranslate"><span class="pre">aus_arrivals</span></code>, we get one line per sub-time-series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">aus_arrivals</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">features</span><span class="p">(</span><span class="n">Arrivals</span><span class="p">,</span>
<span class="w">           </span><span class="n">features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="n">variance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">var</span><span class="p">,</span><span class="w"> </span><span class="n">quantile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">quantile</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 4 × 8</caption>
<thead>
	<tr><th scope=col>Origin</th><th scope=col>mean</th><th scope=col>variance</th><th scope=col>quantile_0%</th><th scope=col>quantile_25%</th><th scope=col>quantile_50%</th><th scope=col>quantile_75%</th><th scope=col>quantile_100%</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Japan</td><td>122080.19</td><td>4123427340</td><td> 9321</td><td>74134.5</td><td>135461</td><td>176752.5</td><td>227641</td></tr>
	<tr><td>NZ   </td><td>170585.83</td><td>7170720232</td><td>37039</td><td>96520.5</td><td>154537</td><td>228605.0</td><td>330812</td></tr>
	<tr><td>UK   </td><td>106857.46</td><td>4093754355</td><td>19886</td><td>53892.5</td><td> 95564</td><td>128127.5</td><td>269292</td></tr>
	<tr><td>US   </td><td> 84848.74</td><td> 884962742</td><td>23721</td><td>63950.0</td><td> 85878</td><td>108977.0</td><td>136094</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="autocovariance-and-autocorrelation">
<h3>Autocovariance and Autocorrelation<a class="headerlink" href="#autocovariance-and-autocorrelation" title="Link to this heading">#</a></h3>
<p>Autocovariance (ACVF) is the variance between the present value and a previous value at lag <span class="math notranslate nohighlight">\(k\)</span> in the time series, calculated across the time series.</p>
<p>Meanwhile autocorrelation (ACF) is the autocovariance at lag <span class="math notranslate nohighlight">\(k\)</span> as a proportion of the total variance of the dataset, which can be calculated as the ACVF where <span class="math notranslate nohighlight">\(k = 0\)</span>.</p>
<p>We actually already calculated autocorrelation earlier using the <code class="docutils literal notranslate"><span class="pre">ACF()</span></code> function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dfibble</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">ACF</span><span class="p">(</span><span class="n">sample_value</span><span class="p">,</span><span class="w"> </span><span class="n">lag_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">52</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tbl_cf: 52 × 2</caption>
<thead>
	<tr><th scope=col>lag</th><th scope=col>acf</th></tr>
	<tr><th scope=col>&lt;cf_lag&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1W</td><td>0.8646474</td></tr>
	<tr><td>2W</td><td>0.7640465</td></tr>
	<tr><td>3W</td><td>0.6737971</td></tr>
	<tr><td>4W</td><td>0.5468455</td></tr>
	<tr><td>5W</td><td>0.4419175</td></tr>
	<tr><td>⋮</td><td>⋮</td></tr>
	<tr><td>48W</td><td>0.4433745</td></tr>
	<tr><td>49W</td><td>0.5246661</td></tr>
	<tr><td>50W</td><td>0.6038654</td></tr>
	<tr><td>51W</td><td>0.6344849</td></tr>
	<tr><td>52W</td><td>0.6519339</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dfibble</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">ACF</span><span class="p">(</span><span class="n">sample_value</span><span class="p">,</span><span class="w"> </span><span class="n">lag_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">52</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">autoplot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/b436a3993f1d38c9eaa2572ca6f9fc5d6aaf9e3d0911a5f1938a1f0bbe72f59a.png"><img alt="../../_images/b436a3993f1d38c9eaa2572ca6f9fc5d6aaf9e3d0911a5f1938a1f0bbe72f59a.png" src="../../_images/b436a3993f1d38c9eaa2572ca6f9fc5d6aaf9e3d0911a5f1938a1f0bbe72f59a.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>ACVF can be calculated using the same function, just with an extra argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dfibble</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">ACF</span><span class="p">(</span><span class="n">sample_value</span><span class="p">,</span><span class="w"> </span><span class="n">lag_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">52</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;covariance&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">autoplot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/82badd662356781e645d2bd5d49e7ad6ea47ef1cb694c5392d530aff26203636.png"><img alt="../../_images/82badd662356781e645d2bd5d49e7ad6ea47ef1cb694c5392d530aff26203636.png" src="../../_images/82badd662356781e645d2bd5d49e7ad6ea47ef1cb694c5392d530aff26203636.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>You can see that the shape of the plot remains the same, though the units on the y axis are different.</p>
</section>
<section id="cross-correlation">
<h3>Cross-correlation<a class="headerlink" href="#cross-correlation" title="Link to this heading">#</a></h3>
<p>Cross-correlation is closely related to autocorrelation, however instead of looking at within-time-series correlation, we look between two time series and various lag intervals.</p>
<p>As an example for this let’s use a new dataset.</p>
<p><code class="docutils literal notranslate"><span class="pre">pelt</span></code> is the lynx and hare fur trading records for the (recently defunct) Hudson Bay Company between 1845 and 1935.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">pelt</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">CCF</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Lynx</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Hare</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">autoplot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/3f16d545b21d43f70468c174c96566d638604ffbaed95eb7d3837b8b0cb6818f.png"><img alt="../../_images/3f16d545b21d43f70468c174c96566d638604ffbaed95eb7d3837b8b0cb6818f.png" src="../../_images/3f16d545b21d43f70468c174c96566d638604ffbaed95eb7d3837b8b0cb6818f.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>This CCF plot is sinusoidal with the first peak at +1Y.</p>
<p>If we assume that animals are captured at a rate equal to their population size, then the fur trade rate is a proxy for the population of that animal.</p>
<p>This plot is thus showing that the lynx population is most strongly correlated with the hare population from the previous year.</p>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Lotka%E2%80%93Volterra_equations">There <em>might</em> be some classic research about such problems, but using ODEs.</a></p>
</section>
<section id="decomposition-statistics">
<h3>Decomposition statistics<a class="headerlink" href="#decomposition-statistics" title="Link to this heading">#</a></h3>
<p>We learnt earlier how to decompose time series into their component parts. We <em>were</em> doing the evaluation visually to establish what the most important components were, however there are also statistical methods to do this using <code class="docutils literal notranslate"><span class="pre">feat_stl()</span></code>.</p>
<p>The <em>strength of trend</em> (<span class="math notranslate nohighlight">\(F_t\)</span>) and <em>strength of seasonality</em> (<span class="math notranslate nohighlight">\(F_s\)</span>) are two measures that determine the scale of effect of the trend/seasonality components with the remainder component.</p>
<p>If <span class="math notranslate nohighlight">\(F_t \approx 1\)</span> then the scale of the trend is much greater than the scale of the remainder, indicating that the trend contributes a lot to the data. Conversely if <span class="math notranslate nohighlight">\(F_t \approx 0\)</span> then the scale of the remainder is much larger than the scale of the trend.</p>
<p>The same is true for <span class="math notranslate nohighlight">\(F_s \approx 0\)</span> and <span class="math notranslate nohighlight">\(F_s \approx 1\)</span>, but for seasonality.</p>
<p>Here’s an example for the temperature data from ArEAData.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">addata_monthly</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">features</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span><span class="w"> </span><span class="n">feat_stl</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 1 × 9</caption>
<thead>
	<tr><th scope=col>trend_strength</th><th scope=col>seasonal_strength_year</th><th scope=col>seasonal_peak_year</th><th scope=col>seasonal_trough_year</th><th scope=col>spikiness</th><th scope=col>linearity</th><th scope=col>curvature</th><th scope=col>stl_e_acf1</th><th scope=col>stl_e_acf10</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>0.311238</td><td>0.9651362</td><td>8</td><td>1</td><td>0.0001611059</td><td>1.34826</td><td>0.8500155</td><td>-0.2656128</td><td>0.7222275</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>And another with the <code class="docutils literal notranslate"><span class="pre">aus_arrivals</span></code> dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">aus_arrivals</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">    </span><span class="nf">features</span><span class="p">(</span><span class="n">Arrivals</span><span class="p">,</span><span class="w"> </span><span class="n">feat_stl</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 4 × 10</caption>
<thead>
	<tr><th scope=col>Origin</th><th scope=col>trend_strength</th><th scope=col>seasonal_strength_year</th><th scope=col>seasonal_peak_year</th><th scope=col>seasonal_trough_year</th><th scope=col>spikiness</th><th scope=col>linearity</th><th scope=col>curvature</th><th scope=col>stl_e_acf1</th><th scope=col>stl_e_acf10</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Japan</td><td>0.9911384</td><td>0.8490948</td><td>1</td><td>2</td><td>654951181553</td><td>362049.5</td><td>-557064.92</td><td>-0.2862755</td><td>0.3486182</td></tr>
	<tr><td>NZ   </td><td>0.9950089</td><td>0.9519672</td><td>3</td><td>1</td><td>197493298617</td><td>881175.6</td><td>  75837.03</td><td>-0.3653883</td><td>0.3927299</td></tr>
	<tr><td>UK   </td><td>0.9900745</td><td>0.9814662</td><td>0</td><td>2</td><td>185194378337</td><td>552140.9</td><td> -43793.71</td><td>-0.5335206</td><td>0.6558278</td></tr>
	<tr><td>US   </td><td>0.9799245</td><td>0.7485080</td><td>0</td><td>2</td><td> 68689116838</td><td>300476.1</td><td> -54026.02</td><td>-0.3232904</td><td>0.6179408</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>We can see here that whilst all time series have a strong trend strength, NZ and the UK have a stronger seasonal strength.</p>
<p>This plays out in the seasonal plot below as well!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">aus_arrivals</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">gg_season</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Plot variable not specified, automatically selected `y = Arrivals`
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/1b64e82630ae7f0560977bcc758c520ab68ba282e204ec66f14aef14386c8ef9.png"><img alt="../../_images/1b64e82630ae7f0560977bcc758c520ab68ba282e204ec66f14aef14386c8ef9.png" src="../../_images/1b64e82630ae7f0560977bcc758c520ab68ba282e204ec66f14aef14386c8ef9.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
</section>
<section id="others">
<h3>Others<a class="headerlink" href="#others" title="Link to this heading">#</a></h3>
<p>There are many other statistics that can be calculated for a time series.</p>
<p>For example here we generate more than 45 summary statistics for <code class="docutils literal notranslate"><span class="pre">aus_arrivals</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">aus_arrivals</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">    </span><span class="nf">features</span><span class="p">(</span><span class="n">Arrivals</span><span class="p">,</span><span class="w"> </span><span class="nf">feature_set</span><span class="p">(</span><span class="n">pkgs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;feasts&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">colnames</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>'Origin'</li><li>'trend_strength'</li><li>'seasonal_strength_year'</li><li>'seasonal_peak_year'</li><li>'seasonal_trough_year'</li><li>'spikiness'</li><li>'linearity'</li><li>'curvature'</li><li>'stl_e_acf1'</li><li>'stl_e_acf10'</li><li>'acf1'</li><li>'acf10'</li><li>'diff1_acf1'</li><li>'diff1_acf10'</li><li>'diff2_acf1'</li><li>'diff2_acf10'</li><li>'season_acf1'</li><li>'pacf5'</li><li>'diff1_pacf5'</li><li>'diff2_pacf5'</li><li>'season_pacf'</li><li>'zero_run_mean'</li><li>'nonzero_squared_cv'</li><li>'zero_start_prop'</li><li>'zero_end_prop'</li><li>'lambda_guerrero'</li><li>'kpss_stat'</li><li>'kpss_pvalue'</li><li>'pp_stat'</li><li>'pp_pvalue'</li><li>'ndiffs'</li><li>'nsdiffs'</li><li>'bp_stat'</li><li>'bp_pvalue'</li><li>'lb_stat'</li><li>'lb_pvalue'</li><li>'var_tiled_var'</li><li>'var_tiled_mean'</li><li>'shift_level_max'</li><li>'shift_level_index'</li><li>'shift_var_max'</li><li>'shift_var_index'</li><li>'shift_kl_max'</li><li>'shift_kl_index'</li><li>'spectral_entropy'</li><li>'n_crossing_points'</li><li>'longest_flat_spot'</li><li>'coef_hurst'</li><li>'stat_arch_lm'</li></ol>
</div></div>
</div>
<p>Generally speaking, like with normal datasets, you will want to pick the summary statistics that accurately represent aspects of your time series that you care about.</p>
</section>
</section>
<section id="autoregressive-and-arima-models">
<h2>Autoregressive and ArIMA models<a class="headerlink" href="#autoregressive-and-arima-models" title="Link to this heading">#</a></h2>
<p>In <code class="docutils literal notranslate"><span class="pre">fable</span></code>, all types of autoregressive models are fit using the ArIMA command. This is because at a fundamental level, autoregressive models and moving average models are strict subsets of the general ArIMA model (which stands for <em>Autoregressive Integrated Moving Average model</em>).</p>
<p>This is analagous to the similar concept that <a class="reference external" href="https://lindeloev.github.io/tests-as-linear/linear_tests_cheat_sheet.png">nearly every frequentist statistical text can be a GLM</a>.</p>
<p>Given this, it makes sense to explain each component of the ArIMA model and how they fit together.</p>
<section id="autoregression-ar">
<h3>Autoregression (Ar)<a class="headerlink" href="#autoregression-ar" title="Link to this heading">#</a></h3>
<p>The Autoregressive term of an ArIMA model enables it to account for autocorrelation in the time series.</p>
<p>The formula for an Ar model of order <span class="math notranslate nohighlight">\(p\)</span> (aka Ar(p)) is:</p>
<div class="math notranslate nohighlight">
\[X_t = \alpha + \phi_1 X_{t-1} + \phi_2 X_{t-2} + \cdots + \phi_p X_{t-p} + W_t\]</div>
<p>Where <span class="math notranslate nohighlight">\(\alpha\)</span> is the intercept term indicating drift, <span class="math notranslate nohighlight">\(\phi_n\)</span> is the autoregressive coefficient at time <span class="math notranslate nohighlight">\(t-n\)</span>, <span class="math notranslate nohighlight">\(X_t\)</span> is the value of the trend at time <span class="math notranslate nohighlight">\(t\)</span>, and <span class="math notranslate nohighlight">\(W_t\)</span> is a white noise error term at time <span class="math notranslate nohighlight">\(t\)</span>.</p>
<p>Ar models on their own are relatively powerful, however they essentially assume that the error term is completely independent. This is often not true however, which leads us to the next part.</p>
</section>
<section id="moving-averages-ma">
<h3>Moving Averages (MA)<a class="headerlink" href="#moving-averages-ma" title="Link to this heading">#</a></h3>
<p>The moving average (MA) element of an ArIMA model replaces the <span class="math notranslate nohighlight">\(W_t\)</span> term above with another polynomial equation in the following form:</p>
<div class="math notranslate nohighlight">
\[W_t + \theta_1 W_{t-1} + \theta_2 W_{t-2} + \cdots + \theta_q W_{t-q}\]</div>
<p>Where <span class="math notranslate nohighlight">\(\theta_t\)</span> is a constant coefficient of the white noise at time <span class="math notranslate nohighlight">\(t\)</span> and <span class="math notranslate nohighlight">\(W_t\)</span> is the white noise at the same time.</p>
<p>This extra polynomial allows the error at time <span class="math notranslate nohighlight">\(t\)</span> to be dependent on the error terms that came previously (i.e. there is now an effect of the trend on the error term).</p>
<p>When combined together, these two elements form something known as an ArMA model, with the full equation (for an ArMA(p,q) model) of:</p>
<div class="math notranslate nohighlight">
\[X_t = \alpha + \phi_1 X_{t-1} + \phi_2 X_{t-2} + \cdots + \phi_p X_{t-p} + \mu +W_t + \theta_1 W_{t-1} + \theta_2 W_{t-2} + \cdots + \theta_q W_{t-q}\]</div>
<p>You do not <em>need</em> to know this formula as such, only to be aware that this is how an ArMA model is defined.</p>
<p>ArMA models are generally very capable when a time series is <em>stationary</em> (i.e. where the mean and variance do not change over time)
, however many time series are really not like this at all!</p>
<p>This is where the final part of the ArIMA puzzle comes in: <em>differencing</em></p>
</section>
<section id="differencing-i">
<h3>Differencing (I)<a class="headerlink" href="#differencing-i" title="Link to this heading">#</a></h3>
<p>Differencing is the process of taking the difference between subsequent elements of a vector to produce a new vector of “changes”.</p>
<p>So for a vector <span class="math notranslate nohighlight">\(\vec{V}\)</span>, the first order difference (<span class="math notranslate nohighlight">\(d=1\)</span>) is defined by <span class="math notranslate nohighlight">\(V_t' = V_t - V_{t - 1}\)</span></p>
<p>And you can do this process again on the first order differences to get the second order difference vector.</p>
<p>The second order difference (the difference of differences, <span class="math notranslate nohighlight">\(d = 2\)</span>) is thus found by <span class="math notranslate nohighlight">\(V^*_t = V_t' - V_{t - 1}'\)</span></p>
<p>As an example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">v</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">)</span><span class="w">  </span><span class="c1"># y = x^2 + x + 0</span>
<span class="nf">print</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w">              </span><span class="c1"># Original vector</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">diff</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="w">        </span><span class="c1"># First order difference</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">diff</span><span class="p">(</span><span class="nf">diff</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span><span class="w">  </span><span class="c1"># Second order difference</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1]  2  6 12 20 30
[1]  4  6  8 10
[1] 2 2 2
</pre></div>
</div>
</div>
</div>
<p>You can see here how whilst the vector on its own changes over time, the second order difference stays at a constant value and variance.</p>
<p>We’ve converted this non-stationary process into a stationary representation! This will behave nicely with the ArMA model we created above.</p>
<section id="seasonal-differencing">
<h4>Seasonal Differencing<a class="headerlink" href="#seasonal-differencing" title="Link to this heading">#</a></h4>
<p>Another type of differencing that is important within ArIMA modelling is called <em>seasonal differencing</em>.</p>
<p>Instead of differencing with the previous neighbor in the time series, seasonal differencing attempts to address a lack of <em>seasonal stationarity</em> (i.e. the seasonal component of a time series varies in mean or variance over time).</p>
<p>If a time series of period <span class="math notranslate nohighlight">\(m\)</span> is seasonally stationary, the following will be true:</p>
<div class="math notranslate nohighlight">
\[V_t = V_{t-m}\]</div>
<p>Seasonal differencing takes values at the same relative position within adjacent seasonal periods and finds the difference between them:</p>
<div class="math notranslate nohighlight">
\[V_t' = V_t - V_{t-m}\]</div>
<p>You can of course do higher order differencing in a seasonal manner too:</p>
<div class="math notranslate nohighlight">
\[V^*_t = V_t' - V_{t-m}'\]</div>
<p>When using an ArIMA model, the fitting of the ArMA model is performed on the differenced values of the time series rather than the time series itself. Forecasting then explodes back out this second order model back to the scale of the original data.</p>
</section>
</section>
<section id="notation">
<h3>Notation<a class="headerlink" href="#notation" title="Link to this heading">#</a></h3>
<p>When put all together, an ArIMA model is typically written in the following form:</p>
<div class="math notranslate nohighlight">
\[\text{ArIMA}(p,d,q)\]</div>
<p>Where <span class="math notranslate nohighlight">\(p\)</span> is the order of the autoregressive polynomial (i.e. the number of lag terms), <span class="math notranslate nohighlight">\(d\)</span> is the order of differencing, and <span class="math notranslate nohighlight">\(q\)</span> is the order of the moving average polynomial.</p>
<p>As a very simple example, an ArIMA(1,0,0) model is functionally exactly the same as an Ar(1) model, which would be formulated as:</p>
<div class="math notranslate nohighlight">
\[X_t = \alpha + \phi_1 X_{t-1} + W_t\]</div>
<p>Meanwhile an ArIMA(2,0,1) model would be:</p>
<div class="math notranslate nohighlight">
\[X_t = \alpha + \phi_1 X_{t-1} + \phi_2 X_{t-2} + \mu + W_t + \theta_1 W_{t-1}\]</div>
</section>
</section>
<section id="sarima-models">
<h2>SArIMA models<a class="headerlink" href="#sarima-models" title="Link to this heading">#</a></h2>
<p>ArIMA models can be extended further to account for a seasonal component. This creates a Seasonal ArIMA (or SArIMA) model.</p>
<p>In effect this adds two extra polynomial terms, one for the autoregressive element of the seasonal signal, and one moving average for effect of seasonality on the error term.</p>
<p>The parameterisation is possibly a little too much for this brief time (phew!) but it does follow a similar structure to the ArMA model above with extra terms, called (P,D,Q). These are exactly the same as (p,d,q) in the ArIMA model, but parameterising the seasonal effects instead (with <span class="math notranslate nohighlight">\(D\)</span> controlling the order of <em>seasonal</em> differencing.</p>
<p>As such a SArIMA model is usually written:</p>
<div class="math notranslate nohighlight">
\[\text{ArIMA}(p,d,q)(P,D,Q)_m\]</div>
<p>where <span class="math notranslate nohighlight">\(m\)</span> is the period of the seasonality.</p>
<p>Now, before we start actually fitting ArIMA models, there is one more step that’s worth talking about.</p>
</section>
<section id="testing-for-stationarity">
<h2>Testing for stationarity<a class="headerlink" href="#testing-for-stationarity" title="Link to this heading">#</a></h2>
<p>Sometimes differencing when it is not required can cause problems, as such it is worthwhile knowing at least how to quickly test for the order of differencing required for generating a stationary series.</p>
<p>We can do this by performing a KPSS test (which tests for stationarity) alongside two tests for something called “unit roots” (which allows us to calculate the number of differences required for stationarity).</p>
<p>Luckily <code class="docutils literal notranslate"><span class="pre">feasts</span></code> makes this super easy. Let’s look at the <code class="docutils literal notranslate"><span class="pre">aus_lifestock</span></code> dataset as a quick example.</p>
<p>This dataset is a quarterly time series dataset recording the number of each type of livestock animal in Australia, stratified by state.</p>
<p>Here, we focus on the time series measuring the number of calves and have computed the KPSS test statistic and p-value. <code class="docutils literal notranslate"><span class="pre">unitroot_ndiffs</span></code> calculates the appropriate number of differences based on this value, while unitroot_nsdiffs calculates the appropriate number of <em>seasonal</em> differences based on the seasonal strength of an STL decomposition.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">aus_livestock</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">filter</span><span class="p">(</span><span class="n">Animal</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Calves&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">features</span><span class="p">(</span><span class="n">Count</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">unitroot_kpss</span><span class="p">,</span><span class="w"> </span><span class="n">unitroot_ndiffs</span><span class="p">,</span><span class="w"> </span><span class="n">unitroot_nsdiffs</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 8 × 6</caption>
<thead>
	<tr><th scope=col>Animal</th><th scope=col>State</th><th scope=col>kpss_stat</th><th scope=col>kpss_pvalue</th><th scope=col>ndiffs</th><th scope=col>nsdiffs</th></tr>
	<tr><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Calves</td><td>Australian Capital Territory</td><td>3.6182325</td><td>0.01</td><td>1</td><td>0</td></tr>
	<tr><td>Calves</td><td>New South Wales             </td><td>3.0957579</td><td>0.01</td><td>1</td><td>0</td></tr>
	<tr><td>Calves</td><td>Northern Territory          </td><td>2.2056502</td><td>0.01</td><td>1</td><td>0</td></tr>
	<tr><td>Calves</td><td>Queensland                  </td><td>5.7474784</td><td>0.01</td><td>1</td><td>0</td></tr>
	<tr><td>Calves</td><td>South Australia             </td><td>6.0752417</td><td>0.01</td><td>1</td><td>0</td></tr>
	<tr><td>Calves</td><td>Tasmania                    </td><td>0.0889697</td><td>0.10</td><td>0</td><td>1</td></tr>
	<tr><td>Calves</td><td>Victoria                    </td><td>2.0403177</td><td>0.01</td><td>1</td><td>1</td></tr>
	<tr><td>Calves</td><td>Western Australia           </td><td>4.2110969</td><td>0.01</td><td>1</td><td>0</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>The KPSS test has stationarity as a null assumption. The p value is just like any other statistical test, <code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">&lt;</span> <span class="pre">0.05</span></code> is considered to be significant and thus a rejection of the null (i.e. we should assume nonstationarity).</p>
<p>We can see here that Tasmania seems to have a stationary level but nonstationary seasonality (kpss p &gt; 0.05, nsdiffs &gt; 0). Meanwhile Queensland has a nonstationary level but with stationary seasonality (ndiffs &gt; 0, nsdiffs = 0). Finally Victoria has both non-stationary seasonality and a non-stationary level (ndiffs &gt; 0, nsdiffs &gt; 0). Let’s check this by plotting part of the dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">aus_livestock</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">filter</span><span class="p">(</span><span class="n">Animal</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Calves&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">State</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Victoria&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Tasmania&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Queensland&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">filter_index</span><span class="p">(</span><span class="s">&quot;2005 Jan&quot;</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&quot;2015 Jan&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">select</span><span class="p">(</span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">State</span><span class="p">,</span><span class="w"> </span><span class="n">Count</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">    </span><span class="nf">autoplot</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">Count</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/f0fca6d82526ef4bf8041049c7b8916ed4bb9772c22f6a55384dce6977bf20ff.png"><img alt="../../_images/f0fca6d82526ef4bf8041049c7b8916ed4bb9772c22f6a55384dce6977bf20ff.png" src="../../_images/f0fca6d82526ef4bf8041049c7b8916ed4bb9772c22f6a55384dce6977bf20ff.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>This suggests some appropriate values of <span class="math notranslate nohighlight">\(d\)</span> and <span class="math notranslate nohighlight">\(D\)</span> when modelling these time series using a SArIMA model.</p>
</section>
<section id="fitting-s-arima-models">
<h2>Fitting (S)ArIMA models<a class="headerlink" href="#fitting-s-arima-models" title="Link to this heading">#</a></h2>
<p>The act of actually fitting an ArIMA model involves (your computer) trying to set values for the parameters in your model such that the model outputs best fit the data you have provided, just like any other model fitting.</p>
<p>So for an ArIMA(2,0,1) model:
$<span class="math notranslate nohighlight">\(X_t = \alpha + \phi_1 X_{t-1} + \phi_2 X_{t-2} + \mu + W_t + \theta_1 W_{t-1}\)</span><span class="math notranslate nohighlight">\(
the fit parameters would be \)</span>\alpha<span class="math notranslate nohighlight">\(, \)</span>\mu<span class="math notranslate nohighlight">\(, \)</span>\phi_1<span class="math notranslate nohighlight">\(, \)</span>\phi_2<span class="math notranslate nohighlight">\( and \)</span>\theta_1$.</p>
<p>r does this automatically (using maximum likelihood fitting by default).</p>
<p>It also tries to work out the best values for (p,d,q)(P,D,Q) if they are not specified by the user!</p>
<p>So you actually don’t <em>need</em> to tell it much about the model you want at all, it can usually work it out. However if you can specify some of these “hyperparameters” before it starts, it will have a much easier (and quicker) time fitting!</p>
</section>
<section id="fitting-s-arima-models-using-fable">
<h2>Fitting (S)ArIMA models using <code class="docutils literal notranslate"><span class="pre">fable</span></code><a class="headerlink" href="#fitting-s-arima-models-using-fable" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">fable</span></code> provides an <em>exceptionally</em> easy interface for fitting ArIMA-style models to data: the <code class="docutils literal notranslate"><span class="pre">ArIMA()</span></code> command.</p>
<p>More explicitly, an ArIMA model is specified as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ArIMA</span><span class="p">(</span><span class="n">X</span> <span class="o">~</span> <span class="n">pdq</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">PDQ</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span>
</pre></div>
</div>
<p>The arguments here have the following meanings:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">X</span></code>: column name of the time series being modeled</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p</span></code>: the non-seasonal autoregressive order</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">q</span></code>: the non-seasonal moving average order</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">d</span></code>: the order of non-seasonal differencing</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">P</span></code>: the seasonal autoregressive order</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Q</span></code>: the seasonal moving average order</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">D</span></code>: the order of seasonal differencing</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">m</span></code>: the period of the seasonality</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">k</span></code>: 1 if a mean (drift) parameter is to be fit, otherwise 0</p></li>
</ul>
<p>If any of these hyperparameters is not specified, it will be automatically estimated from the data.</p>
<p>You can also provide ranges of values for the fitter to attempt (rather than allowing it to try everything). So <code class="docutils literal notranslate"><span class="pre">pdq(0:2,</span> <span class="pre">1,</span> <span class="pre">2)</span></code> would tell the ArIMA model that <span class="math notranslate nohighlight">\(d=1\)</span> and <span class="math notranslate nohighlight">\(q=2\)</span>, but <span class="math notranslate nohighlight">\(p\)</span> can be 0, 1, or 2.</p>
<p>Importantly, if the <code class="docutils literal notranslate"><span class="pre">PDQ()</span></code> element of the model is not specified, <em><code class="docutils literal notranslate"><span class="pre">fable</span></code> assumes that it should exist, and so tries to estimate it!!!</em></p>
<p>If you wish to specify a non-seasonal ArIMA, you must specify a term <code class="docutils literal notranslate"><span class="pre">PDQ(0,</span> <span class="pre">0,</span> <span class="pre">0)</span></code>. Simply omitting the PDQ element of the formula is not enough.</p>
<section id="fitting-time">
<h3>Fitting time!<a class="headerlink" href="#fitting-time" title="Link to this heading">#</a></h3>
<p>Let’s do a simple fit of an ArIMA model to some data, specifically the monthly ArEAdata temperatures from earlier!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">addata_monthly</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">autoplot</span><span class="p">(</span><span class="n">.vars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temperature</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/ecf9af4dc34e30e2f29dbfbf9986e349494e17084eeb4b84905f7c95cc8829ae.png"><img alt="../../_images/ecf9af4dc34e30e2f29dbfbf9986e349494e17084eeb4b84905f7c95cc8829ae.png" src="../../_images/ecf9af4dc34e30e2f29dbfbf9986e349494e17084eeb4b84905f7c95cc8829ae.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>First let’s check the stationarity of the data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">addata_monthly</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">features</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">unitroot_kpss</span><span class="p">,</span><span class="w"> </span><span class="n">unitroot_ndiffs</span><span class="p">,</span><span class="w"> </span><span class="n">unitroot_nsdiffs</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 1 × 4</caption>
<thead>
	<tr><th scope=col>kpss_stat</th><th scope=col>kpss_pvalue</th><th scope=col>ndiffs</th><th scope=col>nsdiffs</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>0.06868486</td><td>0.1</td><td>0</td><td>1</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Straight away here it looks like the overall trend might not be stationary, which makes sense if the seasonal component here is huge (which it is). We also see that 1 seasonal difference is generally a good call here.</p>
<p>Now let’s just let ArIMA decide what parameters to use. This will take a bit of time because it actually needs to fit a bunch of models before deciding which is the best.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">addata_arimafit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">addata_monthly</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">model</span><span class="p">(</span><span class="n">arima</span><span class="o">=</span><span class="nf">ArIMA</span><span class="p">(</span><span class="n">temperature</span><span class="p">))</span><span class="w"> </span>
<span class="n">addata_arimafit</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A mdl_df: 1 × 1</caption>
<thead>
	<tr><th scope=col>arima</th></tr>
	<tr><th scope=col>&lt;model&gt;</th></tr>
</thead>
<tbody>
	<tr><td>&lt;ArIMA(0,0,0)(1,1,0)[12] w/ drift&gt;</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>So <code class="docutils literal notranslate"><span class="pre">&lt;ArIMA(0,0,0)(1,1,0)[12]</span> <span class="pre">w/</span> <span class="pre">drift&gt;</span></code> is saying that the best fit it found was a model with no major trend components (p,d,q), but with seasonal PDQ parameters of 1,1,0 (i.e. there is a 1-period component to the trend of the first order differences in seasonality). It also decided that drift was useful here.</p>
<p>Let’s have a look to see what that fit looks like by forecasting ahead</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">addata_arimafit</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">forecast</span><span class="p">(</span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">autoplot</span><span class="p">(</span><span class="n">addata_monthly</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/349cfef6afb0ee65ed695b6bc3dedfea088376dd0062e803d0e557f0ea2422a7.png"><img alt="../../_images/349cfef6afb0ee65ed695b6bc3dedfea088376dd0062e803d0e557f0ea2422a7.png" src="../../_images/349cfef6afb0ee65ed695b6bc3dedfea088376dd0062e803d0e557f0ea2422a7.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>Yeah, that looks like a pretty accurate model indeed!</p>
<p>Let’s explicitly fit this same model and see what that looks like:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">addata_arimafit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">addata_monthly</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">model</span><span class="p">(</span><span class="n">arima</span><span class="o">=</span><span class="nf">ArIMA</span><span class="p">(</span><span class="n">temperature</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">pdq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">PDQ</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">period</span><span class="o">=</span><span class="m">12</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">))</span>
<span class="n">addata_arimafit</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A mdl_df: 1 × 1</caption>
<thead>
	<tr><th scope=col>arima</th></tr>
	<tr><th scope=col>&lt;model&gt;</th></tr>
</thead>
<tbody>
	<tr><td>&lt;ArIMA(0,0,0)(1,1,0)[12] w/ drift&gt;</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">addata_arimafit</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">forecast</span><span class="p">(</span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">autoplot</span><span class="p">(</span><span class="n">addata_monthly</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/349cfef6afb0ee65ed695b6bc3dedfea088376dd0062e803d0e557f0ea2422a7.png"><img alt="../../_images/349cfef6afb0ee65ed695b6bc3dedfea088376dd0062e803d0e557f0ea2422a7.png" src="../../_images/349cfef6afb0ee65ed695b6bc3dedfea088376dd0062e803d0e557f0ea2422a7.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>Amazing, now let’s fit a few models to the <code class="docutils literal notranslate"><span class="pre">vecdyn</span></code> data we retrieved before.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dfibble</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">features</span><span class="p">(</span><span class="n">sample_value</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">unitroot_kpss</span><span class="p">,</span><span class="w"> </span><span class="n">unitroot_ndiffs</span><span class="p">,</span><span class="w"> </span><span class="n">unitroot_nsdiffs</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 1 × 4</caption>
<thead>
	<tr><th scope=col>kpss_stat</th><th scope=col>kpss_pvalue</th><th scope=col>ndiffs</th><th scope=col>nsdiffs</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>0.1415662</td><td>0.1</td><td>0</td><td>1</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dfibble_arimafit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dfibble</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">model</span><span class="p">(</span>
<span class="w">  </span><span class="n">search</span><span class="o">=</span><span class="nf">ArIMA</span><span class="p">(</span><span class="n">sample_value</span><span class="p">),</span>
<span class="w">  </span><span class="n">moreAr</span><span class="o">=</span><span class="nf">ArIMA</span><span class="p">(</span><span class="n">sample_value</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">pdq</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">PDQ</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">)),</span>
<span class="w">  </span><span class="n">moreMA</span><span class="o">=</span><span class="nf">ArIMA</span><span class="p">(</span><span class="n">sample_value</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">pdq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">PDQ</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">)),</span>
<span class="w">  </span><span class="n">moreSAr</span><span class="o">=</span><span class="nf">ArIMA</span><span class="p">(</span><span class="n">sample_value</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">pdq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">PDQ</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0</span><span class="p">),</span>
<span class="w">  </span><span class="n">moreSMA</span><span class="o">=</span><span class="nf">ArIMA</span><span class="p">(</span><span class="n">sample_value</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">pdq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">PDQ</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0</span><span class="p">),</span>
<span class="w">  </span><span class="n">silly</span><span class="o">=</span><span class="nf">ArIMA</span><span class="p">(</span><span class="n">sample_value</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">pdq</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">PDQ</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span>

<span class="n">dfibble_arimafit</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A mdl_df: 1 × 6</caption>
<thead>
	<tr><th scope=col>search</th><th scope=col>moreAr</th><th scope=col>moreMA</th><th scope=col>moreSAr</th><th scope=col>moreSMA</th><th scope=col>silly</th></tr>
	<tr><th scope=col>&lt;model&gt;</th><th scope=col>&lt;model&gt;</th><th scope=col>&lt;model&gt;</th><th scope=col>&lt;model&gt;</th><th scope=col>&lt;model&gt;</th><th scope=col>&lt;model&gt;</th></tr>
</thead>
<tbody>
	<tr><td>&lt;ArIMA(1,0,0)(1,1,0)[52]&gt;</td><td>&lt;ArIMA(2,0,0)(1,1,0)[52]&gt;</td><td>&lt;ArIMA(1,0,1)(1,1,0)[52]&gt;</td><td>&lt;ArIMA(1,0,0)(2,1,0)[52]&gt;</td><td>&lt;ArIMA(1,0,0)(1,1,1)[52]&gt;</td><td>&lt;ArIMA(2,1,1)(1,1,0)[52]&gt;</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dfibble_arimafit</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">tidy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dfibble_arimafit</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">tidy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 18 × 6</caption>
<thead>
	<tr><th scope=col>.model</th><th scope=col>term</th><th scope=col>estimate</th><th scope=col>std.error</th><th scope=col>statistic</th><th scope=col>p.value</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>search</td><td>ar1 </td><td> 0.613382266</td><td>0.03765503</td><td>16.2895154</td><td>4.150617e-47</td></tr>
	<tr><td>search</td><td>sar1</td><td>-0.385064961</td><td>0.04477982</td><td>-8.5990742</td><td>1.390762e-16</td></tr>
	<tr><td>moreAr</td><td>ar1 </td><td> 0.609294563</td><td>0.04770281</td><td>12.7727172</td><td>4.889723e-32</td></tr>
	<tr><td>moreAr</td><td>ar2 </td><td> 0.006607616</td><td>0.04737006</td><td> 0.1394893</td><td>8.891268e-01</td></tr>
	<tr><td>moreAr</td><td>sar1</td><td>-0.385210177</td><td>0.04478403</td><td>-8.6015072</td><td>1.365717e-16</td></tr>
	<tr><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td></tr>
	<tr><td>moreSMA</td><td>sma1</td><td>-0.749868040</td><td>0.085181644</td><td>  -8.8031647</td><td>2.991816e-17</td></tr>
	<tr><td>silly  </td><td>ar1 </td><td> 0.608533569</td><td>0.047945291</td><td>  12.6922489</td><td>1.063571e-31</td></tr>
	<tr><td>silly  </td><td>ar2 </td><td> 0.005824165</td><td>0.047595380</td><td>   0.1223683</td><td>9.026628e-01</td></tr>
	<tr><td>silly  </td><td>ma1 </td><td>-0.999992874</td><td>0.008257723</td><td>-121.0978922</td><td>0.000000e+00</td></tr>
	<tr><td>silly  </td><td>sar1</td><td>-0.384976432</td><td>0.044908812</td><td>  -8.5724029</td><td>1.706716e-16</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dfibble_arimafit</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">forecast</span><span class="p">(</span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">52</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">autoplot</span><span class="p">(</span><span class="n">dfibble</span><span class="p">,</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/ad1324641ae8081c755063f0f6a837e7e219a00da7a3554a54ca5ed88af04ce2.png"><img alt="../../_images/ad1324641ae8081c755063f0f6a837e7e219a00da7a3554a54ca5ed88af04ce2.png" src="../../_images/ad1324641ae8081c755063f0f6a837e7e219a00da7a3554a54ca5ed88af04ce2.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>We can also inspect the AICc values (indicating which model fits the best) of our models using the <code class="docutils literal notranslate"><span class="pre">glance()</span></code> command, to determine generally the best model for the job.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dfibble_arimafit</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">glance</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">select</span><span class="p">(</span><span class="n">.model</span><span class="p">,</span><span class="w"> </span><span class="n">AICc</span><span class="p">)</span><span class="w">  </span><span class="c1"># Only required when working in a jupyter notebook</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 6 × 2</caption>
<thead>
	<tr><th scope=col>.model</th><th scope=col>AICc</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>search </td><td>3992.580</td></tr>
	<tr><td>moreAr </td><td>3994.597</td></tr>
	<tr><td>moreMA </td><td>3994.591</td></tr>
	<tr><td>moreSAr</td><td>3977.231</td></tr>
	<tr><td>moreSMA</td><td>3957.774</td></tr>
	<tr><td>silly  </td><td>3992.145</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Generally with AIC, a model that has an AIC score 2 below another is considered to be a better model for the data at hand. So here, <code class="docutils literal notranslate"><span class="pre">search</span></code> (the <code class="docutils literal notranslate"><span class="pre">ArIMA(1,0,0)(1,1,0)</span></code> model) is the best with an AICc of &gt;2 below the second best (<code class="docutils literal notranslate"><span class="pre">moreMA</span></code>).</p>
<p><strong>Note:</strong> You cannot use AICc to compare models that have different orders of differencing, or when one model has been transformed.</p>
<p>You also cannot use AIC to compare models that are fit to different data.</p>
</section>
<section id="helpful-equivalents">
<h3>Helpful equivalents<a class="headerlink" href="#helpful-equivalents" title="Link to this heading">#</a></h3>
<p>Many simple formulations of ArIMA models are equivalent to other basic models, for a few examples:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ArIMA(0,0,0)</span></code> is a white noise model</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ArIMA(0,1,0)</span></code> is a random walk</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ArIMA(0,1,2)</span></code> is a Damped Holt’s model</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ArIMA(0,1,1)</span></code> with a <span class="math notranslate nohighlight">\(\mu\)</span> constant of 0 is a simple exponential smoothing (SES) model</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ArIMA(0,1,1)</span></code> with a nonzero <span class="math notranslate nohighlight">\(\mu\)</span> constant is an SES with growth</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ArIMA(0,2,2)</span></code> is a Holt’s linear method with additive errors</p></li>
</ul>
</section>
<section id="final-exercise">
<h3>Final exercise<a class="headerlink" href="#final-exercise" title="Link to this heading">#</a></h3>
<p>Try pulling dataset <strong>575</strong> from <code class="docutils literal notranslate"><span class="pre">vecdyn</span></code>.</p>
<p>Make it a tsibble, fix it up, plot it, decompose it, fit some models to it (including at least 1 ArIMA model) and check which of your models fits the best!</p>
</section>
</section>
<section id="predictive-covariates">
<h2>Predictive covariates<a class="headerlink" href="#predictive-covariates" title="Link to this heading">#</a></h2>
<p>Throughout this entire tutorial so far, we have only been dealing with modelling a time series by itself with no other factors.</p>
<p>This is the preferred approach simply because without a good understanding of time series modelling, managing any other potential variables is essentially untenable.</p>
<p>However, now we have developed that understanding, we’re good to go!</p>
<p>Let’s take a time series containing two sub-series, the <code class="docutils literal notranslate"><span class="pre">us_change</span></code> dataset.</p>
<p>This contains quarterly data about the percentage changes in personal consumption expenditure, personal disposable income, production, savings and the unemployment rate for the US between 1970 and 2016.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">us_change</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">pivot_longer</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">Consumption</span><span class="p">,</span><span class="w"> </span><span class="n">Income</span><span class="p">),</span><span class="w"> </span><span class="n">names_to</span><span class="o">=</span><span class="s">&quot;Series&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">autoplot</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;% change&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/fe2e7dc554b6a7cc10d49de5355374570e086f75e5f3b9dd8c68c35eb80ed592.png"><img alt="../../_images/fe2e7dc554b6a7cc10d49de5355374570e086f75e5f3b9dd8c68c35eb80ed592.png" src="../../_images/fe2e7dc554b6a7cc10d49de5355374570e086f75e5f3b9dd8c68c35eb80ed592.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">us_change</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Income</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Consumption</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Consumption (quarterly % change)&quot;</span><span class="p">,</span>
<span class="w">       </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Income (quarterly % change)&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;lm&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>`geom_smooth()` using formula = &#39;y ~ x&#39;
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/97a7d9a52a3190fc9ba120c98acb4be70804c0381d6eec412b91ddfbffb9f779.png"><img alt="../../_images/97a7d9a52a3190fc9ba120c98acb4be70804c0381d6eec412b91ddfbffb9f779.png" src="../../_images/97a7d9a52a3190fc9ba120c98acb4be70804c0381d6eec412b91ddfbffb9f779.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>From the above plots we can see that there is some sort of predicative relationship between Income (<span class="math notranslate nohighlight">\(X_t\)</span>) and Consumption (<span class="math notranslate nohighlight">\(Y_t\)</span>).</p>
<p>Let’s model this using a time series linear model (TSLM). This model is very similar to a typical linear model, but specifically for time series.</p>
<p>It has the general form (for one predictor) of:</p>
<div class="math notranslate nohighlight">
\[Y_t = \alpha + \beta X_t + W_t\]</div>
<p>where <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span> are coefficients to fit, <span class="math notranslate nohighlight">\(X_t\)</span> is a predictor time series, and <span class="math notranslate nohighlight">\(W_t\)</span> is a white noise function.</p>
<p>To fit a TSLM we (appropriately) use the <code class="docutils literal notranslate"><span class="pre">TSLM()</span></code> function from <code class="docutils literal notranslate"><span class="pre">fable</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">lr_fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">us_change</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">model</span><span class="p">(</span><span class="nf">TSLM</span><span class="p">(</span><span class="n">Consumption</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Income</span><span class="p">))</span>
<span class="n">lr_fit</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">report</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Series: Consumption 
Model: TSLM 

residuals:
     Min       1Q   Median       3Q      Max 
-2.58236 -0.27777  0.01862  0.32330  1.42229 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.54454    0.05403  10.079  &lt; 2e-16 ***
Income       0.27183    0.04673   5.817  2.4e-08 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

residual standard error: 0.5905 on 196 degrees of freedom
Multiple r-squared: 0.1472,	Adjusted r-squared: 0.1429
F-statistic: 33.84 on 1 and 196 DF, p-value: 2.4022e-08
</pre></div>
</div>
</div>
</div>
<p>For this simple time series, we can see that the intercept term <span class="math notranslate nohighlight">\(\alpha \approx 0.54\)</span> and the income coefficient <span class="math notranslate nohighlight">\(\beta \approx 0.27\)</span>. This means that for an increase of 1% in income, a 0.27% increase in consumption is observed. In the absence of any change in income, there is an increase of 0.54%.</p>
<p>However if we plot the residuals we can see an issue in the bottom right pane:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">lr_fit</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">gg_tsresiduals</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/dd1e88ab0d89015810ef866cc76ccfd76b3f1bd91a7be0f6a44495970c2db653.png"><img alt="../../_images/dd1e88ab0d89015810ef866cc76ccfd76b3f1bd91a7be0f6a44495970c2db653.png" src="../../_images/dd1e88ab0d89015810ef866cc76ccfd76b3f1bd91a7be0f6a44495970c2db653.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>Here the residuals are significantly skewed (we expect them to be relatively normally-distributed).</p>
<p>Maybe we should include some more predictors to see if that accounts for this relationship. This is called “multiple time series linear regression” but is also fit with <code class="docutils literal notranslate"><span class="pre">TSLM()</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mlr_fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">us_change</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">model</span><span class="p">(</span><span class="nf">TSLM</span><span class="p">(</span><span class="n">Consumption</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Income</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Production</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Savings</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Unemployment</span><span class="p">))</span>
<span class="n">mlr_fit</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">report</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Series: Consumption 
Model: TSLM 

residuals:
     Min       1Q   Median       3Q      Max 
-0.90555 -0.15821 -0.03608  0.13618  1.15471 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   0.253105   0.034470   7.343 5.71e-12 ***
Income        0.740583   0.040115  18.461  &lt; 2e-16 ***
Production    0.047173   0.023142   2.038   0.0429 *  
Savings      -0.052890   0.002924 -18.088  &lt; 2e-16 ***
Unemployment -0.174685   0.095511  -1.829   0.0689 .  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

residual standard error: 0.3102 on 193 degrees of freedom
Multiple r-squared: 0.7683,	Adjusted r-squared: 0.7635
F-statistic:   160 on 4 and 193 DF, p-value: &lt; 2.22e-16
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mlr_fit</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">gg_tsresiduals</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/f7dceafef5e164399a718dbfa38328eb4b3516cc49318010babb84ed5a43fbad.png"><img alt="../../_images/f7dceafef5e164399a718dbfa38328eb4b3516cc49318010babb84ed5a43fbad.png" src="../../_images/f7dceafef5e164399a718dbfa38328eb4b3516cc49318010babb84ed5a43fbad.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>Better for sure! However there’s a big issue here, if tried to forecast using this method we would immediately hit a snag!</p>
<p>We do not have any <em>future</em> values of Income, Production, Savings, or Unemployment that could be used to generate future values.</p>
<p>Also if any of the effects of these predictors have lag components, we can’t model those either!</p>
<p>We could resolve some of this by forecasting the predictors themselves, or by using “deterministic predictors” however this is outside the scope of this tutorial. Instead let’s look at forms of multivariate models that can handle lags.</p>
<section id="dynamic-regression">
<h3>Dynamic regression<a class="headerlink" href="#dynamic-regression" title="Link to this heading">#</a></h3>
<p>A dynamic regression allows us to specify lagged variants of a predictor time series using the <code class="docutils literal notranslate"><span class="pre">lag()</span></code> command:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">consumption_fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">us_change</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">model</span><span class="p">(</span><span class="n">dr1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ArIMA</span><span class="p">(</span><span class="n">Consumption</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Income</span><span class="p">),</span>
<span class="w">        </span><span class="n">dr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ArIMA</span><span class="p">(</span><span class="n">Consumption</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Income</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">lag</span><span class="p">(</span><span class="n">Income</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)))</span>
<span class="n">consumption_fit</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="n">dr1</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">report</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Series: Consumption 
Model: LM w/ ArIMA(1,0,2) errors 

Coefficients:
         ar1      ma1     ma2  Income  intercept
      0.7070  -0.6172  0.2066  0.1976     0.5949
s.e.  0.1068   0.1218  0.0741  0.0462     0.0850

sigma^2 estimated as 0.3113:  log likelihood=-163.04
AIC=338.07   AICc=338.51   BIC=357.8
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">consumption_fit</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="n">dr1</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">gg_tsresiduals</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../_images/4280cb32e573f819b9e5d4de210ef3f440b2935f001bc145e6caafaab63cddf7.png"><img alt="../../_images/4280cb32e573f819b9e5d4de210ef3f440b2935f001bc145e6caafaab63cddf7.png" src="../../_images/4280cb32e573f819b9e5d4de210ef3f440b2935f001bc145e6caafaab63cddf7.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
<p>Those residuals look a <em>lot</em> more normal. It looks like the ArIMA model here is doing its job.</p>
<p>The ArIMA terms are still automatically estimated by the <code class="docutils literal notranslate"><span class="pre">ArIMA()</span></code> function! That said, it cannot automatically estimate the form or lags of the other predictor variables.</p>
<p>Let’s extend this model above to use multiple predictors (though notice we <em>must</em> provide these predictors and their lags explicitly)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">consumption_fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">us_change</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">model</span><span class="p">(</span><span class="n">dr1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ArIMA</span><span class="p">(</span><span class="n">Consumption</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Income</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">lag</span><span class="p">(</span><span class="n">Income</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)),</span>
<span class="w">        </span><span class="n">dr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ArIMA</span><span class="p">(</span><span class="n">Consumption</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Income</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">lag</span><span class="p">(</span><span class="n">Income</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Production</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                    </span><span class="nf">lag</span><span class="p">(</span><span class="n">Production</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)),</span>
<span class="w">        </span><span class="n">dr3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ArIMA</span><span class="p">(</span><span class="n">Consumption</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Income</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">lag</span><span class="p">(</span><span class="n">Income</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Production</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                    </span><span class="nf">lag</span><span class="p">(</span><span class="n">Production</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Unemployment</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">lag</span><span class="p">(</span><span class="n">Unemployment</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)),</span>
<span class="w">        </span><span class="n">dr4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ArIMA</span><span class="p">(</span><span class="n">Consumption</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Income</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">lag</span><span class="p">(</span><span class="n">Income</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Production</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                    </span><span class="nf">lag</span><span class="p">(</span><span class="n">Production</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Unemployment</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">lag</span><span class="p">(</span><span class="n">Unemployment</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                    </span><span class="n">Savings</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">lag</span><span class="p">(</span><span class="n">Savings</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)),</span>
<span class="w">        </span><span class="n">dr5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ArIMA</span><span class="p">(</span><span class="n">Consumption</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Income</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">lag</span><span class="p">(</span><span class="n">Income</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Production</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                    </span><span class="nf">lag</span><span class="p">(</span><span class="n">Production</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Unemployment</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">lag</span><span class="p">(</span><span class="n">Unemployment</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                    </span><span class="n">Savings</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">lag</span><span class="p">(</span><span class="n">Savings</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">lag</span><span class="p">(</span><span class="n">Income</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">lag</span><span class="p">(</span><span class="n">Production</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                    </span><span class="nf">lag</span><span class="p">(</span><span class="n">Unemployment</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">lag</span><span class="p">(</span><span class="n">Savings</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)))</span>
<span class="n">consumption_fit</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">glance</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="n">.model</span><span class="p">,</span><span class="w"> </span><span class="n">AICc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 5 × 2</caption>
<thead>
	<tr><th scope=col>.model</th><th scope=col>AICc</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>dr1</td><td>327.7395</td></tr>
	<tr><td>dr2</td><td>287.3911</td></tr>
	<tr><td>dr3</td><td>278.1080</td></tr>
	<tr><td>dr4</td><td>119.3768</td></tr>
	<tr><td>dr5</td><td>114.9476</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Surprisingly, the model that has the smallest AICc value is the most complicated model, which includes the current value and the first two lags of all the possible predictor time series. A residual analysis seems to suggest that the model is a good fit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">consumption_fit</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="n">dr5</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">gg_tsresiduals</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning message:
“removed 2 rows containing missing values or values outside the scale range
(`geom_line()`).”
Warning message:
“removed 2 rows containing missing values or values outside the scale range
(`geom_point()`).”
Warning message:
“removed 2 rows containing non-finite outside the scale range (`stat_bin()`).”
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/26ae251dbd3dfc7c7468a707603f0a672183d30a3c17592d894b5777cc63f77f.png"><img alt="../../_images/26ae251dbd3dfc7c7468a707603f0a672183d30a3c17592d894b5777cc63f77f.png" src="../../_images/26ae251dbd3dfc7c7468a707603f0a672183d30a3c17592d894b5777cc63f77f.png" style="width: 960px; height: 600px;" />
</a>
</div>
</div>
</section>
</section>
<section id="time-series-checklist">
<h2>Time Series Checklist<a class="headerlink" href="#time-series-checklist" title="Link to this heading">#</a></h2>
<p>Finally in this tutorial, here is a quick thing that you can refer back to when analysing your own time series.</p>
<blockquote>
<div><p>So you’ve ended up with some time series data to analyse.</p>
</div></blockquote>
<p>Here is a really simple checklist for some things to do:</p>
<ol class="arabic simple">
<li><p>Load your data</p></li>
<li><p>Try to convert to a <code class="docutils literal notranslate"><span class="pre">tsibble</span></code></p></li>
<li><p>Fix gaps if possible by aggregation or simple impution</p></li>
<li><p>reaggregate if the data is too fine-scaled</p></li>
<li><p>Plot plot plot!</p>
<ul class="simple">
<li><p>The time series</p></li>
<li><p>Seasonality plot</p></li>
<li><p>Lag plots</p></li>
<li><p>ACF plots</p></li>
</ul>
</li>
<li><p>Decompose (either STL or classical)</p></li>
<li><p>Get summary statistics</p></li>
<li><p>Model &amp; forecast</p></li>
<li><p>Select best model (if desired)</p></li>
</ol>
</section>
<section id="sources">
<h2>Sources<a class="headerlink" href="#sources" title="Link to this heading">#</a></h2>
<p>This entire workshop is based on the fantastic course <a class="reference external" href="https://yanshuo.quarto.pub/nus-ts-book/">Introduction to Time Series Analysis</a> by Yanshuo Tan and Vik Gopal.</p>
<p>That course is absolutely stuffed with the details of <em>how</em> these statistics work. If you want to know more about why we can just <em>do</em> these things, or if some parts of this workshop seemed a bit arcane, it may well be worthwhile checking out the source material. You’ll certainly recognise some of the datasets!</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            name: "ir",
            path: "./notebooks/experimental"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-a-time-series">What is a time series?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-problem-with-time-series">The “problem” with time series</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#examples-of-time-series">Examples of time series</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-note-on-time-series">A note on time series</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-the-purpose-of-time-series-analysis">What is the purpose of time series analysis?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forecasting">Forecasting</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#smoothing-filtering-and-cleaning">Smoothing, filtering, and cleaning</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#trending-and-regression">Trending and regression</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-started-in-r">Getting started in R</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-tsibble">The <code class="docutils literal notranslate"><span class="pre">tsibble</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting">Plotting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dealing-with-missing-values">Dealing with missing values</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#seasonality-plots">Seasonality plots</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lag-plots">Lag plots</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#autocorrelation-plots">Autocorrelation plots</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#decomposition">Decomposition</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#trend">Trend</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#seasonality">Seasonality</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-noise-or-the-remainder-component">random noise (or the remainder component)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#challenge">Challenge</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#additive-decompositions">Additive decompositions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#multiplicative-decomposition">Multiplicative decomposition</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-decomposition">Advanced decomposition</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Forecasting</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mean">Mean</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#naive">Naive</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#seasonal-naive">Seasonal naive</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-trend">Linear trend</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#drift">Drift</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-forecasting-using-fable">Simple forecasting using <code class="docutils literal notranslate"><span class="pre">fable</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-forecasting-exercise">Simple forecasting exercise</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#forecasting-from-decomposition">Forecasting from decomposition</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transformations">Transformations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exponential-smoothing">Exponential smoothing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ets-parameters"><code class="docutils literal notranslate"><span class="pre">ETS()</span></code> parameters</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#error"><code class="docutils literal notranslate"><span class="pre">error()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2"><code class="docutils literal notranslate"><span class="pre">trend()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#season"><code class="docutils literal notranslate"><span class="pre">season()</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#unstable-formulations">Unstable formulations</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-exponential-smoothing">Simple exponential smoothing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#holt-s-linear-trend-damped-trend-approaches">Holt’s linear trend &amp; Damped trend approaches</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#holt-winters-method">Holt-Winters’ method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#examples">Examples</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-note-on-periodicity">A note on periodicity</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#another-forecasting-exercise">Another forecasting exercise</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-statistics">Summary Statistics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basics">Basics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#autocovariance-and-autocorrelation">Autocovariance and Autocorrelation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cross-correlation">Cross-correlation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#decomposition-statistics">Decomposition statistics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#others">Others</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#autoregressive-and-arima-models">Autoregressive and ArIMA models</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#autoregression-ar">Autoregression (Ar)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#moving-averages-ma">Moving Averages (MA)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#differencing-i">Differencing (I)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#seasonal-differencing">Seasonal Differencing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#notation">Notation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sarima-models">SArIMA models</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-for-stationarity">Testing for stationarity</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-s-arima-models">Fitting (S)ArIMA models</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-s-arima-models-using-fable">Fitting (S)ArIMA models using <code class="docutils literal notranslate"><span class="pre">fable</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-time">Fitting time!</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#helpful-equivalents">Helpful equivalents</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#final-exercise">Final exercise</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#predictive-covariates">Predictive covariates</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-regression">Dynamic regression</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#time-series-checklist">Time Series Checklist</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sources">Sources</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By MulQuaBio collective!
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>