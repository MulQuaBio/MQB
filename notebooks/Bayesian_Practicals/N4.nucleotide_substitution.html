
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Practical session 2. Nucleotide substitution &amp; MCMC &#8212; MulQuaBio</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=01a0bdc2" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/Bayesian_Practicals/N4.nucleotide_substitution';</script>
    <script src="https://cdn.jsdelivr.net/npm/@iframe-resizer/child@latest"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="MulQuaBio - Home"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="MulQuaBio - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Welcome to The Multilingual Quantitative Biologist!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Computing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Unix.html">UNIX and Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ShellScripting.html">Shell scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Git.html">Version control with Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LaTeX.html">Scientific documents with <span class="math notranslate nohighlight">\(\LaTeX\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="../Python.html">Biological Computing in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../R.html">Biological Computing in R</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Ecological &amp; Evolutionary Modelling</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../MetabolicBasis.html">The Metabolic Basis of Ecology and Evolutionary dynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Populations.html">Single Populations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Interactions.html">Species Interactions</a></li>


<li class="toctree-l1"><a class="reference internal" href="../../references.html">References</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Basic Data Analyses and Statistics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../intro-Stats.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Data_R.html">Data Management and Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ExpDesign.html">Experimental design and Data exploration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../t_F_tests.html">Basic hypothesis testing: <span class="math notranslate nohighlight">\(t\)</span> and <span class="math notranslate nohighlight">\(F\)</span> tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Regress.html">Linear Models: Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ANOVA.html">Linear Models: Analysis of variance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../MulExpl.html">Linear Models: Multiple explanatory variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../MulExplInter.html">Linear Models: Multiple variables with interactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ModelSimp.html">Model simplification</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Advanced Data Analyses and Statistics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../GLMs.html">Generalised Linear Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../NLLS.html">Model Fitting using Non-linear Least-squares</a></li>
<li class="toctree-l1"><a class="reference internal" href="../MLE.html">Model Fitting using Maximum Likelihood</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Appendix-JupyIntro.html">Introduction to Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Appendix-Data-Python.html">Data analyses  with Python &amp; Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Appendix-Maths.html">Mathematical models in Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Appendix-MathsForBiologists/MathsForBiologists.html">Maths for Biologists</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Appendix-Databases.html">Databases <span class="tocSkip"></span></a></li>
<li class="toctree-l1"><a class="reference internal" href="../Appendix-NLLS-Python.html">Model fitting in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Appendix-MiniProj.html">The Computing Miniproject</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Appendix-Assessment.html">MQB Coursework Assessment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Appendix-HighPerformanceComputing.html">Introduction to High-Performance Computing (HPC)</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/MulQuaBio/MQB" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/MulQuaBio/MQB/issues/new?title=Issue%20on%20page%20%2Fnotebooks/Bayesian_Practicals/N4.nucleotide_substitution.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/notebooks/Bayesian_Practicals/N4.nucleotide_substitution.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Practical session 2. Nucleotide substitution & MCMC</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="practical-session-2-nucleotide-substitution-mcmc">
<h1>Practical session 2. Nucleotide substitution &amp; MCMC<a class="headerlink" href="#practical-session-2-nucleotide-substitution-mcmc" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span> <span class="c1"># numpy is the standard numeric libray</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ss</span> <span class="c1"># scipy is the scientific library, the stats module contains different functions</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span> <span class="c1"># matplotlib is the standard plotting library</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span> <span class="c1"># library for statistical plotting</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pymc</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pm</span> <span class="c1"># library for Bayesian MCMC inference</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">arviz</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">az</span> <span class="c1"># library to analyze and plot Bayesian results</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<p>In this practical we want to infer different substitution rates by comparing two different DNA sequences. The data that we will be using is the 12S rRNA alignment of human and orangutan. The output of the alignment is the count of different nucleotides which consists of 948 base pairs (Genbank accesion numbers for the human and orangutan sequences are D38112 and NC_001646, respectively (Horai et al. (1995)).):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;orangutan_human.csv&#39;</span><span class="p">,</span><span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>

<span class="n">length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;A_human&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;C_human&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;G_human&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;T_human&#39;</span><span class="p">])</span>

<span class="n">N_TC</span> <span class="o">=</span> <span class="n">data_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;C_orangutan&#39;</span><span class="p">][</span><span class="s1">&#39;T_human&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;T_orangutan&#39;</span><span class="p">][</span><span class="s1">&#39;C_human&#39;</span><span class="p">]</span> <span class="c1"># transitions_TC</span>
<span class="n">N_AG</span> <span class="o">=</span> <span class="n">data_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;G_orangutan&#39;</span><span class="p">][</span><span class="s1">&#39;A_human&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A_orangutan&#39;</span><span class="p">][</span><span class="s1">&#39;G_human&#39;</span><span class="p">]</span> <span class="c1"># transitions_AG</span>

<span class="n">N_TA</span> <span class="o">=</span> <span class="n">data_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;T_orangutan&#39;</span><span class="p">][</span><span class="s1">&#39;A_human&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A_orangutan&#39;</span><span class="p">][</span><span class="s1">&#39;T_human&#39;</span><span class="p">]</span> <span class="c1"># transversion_TA</span>
<span class="n">N_TG</span> <span class="o">=</span> <span class="n">data_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;T_orangutan&#39;</span><span class="p">][</span><span class="s1">&#39;G_human&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;T_orangutan&#39;</span><span class="p">][</span><span class="s1">&#39;G_human&#39;</span><span class="p">]</span> <span class="c1"># transversion_TG</span>
<span class="n">N_CG</span> <span class="o">=</span> <span class="n">data_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;G_orangutan&#39;</span><span class="p">][</span><span class="s1">&#39;C_human&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;C_orangutan&#39;</span><span class="p">][</span><span class="s1">&#39;G_human&#39;</span><span class="p">]</span> <span class="c1"># transversion_CG</span>
<span class="n">N_CA</span> <span class="o">=</span> <span class="n">data_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;C_orangutan&#39;</span><span class="p">][</span><span class="s1">&#39;A_human&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A_orangutan&#39;</span><span class="p">][</span><span class="s1">&#39;C_human&#39;</span><span class="p">]</span> <span class="c1"># transversion_CG</span>


<span class="n">N_transition</span> <span class="o">=</span> <span class="n">N_TC</span><span class="o">+</span><span class="n">N_AG</span>
<span class="n">N_transversion</span> <span class="o">=</span> <span class="n">N_TA</span><span class="o">+</span><span class="n">N_CG</span><span class="o">+</span><span class="n">N_CG</span><span class="o">+</span><span class="n">N_CA</span>
<span class="n">N_intact</span> <span class="o">=</span> <span class="n">length</span> <span class="o">-</span> <span class="n">N_transition</span> <span class="o">-</span> <span class="n">N_transversion</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sequence length = &quot;</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of transitionss = &quot;</span><span class="p">,</span><span class="n">N_transition</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of transversions = &quot;</span><span class="p">,</span><span class="n">N_transversion</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>There are in total 90 base differences between both mitochondrial 12s RNAs. From this substitutions we have 84 transitions (i.e. (<span class="math notranslate nohighlight">\(T\!\iff\!C\)</span>) and (<span class="math notranslate nohighlight">\(A\!\iff\!G\)</span>)), and 6 transversions (rest of substitutions). In Kimura’s 1980 (K80) nucleotide substitution model that has two parameters:</p>
<ol class="arabic simple">
<li><p>The sequence distance <span class="math notranslate nohighlight">\(d\)</span> between species. <span class="math notranslate nohighlight">\(d=rt\)</span> is the product of the average mutation rate <span class="math notranslate nohighlight">\(f\)</span> and the branch length <span class="math notranslate nohighlight">\(t\)</span>. Since the time difference is usually unknown (unless there are fossil calibrations), one canot differentiate between a fast mutation rate over a long time, agains a slow mutation over a long time. On the contrary the distance <span class="math notranslate nohighlight">\(d=rt\)</span> controlling the number of mutations that occured can be inferred when comparing two sequences.</p></li>
<li><p>The transition/transversion rate ratio (<span class="math notranslate nohighlight">\(\kappa\)</span> = rate_transition/rate_transversion) which accounts for the fact that transitions often occur at higher rates than transversions (<span class="math notranslate nohighlight">\(\kappa\gg 1\)</span>).</p></li>
</ol>
<p>We need to write a function that returns us the log-likelihood given the distance between two sequences (<span class="math notranslate nohighlight">\(d\)</span>) and the ratio (<span class="math notranslate nohighlight">\(\kappa\)</span>), which can written as <span class="math notranslate nohighlight">\(P(data|d,\kappa)\)</span>. The process is a Markovian, and following similar arguments to the ones we saw on the probability theory session we know the probability distribution for each site after a time t is:</p>
<ul class="simple">
<li><p>Probability of a site staying the same:
<span class="math notranslate nohighlight">\(P_{intact} = \frac{1}{4} + \frac{1}{4}e^{-4kd/(2k+1)} + \frac{1}{2}e^{-2dk}\)</span></p></li>
<li><p>Probability of a site showing a transition:
<span class="math notranslate nohighlight">\(P_{transition} = \frac{1}{4} + \frac{1}{4}e^{-4kd/(2k+1)} - \frac{1}{2}e^{-2dk}\)</span></p></li>
<li><p>Probability of a site showing a transversion:
<span class="math notranslate nohighlight">\(P_{transversion} = \frac{1}{2} - \frac{1}{2}e^{-4kd/(2k+1)}\)</span></p></li>
</ul>
<p>The resulting likelihood for our observation is the multinomial distribution (similar to the binomial but with more than 2 possible types of results):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">P_intact</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">0.25</span> <span class="o">+</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">d</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">d</span><span class="o">*</span><span class="n">k</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">P_transition</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">0.25</span> <span class="o">+</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">d</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">d</span><span class="o">*</span><span class="n">k</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">P_transversion</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">d</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">log_likelihood</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">d</span><span class="p">):</span> <span class="c1"># this corresponds to a multinomial, check it!</span>
    <span class="k">return</span> <span class="n">N_intact</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">P_intact</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">d</span><span class="p">))</span><span class="o">+</span><span class="n">N_transition</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">P_transition</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">d</span><span class="p">))</span><span class="o">+</span><span class="n">N_transversion</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">P_transversion</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">d</span><span class="p">))</span> 
<span class="c1"># usually is easier numerically to work with log_likelihood than likelihoods since they can be really small</span>
    
</pre></div>
</div>
</div>
</div>
<p><strong>Q1.1</strong> Check that the probabilities of finding a nucleotide intact or mutating make sense by plotting the three probability components <span class="math notranslate nohighlight">\(P_j(k)\)</span> for different values of <span class="math notranslate nohighlight">\(d\)</span>, and exploring the limit cases of <span class="math notranslate nohighlight">\(d\)</span>, <span class="math notranslate nohighlight">\(k\)</span>.</p>
<p><strong>Q1.2 Brute force inference</strong> If we want to obtain the posterior distribution <span class="math notranslate nohighlight">\(P(k,d|data)\)</span> we need to evaluate the distributions at <em>all</em> possible values of <span class="math notranslate nohighlight">\(k\)</span> and <span class="math notranslate nohighlight">\(d\)</span>. Since this is impossible we could also run MCMC to sample <span class="math notranslate nohighlight">\(P(k,d|data)\)</span> in a smart way. A more rudimentary alternative is to divide the parameter space (k,d) into a grid and evaluate the posterior for those values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First you need to find a limit for your prior that make sense, it should be hard to find them by eye,</span>
<span class="c1"># but you can evaluate the likelihood at different values of k,d to have an idea of the ranges</span>
<span class="n">min_k</span> <span class="o">=</span> <span class="c1">#</span>
<span class="n">max_k</span> <span class="o">=</span> <span class="c1">#</span>
<span class="n">min_d</span> <span class="o">=</span> <span class="c1">#</span>
<span class="n">max_d</span> <span class="o">=</span> <span class="c1">#</span>

<span class="n">k_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_k</span><span class="p">,</span><span class="n">max_k</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">d_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_d</span><span class="p">,</span><span class="n">max_d</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">K</span><span class="p">,</span><span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">k_range</span><span class="p">,</span><span class="n">d_range</span><span class="p">)</span>

<span class="n">posterior</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_likelihood</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">D</span><span class="p">))</span> <span class="c1"># I could multiply by a prior as well</span>


<span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">k_range</span><span class="p">,</span> <span class="n">d_range</span><span class="p">,</span> <span class="n">posterior</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>  <span class="c1"># Contour plot</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q1.3 MCMC</strong>. We can also infer the parameters running an implemented MCMC. Implement the MCMC using the loglikelihood defined in the previous plot</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">Pea_Model</span><span class="p">:</span>
    <span class="n">k_prior</span> <span class="o">=</span> <span class="c1">### Define priors for k and d</span>
    <span class="n">d_prior</span> <span class="o">=</span> <span class="c1">###</span>
    
    <span class="c1"># we need to define our custom likelihood</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">log_likelihood_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">log_likelihood</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>
    
    <span class="n">f_likelihood</span> <span class="o">=</span> <span class="c1">### Check the documentation from pymc on how to introduce a custom likelihood</span>
    <span class="n">mcmc_sample</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">4000</span><span class="p">,</span> <span class="n">chains</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">return_inferencedata</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">mcmc_sample</span><span class="p">)</span> <span class="c1"># summary of MCMC statistics</span>
<span class="n">posterior</span> <span class="o">=</span> <span class="n">mcmc_sample</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">posterior</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;posterior&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">),</span><span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;posterior&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">),</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">thresh</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">levels</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q1.4 Just for the braves</strong> Code an MCMC yourself. You can follow the steps of the algorithm we discussed in class. You will have freedom on the choices of the proposal step (take into account the different lengthscales in k and d). Make sure to analyze the trace to evaluate if your results has converged.</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/Bayesian_Practicals"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By MulQuaBio collective!
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>