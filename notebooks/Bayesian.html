
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Model Fitting the Bayesian Way &#8212; MulQuaBio</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=3943d584" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=01a0bdc2" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/togglebutton.js?v=3e7854f7"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/Bayesian';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="MulQuaBio - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="MulQuaBio - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to The Multilingual Quantitative Biologist!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Computing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Unix.html">UNIX and Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="ShellScripting.html">Shell scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="Git.html">Version control with Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="LaTeX.html">Scientific documents with <span class="math notranslate nohighlight">\(\LaTeX\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="Python.html">Biological Computing in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="R.html">Biological Computing in R</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Basic Data Analyses and Statistics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../intro-Stats.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Data_R.html">Data Management and Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="ExpDesign.html">Experimental design and Data exploration</a></li>
<li class="toctree-l1"><a class="reference internal" href="t_F_tests.html">Basic hypothesis testing: <span class="math notranslate nohighlight">\(t\)</span> and <span class="math notranslate nohighlight">\(F\)</span> tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="regress.html">Linear Models: Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="anova.html">Linear Models: Analysis of variance</a></li>
<li class="toctree-l1"><a class="reference internal" href="MulExpl.html">Linear Models: Multiple explanatory variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="MulExplInter.html">Linear Models: Multiple variables with interactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="ModelSimp.html">Model simplification</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Advanced Data Analyses and Statistics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="glm.html">Generalised Linear Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="NLLS.html">Model Fitting using Non-linear Least-squares</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Appendix-JupyIntro.html">Introduction to Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="Appendix-Data-Python.html">Data analyses  with Python &amp; Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="Appendix-Maths.html">Mathematical models in Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="Appendix-MathsForBiologists/MathsForBiologists.html">Maths for Biologists</a></li>
<li class="toctree-l1"><a class="reference internal" href="Appendix-Databases.html">Databases <span class="tocSkip"></span></a></li>
<li class="toctree-l1"><a class="reference internal" href="Appendix-NLLS-Python.html">Model fitting in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="Appendix-MiniProj.html">The Computing Miniproject</a></li>
<li class="toctree-l1"><a class="reference internal" href="Appendix-Assessment.html">TMQB Coursework Assessment</a></li>
<li class="toctree-l1"><a class="reference internal" href="Appendix-HighPerformanceComputing.html">Introduction to High-Performance Computing (HPC)</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/MulQuaBio/MQB" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/MulQuaBio/MQB/issues/new?title=Issue%20on%20page%20%2Fnotebooks/Bayesian.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/Bayesian.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Model Fitting the Bayesian Way</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-likelihoods-exercise">A Likelihoods exercise</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-binomial-distribution">The Binomial Distribution</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#simulating-from-the-binomial-using-r">Simulating from the Binomial using R</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#method-of-moments-mom-estimators">Method of Moments (MoM) Estimators</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mle-for-binomial-distribution">MLE for Binomial Distribution</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#likelihood-and-log-likelihood">Likelihood and Log Likelihood</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-the-likelihood-and-mle-in-r">Computing the likelihood and MLE in R</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-midge-wing-length">Example: Midge Wing Length</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non-bayesian-analysis">Non-Bayesian analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-the-bayesian-model">Setting up the Bayesian Model</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#prior-information">Prior Information</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analytic-posterior">Analytic Posterior</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-prior-sensitivity">Exercise: Prior sensitivity</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#numerical-evaluation-of-the-posterior-with-jags">Numerical evaluation of the posterior with JAGS</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-the-model">Specifying the model</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-the-population-variance">Estimating the population variance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-updating-the-bayesian-model">Exercise: Updating the Bayesian model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aedes-data-revisited-using-bayesian-fitting">Aedes data revisited using Bayesian fitting</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-data">The Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#two-thermal-performance-curve-models">Two thermal performance curve models</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-thermal-response-model-file">The thermal response model file</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-diagnostics">Running diagnostics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-fits">Plot the fits</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-analyses">Additional analyses</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-of-abundance-data">Fitting of abundance data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">The Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-the-growth-curve">Specifying the growth curve</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">The thermal response model file</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-settings-for-jags">Additional settings for jags</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-the-model">Fitting the model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#diagnostics">Diagnostics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-joint-posterior-of-parameters">Visualizing the joint posterior of parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-posterior-distribution-of-the-mean-function">The posterior distribution of the mean function</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#readings-and-resources">Readings and Resources <a id="Readings"></a></a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="model-fitting-the-bayesian-way">
<h1>Model Fitting the Bayesian Way<a class="headerlink" href="#model-fitting-the-bayesian-way" title="Link to this heading">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>In this Chapter we will work through various examples of  model fitting  to biological data using Bayesian Methods. It is recommended that you see the <a class="reference external" href="https://github.com/mhasoba/TheMulQuaBio/tree/master/content/lectures/ModelFitting">lecture</a> on model fitting in Ecology and Evolution.</p>
<p>Recall from the <a class="reference external" href="https://github.com/vectorbite/VBiTraining2/tree/master/lectures">lectures</a> that for Bayesian model fitting/inference, we need to:</p>
<ol class="arabic simple">
<li><p><strong>Assess MCMC convergence</strong>: MCMC is family of algorithm for sampling probability distributions so that it can be adequately characterized (in the Bayesian context the posterior distribution). The MCMC procedure reaches * convergence * once we have sufficient random draws from the posterior distribution. To assess convergence we look at trace plots. The goal is to get “fuzzy caterpillars”-looking curves.</p></li>
<li><p><strong>Summarize MCMC draws</strong>: Summarize and visualize outcome of the random draws using histograms for all draws for each parameter, and calculate expectation, variance, credibility interval, etc.</p></li>
<li><p><strong>Prior Sensitivity</strong>: Assess prior sensitivity by changing prior values and check whether it affects the results or not. If it does, that means that the results are too sensitive to that prior, not good!</p></li>
<li><p><strong>Make inferences</strong>: We use the values from item (2) to make inferences and answer the research question.</p></li>
</ol>
<p>Because likelihoods form the basis for Bayesian model fitting, we will first do an exercise to understand their calculation.</p>
<p>We will use R. For starters, clear all variables and graphic devices and load necessary packages:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">rm</span><span class="p">(</span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ls</span><span class="p">())</span>
<span class="nf">graphics.off</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="a-likelihoods-exercise">
<h2>A Likelihoods exercise<a class="headerlink" href="#a-likelihoods-exercise" title="Link to this heading">#</a></h2>
<section id="the-binomial-distribution">
<h3>The Binomial Distribution<a class="headerlink" href="#the-binomial-distribution" title="Link to this heading">#</a></h3>
<p>The Binomial distribution is used to model the number of “successes” in a set of trials (e.g., number of heads when you flip a coin <span class="math notranslate nohighlight">\(N\)</span> times). The pmf is</p>
<div class="math notranslate nohighlight">
\[
{N \choose x} p^x(1-p)^{N-x}
\]</div>
<p>such that <span class="math notranslate nohighlight">\(\mathrm{E}[x] = Np \)</span>. Throughout this “experiment”, you will assume that your experiment consists of flipping 20 coins, so that <span class="math notranslate nohighlight">\(N = 20\)</span>.</p>
<p>Let’s use the Binomial distribution to practice two methods of estimating parameters for a probability distribution: method of moments and maximum likelihood.</p>
<section id="simulating-from-the-binomial-using-r">
<h4>Simulating from the Binomial using R<a class="headerlink" href="#simulating-from-the-binomial-using-r" title="Link to this heading">#</a></h4>
<p>First take 50 draws from a binomial (using <em>rbinom</em>) for each <span class="math notranslate nohighlight">\(p\in\)</span> 0.1, 0.5, 0.8 with <span class="math notranslate nohighlight">\(N=20\)</span>. For this, lets set seed so that we can reproduce this exact sequence of sampling (why?):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">set.seed</span><span class="p">(</span><span class="m">54321</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">## 50 draws with each p </span>
<span class="n">pp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0.8</span><span class="p">)</span>
<span class="n">N</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">20</span>
<span class="n">reps</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">50</span><span class="w"> </span>
</pre></div>
</div>
</div>
</div>
<p>Now plot the histograms of these draws together with the density functions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">## histograms + density here</span>
<span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>
<span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">bty</span><span class="o">=</span><span class="s">&quot;n&quot;</span><span class="p">)</span>

<span class="c1"># Write more code here</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q1: Do the histograms look like the distributions for all 3 values of <span class="math notranslate nohighlight">\(p\)</span>? If not, what do you think is going on?</strong></p>
<p>You’ll notice that for <span class="math notranslate nohighlight">\(p=0.1\)</span> the histogram and densities don’t look quite the same – the <code class="docutils literal notranslate"><span class="pre">hist()</span></code> function is lumping together the zeros and ones which makes it look off. This is typical for distributions that are truncated.</p>
</section>
</section>
<section id="method-of-moments-mom-estimators">
<h3>Method of Moments (MoM) Estimators<a class="headerlink" href="#method-of-moments-mom-estimators" title="Link to this heading">#</a></h3>
<p>To obtain a method of moments estimator, we equate the theoretical moments (which will be a function of the parameters of the distribution) with the corresponding sample moments, and solve for the parameters in order to obtain an estimate. For the binomial distribution, there is only one parameter, <span class="math notranslate nohighlight">\(p\)</span>.</p>
<p><strong>Q2: Given the analytic expected value, above, and assuming that the sample mean is <span class="math notranslate nohighlight">\(m\)</span> (the mean number of observed heads across replicates), what is the MoM estimator for <span class="math notranslate nohighlight">\(p\)</span>?</strong></p>
<p>Now calculate the MoM estimator for each of your 3 sets of simulated data sets to get the estimates for each of your values of <span class="math notranslate nohighlight">\(p\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">## MOM estimators for 3 simulated sets</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q3: How good are your estimates for <span class="math notranslate nohighlight">\(p\)</span>? Do you get something close to the true value?</strong></p>
<p>For 1 of your values of <span class="math notranslate nohighlight">\(p\)</span>, take 20 draws from the binomial with <span class="math notranslate nohighlight">\(N=20\)</span> and calculate the MoM. Repeat this 100 times (hint: the <code class="docutils literal notranslate"><span class="pre">replicate()</span></code> and <code class="docutils literal notranslate"><span class="pre">lapply</span></code> functions may be useful.) Make a histogram of your estimates, and add a line/point to the plot to indicate the real value of <span class="math notranslate nohighlight">\(p\)</span> that you used to simulate the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">## MoM estimates, histogram </span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q4: Is the MoM successfully estimating <span class="math notranslate nohighlight">\(p\)</span>? Does your histogram for <span class="math notranslate nohighlight">\(p\)</span> look more or less normal? If so, what theorem might explain why this would be the case?</strong></p>
</section>
<section id="mle-for-binomial-distribution">
<h3>MLE for Binomial Distribution<a class="headerlink" href="#mle-for-binomial-distribution" title="Link to this heading">#</a></h3>
<section id="likelihood-and-log-likelihood">
<h4>Likelihood and Log Likelihood<a class="headerlink" href="#likelihood-and-log-likelihood" title="Link to this heading">#</a></h4>
<p>Imagine that you flip a coin <span class="math notranslate nohighlight">\(N\)</span> times, and then repeat the experiment <span class="math notranslate nohighlight">\(n\)</span> times. Thus, you have data <span class="math notranslate nohighlight">\(x=x`1, x`2, \dots x`n\)</span> that are the number of times you observed a head in each trial. <span class="math notranslate nohighlight">\(p\)</span> is the probability of obtaining a head.</p>
<p><strong>Q5: Write down the likelihood and log-likelihood for the data. Take the derivative of the negative log-likelihood, set this equal to zero, and find the MLE, <span class="math notranslate nohighlight">\(\hat{p}\)</span>.</strong></p>
</section>
</section>
<section id="computing-the-likelihood-and-mle-in-r">
<h3>Computing the likelihood and MLE in R<a class="headerlink" href="#computing-the-likelihood-and-mle-in-r" title="Link to this heading">#</a></h3>
<p>Simulate some data with <span class="math notranslate nohighlight">\(p=0.25\)</span>, <span class="math notranslate nohighlight">\(N=10\)</span>, and 10 replicates. Calculate the negative log-likelihood of your simulated data across a range of <span class="math notranslate nohighlight">\(p\)</span> (from 0 to 1), and plot them. You may do this by using the built in functions in R (specifically <code class="docutils literal notranslate"><span class="pre">dbinom</span></code>) or write your own function. This is called a “likelihood profile’’. Plot your likelihood profile with a line indicating the true value of <span class="math notranslate nohighlight">\(p\)</span>. Add lines indicating the MLE <span class="math notranslate nohighlight">\(\hat{p}\)</span> and the MoM estimator for <span class="math notranslate nohighlight">\(p\)</span> to your likelihood profile.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">pp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">.</span><span class="m">25</span>
<span class="n">N</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10</span>
<span class="n">reps</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10</span>
<span class="c1">## Make one set of data</span>

<span class="c1">## the likelihood is always exactly zero</span>
<span class="c1">## at p=0,1, so I skip those values</span>
<span class="n">ps</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">0.01</span><span class="p">,</span><span class="w"> </span><span class="m">0.99</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="m">0.01</span><span class="p">)</span><span class="w"> </span>

<span class="c1">## Likelihood</span>


<span class="c1">## MLE/MoM estimators </span>

<span class="c1">## now plot the negative log likelihood profile</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q6: How does your MLE compare to the true parameter value? How could you estimate the MLE from the likelihood profile if you didn’t have a way to calculate the MLE directly? If you chose another version of the random seed, do you get the same answer?</strong></p>
</section>
</section>
<section id="example-midge-wing-length">
<h2>Example: Midge Wing Length<a class="headerlink" href="#example-midge-wing-length" title="Link to this heading">#</a></h2>
<p>We will use this simple example to go through the steps of assessing a Bayesian model and we’ll see that MCMC can allow us to approximate the posterior distribution.</p>
<p>Grogan and Wirth (1981) provide data on the wing length (in millimeters) of nine members of a species of midge (small, two-winged flies).</p>
<p>From these measurements we wish to make inference about the population mean <span class="math notranslate nohighlight">\(\mu\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">WL.data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read.csv</span><span class="p">(</span><span class="s">&quot;../data/MidgeWingLength.csv&quot;</span><span class="p">)</span>
<span class="n">Y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">WL.data</span><span class="o">$</span><span class="n">WingLength</span>
<span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>

<span class="nf">hist</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="n">breaks</span><span class="o">=</span><span class="m">10</span><span class="p">,</span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;Wing Length (mm)&quot;</span><span class="p">)</span><span class="w"> </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/fcbdb12d69499535a9b2e562ec0b2f5ac091d08af6351efc5040aecc2024e945.png"><img alt="../_images/fcbdb12d69499535a9b2e562ec0b2f5ac091d08af6351efc5040aecc2024e945.png" src="../_images/fcbdb12d69499535a9b2e562ec0b2f5ac091d08af6351efc5040aecc2024e945.png" style="width: 300px; height: 360px;" /></a>
</div>
</div>
<section id="non-bayesian-analysis">
<h3>Non-Bayesian analysis<a class="headerlink" href="#non-bayesian-analysis" title="Link to this heading">#</a></h3>
<p>We might expect that these midge data could be draws from a <em>Normal</em> distribution <span class="math notranslate nohighlight">\(\mathcal{N}(\mu, \sigma^2)\)</span>. <a class="reference internal" href="MLE.html"><span class="std std-doc">Recall</span></a> that the MLEs for <span class="math notranslate nohighlight">\(\mu\)</span> and <span class="math notranslate nohighlight">\(\sigma^2\)</span> here are simply the <em>sample mean</em> and <em>sample variance</em> respectively:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span><span class="o">/</span><span class="n">n</span>
<span class="n">s2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">((</span><span class="n">Y</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="m">-1</span><span class="p">)</span>
<span class="nf">round</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">s2</span><span class="p">),</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>1.804</li><li>0.017</li></ol>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">1.4</span><span class="p">,</span><span class="m">2.2</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="o">=</span><span class="m">50</span><span class="p">)</span>
<span class="nf">hist</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="n">breaks</span><span class="o">=</span><span class="m">10</span><span class="p">,</span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;Wing Length (mm)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1.4</span><span class="p">,</span><span class="w"> </span><span class="m">2.2</span><span class="p">),</span><span class="w"> </span><span class="n">freq</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span>
<span class="nf">lines</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nf">dnorm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="o">=</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="o">=</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">s2</span><span class="p">)),</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/4c823491bab93793f82e62faefb735fe7f9c5aa9a39b56dffe1416ab8e732420.png"><img alt="../_images/4c823491bab93793f82e62faefb735fe7f9c5aa9a39b56dffe1416ab8e732420.png" src="../_images/4c823491bab93793f82e62faefb735fe7f9c5aa9a39b56dffe1416ab8e732420.png" style="width: 300px; height: 360px;" /></a>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We have plotted the estimate of the <em>population</em> distribution here, but this is not the <em>predictive distribution</em> (which would be a Student’s <span class="math notranslate nohighlight">\(t\)</span> because we’re estimating both the mean and variance.)</p>
</div>
<p>The non-Bayesian version here has the advantage of being quick and familiar. However, from our point of view it has two weaknesses:</p>
<ol class="arabic simple">
<li><p>Because we have so few data points estimates of the accuracy of our predictions aren’t available. 9 points is only barely enough to estimate a mean, so we don’t trust any of the variance calculations.</p></li>
<li><p>We can’t easily incorporate things that we might already know about midges into our analysis.</p></li>
</ol>
<p>Let’s see how we can do a similar analysis using a Bayesian approach, first analytically, and the with JAGS.</p>
</section>
<section id="setting-up-the-bayesian-model">
<h3>Setting up the Bayesian Model<a class="headerlink" href="#setting-up-the-bayesian-model" title="Link to this heading">#</a></h3>
<p>We need to define the likelihood and the priors for our Bayesian analysis. Given the analysis that we’ve just done, let’s assume that our data come from a normal distribution with unknown mean, <span class="math notranslate nohighlight">\(\mu\)</span> but that we know the variance is <span class="math notranslate nohighlight">\(\sigma^2 = 0.025\)</span>. That is:</p>
<div class="math notranslate nohighlight">
\[
\mathbf{Y} \stackrel{\mathrm{iid}}{\sim} \mathcal{N}(\mu, 0.025^2)
\]</div>
<section id="prior-information">
<h4>Prior Information<a class="headerlink" href="#prior-information" title="Link to this heading">#</a></h4>
<p>Studies from other populations suggest that wing lengths are usually around 1.9 mm, so we set <span class="math notranslate nohighlight">\(\mu_0 = 1.9\)</span></p>
<p>We also know that lengths must be positive (<span class="math notranslate nohighlight">\(\mu &gt;0\)</span>)</p>
<p>We can approximate this restriction with a normal prior distribution for <span class="math notranslate nohighlight">\(\mu\)</span> as follows:</p>
<p>Since most of the normal density is within two standard deviations of the mean we choose <span class="math notranslate nohighlight">\(\tau^2_0\)</span> so that</p>
<div class="math notranslate nohighlight">
\[ \mu_0 - 2\sigma_0 &gt;0 \Rightarrow \sigma_0 &lt;1.9/2 = 0.95 \]</div>
<p>I will choose <span class="math notranslate nohighlight">\(\sigma_0=0.8\)</span> here. Thus our prior for mu will be:
$<span class="math notranslate nohighlight">\(
\mu \sim \mathcal{N}(1.9, 0.8^2)
\)</span>$</p>
<hr class="docutils" />
<p>Together, then, our full model is:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
    \mathbf{Y} &amp; \stackrel{\mathrm{iid}}{\sim} \mathcal{N}(\mu, 0.025^2)\\
    \mu &amp;\sim \mathcal{N}(1.9, 0.8^2)
\end{align*}\]</div>
</section>
</section>
<section id="analytic-posterior">
<h3>Analytic Posterior<a class="headerlink" href="#analytic-posterior" title="Link to this heading">#</a></h3>
<p>For this very simple case it is easy to write down the posterior distribution (up to some constant). First, note that the likelihood for the data can be written as</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
    \mathcal{L} &amp;\propto \prod_{i=1}^n \frac{1}{\sigma} \exp\left(-\frac{1}{2\sigma^2}(Y_i-\mu)^2 \right) \\
    &amp; = \frac{1}{\sigma^n} \exp\left(-\frac{1}{2\sigma^2}\sum_{i=1}^n (Y_i-\mu)^2 \right)\\
    &amp; \propto \exp\left(-\frac{n}{2\sigma^2} (\bar{Y}-\mu)^2 \right)
\end{align*}\]</div>
<p>Multiplying the prior through we get the following for the posterior:</p>
<div class="math notranslate nohighlight">
\[
\mathrm{P}(\mu|\mathbf{Y}) \propto \exp \left(-\frac{n}{2\sigma^2} (\bar{Y}-\mu)^2 \right) \exp\left(-\frac{1}{2\sigma_0^2}(\mu-\mu_0)^2 \right)
\]</div>
<p>You can re-arrange, complete the square, etc, to get a new expression that is like</p>
<div class="math notranslate nohighlight">
\[
\mathrm{P}(\mu|\mathbf{Y}) \propto \exp \left(-\frac{1}{2\sigma_p^2} (\mu_p-\mu)^2 \right)
\]</div>
<p>where</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\mu_p &amp; = \frac{n\sigma_0^2}{\sigma^2 + n\sigma_0^2} \bar{Y} + \frac{\sigma^2}{\frac{\sigma^2}{n} + \sigma_0^2} \mu_0\\
&amp; \\
\sigma_p^2 &amp; = \left( \frac{n}{\sigma^2} + \frac{1}{\sigma_0^2} \right)^{-1}
\end{align*}\]</div>
<p>Instead of writing this last in terms of the variances, we could instead use precision (the inverse variance) which gives a simpler expression:</p>
<div class="math notranslate nohighlight">
\[
\tau_p = n\tau + \tau_0
\]</div>
<p>Just like in our earlier example, our estimate of the mean is a weighted average of the data and the prior, with the variance being determined by the data and prior variances.</p>
<p>So lets write a little function to calculate <span class="math notranslate nohighlight">\(\mu_p\)</span> and <span class="math notranslate nohighlight">\(\tau_p\)</span> and the plug in our numbers:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tau.post</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">tau</span><span class="p">,</span><span class="w"> </span><span class="n">tau0</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">){</span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tau</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tau0</span><span class="p">}</span>
<span class="n">mu.post</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">Ybar</span><span class="p">,</span><span class="w"> </span><span class="n">mu0</span><span class="p">,</span><span class="w"> </span><span class="n">sig20</span><span class="p">,</span><span class="w"> </span><span class="n">sig2</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">){</span>
<span class="w"> </span><span class="n">weight</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sig2</span><span class="o">+</span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sig20</span>
<span class="w"> </span>
<span class="w"> </span><span class="nf">return</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sig20</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Ybar</span><span class="o">/</span><span class="n">weight</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sig2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">mu0</span><span class="o">/</span><span class="n">weight</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s plot 3 things together – the data histogram, the prior, and the posterior:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mu0</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1.9</span>
<span class="n">s20</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.8</span>
<span class="n">s2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.025</span><span class="w"> </span><span class="c1">## &quot;true&quot; variance</span>

<span class="n">mp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">mu.post</span><span class="p">(</span><span class="n">Ybar</span><span class="o">=</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">mu0</span><span class="o">=</span><span class="n">mu0</span><span class="p">,</span><span class="w"> </span><span class="n">sig20</span><span class="o">=</span><span class="n">s20</span><span class="p">,</span><span class="w"> </span><span class="n">sig2</span><span class="o">=</span><span class="n">s2</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">tp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">tau.post</span><span class="p">(</span><span class="n">tau</span><span class="o">=</span><span class="m">1</span><span class="o">/</span><span class="n">s2</span><span class="p">,</span><span class="w"> </span><span class="n">tau0</span><span class="o">=</span><span class="m">1</span><span class="o">/</span><span class="n">s20</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s plot the result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">1.3</span><span class="p">,</span><span class="m">2.3</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="o">=</span><span class="m">1000</span><span class="p">)</span>
<span class="nf">hist</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="n">breaks</span><span class="o">=</span><span class="m">10</span><span class="p">,</span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;Wing Length (mm)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1.3</span><span class="p">,</span><span class="w"> </span><span class="m">2.3</span><span class="p">),</span>
<span class="w">  </span><span class="n">freq</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">8</span><span class="p">))</span><span class="w"> </span>
<span class="nf">lines</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nf">dnorm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="o">=</span><span class="n">mu0</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="o">=</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">s20</span><span class="p">)),</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="c1">## prior</span>
<span class="nf">lines</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nf">dnorm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="o">=</span><span class="n">mp</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="o">=</span><span class="nf">sqrt</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="n">tp</span><span class="p">)),</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="c1">## posterior</span>
<span class="nf">legend</span><span class="p">(</span><span class="s">&quot;topleft&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;prior&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;posterior&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">lty</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/a864ffebfa76bac526d826f89a47ad9e9a3d44474f4efbf7d60365868ceeb654.png"><img alt="../_images/a864ffebfa76bac526d826f89a47ad9e9a3d44474f4efbf7d60365868ceeb654.png" src="../_images/a864ffebfa76bac526d826f89a47ad9e9a3d44474f4efbf7d60365868ceeb654.png" style="width: 300px; height: 360px;" /></a>
</div>
</div>
</section>
<section id="exercise-prior-sensitivity">
<h3>Exercise: Prior sensitivity<a class="headerlink" href="#exercise-prior-sensitivity" title="Link to this heading">#</a></h3>
<p>Change the values of the mean and the variance that you choose for the prior (“hyperparameters”). What does this do to the posterior distribution. E.g., what happens if the variance you choose is small, and <span class="math notranslate nohighlight">\(\mu_0 =2.5\)</span> or so. Is this what you expect?</p>
</section>
<section id="numerical-evaluation-of-the-posterior-with-jags">
<h3>Numerical evaluation of the posterior with JAGS<a class="headerlink" href="#numerical-evaluation-of-the-posterior-with-jags" title="Link to this heading">#</a></h3>
<p>Let’s show that we can get the same thing from JAGS that we were able to get from the analytic results. You’ll need to make sure you have installed JAGS (which must be done outside of R) and then the libraries <code class="docutils literal notranslate"><span class="pre">rjags</span></code> and <code class="docutils literal notranslate"><span class="pre">coda</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load libraries</span>
<span class="nf">require</span><span class="p">(</span><span class="n">rjags</span><span class="p">)</span><span class="w"> </span><span class="c1"># does the fitting</span>
<span class="nf">require</span><span class="p">(</span><span class="n">coda</span><span class="p">)</span><span class="w"> </span><span class="c1"># makes diagnostic plots</span>
<span class="c1">##require(mcmcplots) # another option for diagnostic plots</span>
</pre></div>
</div>
</div>
</div>
<section id="specifying-the-model">
<h4>Specifying the model<a class="headerlink" href="#specifying-the-model" title="Link to this heading">#</a></h4>
<p>First we must encode our choices for our data model and priors to pass them to the fitting routines in JAGS. This involves setting up a <span class="math notranslate nohighlight">\({\tt model}\)</span> that includes the likelihood for each data point and a prior for every parameter we want to estimate. Here is an example of how we would do this for the simple model we fit for the midge data (note that JAGS uses the precision instead of the variance or sd for the normal distribution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">model1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;model{</span>

<span class="s"> ## Likelihood</span>
<span class="s"> for(i in 1:n){</span>
<span class="s"> Y[i] ~ dnorm(mu,tau)</span>
<span class="s"> }</span>

<span class="s"> ## Prior for mu</span>
<span class="s"> mu  ~ dnorm(mu0,tau0)</span>

<span class="s">} ## close model </span>
<span class="s">&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>Now create the JAGS model:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">jags.model</span><span class="p">(</span><span class="nf">textConnection</span><span class="p">(</span><span class="n">model1</span><span class="p">),</span><span class="w"> </span>
<span class="w">     </span><span class="n">n.chains</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="c1">## usually do more</span>
<span class="w">     </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="c1">## data</span>
<span class="w">        </span><span class="n">mu0</span><span class="o">=</span><span class="n">mu0</span><span class="p">,</span><span class="w"> </span><span class="n">tau0</span><span class="o">=</span><span class="m">1</span><span class="o">/</span><span class="n">s20</span><span class="p">,</span><span class="w"> </span><span class="c1">## hyperparams</span>
<span class="w">        </span><span class="n">tau</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="n">s2</span><span class="w"> </span><span class="c1">## known precision</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">     </span><span class="n">inits</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="c1">## setting an starting val</span>
<span class="w">     </span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 9
   Unobserved stochastic nodes: 1
   Total graph size: 14

Initializing model
</pre></div>
</div>
</div>
</div>
<p>Now we’ll run the MCMC and, see how the output looks for a short chain with no burnin:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">samp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">coda.samples</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="n">variable.names</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;mu&quot;</span><span class="p">),</span><span class="w"> </span>
<span class="w">  </span><span class="n">n.iter</span><span class="o">=</span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="n">progress.bar</span><span class="o">=</span><span class="s">&quot;none&quot;</span><span class="p">)</span>

<span class="nf">plot</span><span class="p">(</span><span class="n">samp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/17145c1320d08ae07f106816d9e06ea99442ce04162a3dc4565c682fd6b76da2.png"><img alt="../_images/17145c1320d08ae07f106816d9e06ea99442ce04162a3dc4565c682fd6b76da2.png" src="../_images/17145c1320d08ae07f106816d9e06ea99442ce04162a3dc4565c682fd6b76da2.png" style="width: 300px; height: 360px;" /></a>
</div>
</div>
<p>MCMC is a rejection algorithm that often needs to converge or “burn-in” – that is we need to potentially move until we’re taking draws from the correct distribution. Unlike for optimization problems, this does not mean that the algorithm :eads toward a single value. Instead we’re looking for a pattern where the draws are seemingly unrelated and random. To assess convergence we look at trace plots, the goal is to get traces that look like “fuzzy caterpillars”.</p>
<p>Sometimes at the beginning of a run, if we start far from the area near the posterior mean of the parameter, we will instead get something that looks like a trending time series. If this is the case we have to drop the samples that were taken during the burn-in phase. Here’s an example of how to do that:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">update</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="m">10000</span><span class="p">,</span><span class="w"> </span><span class="n">progress.bar</span><span class="o">=</span><span class="s">&quot;none&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1"># Burnin for 10000 samples</span>

<span class="n">samp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">coda.samples</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="n">variable.names</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;mu&quot;</span><span class="p">),</span><span class="w"> </span>
<span class="w">  </span><span class="n">n.iter</span><span class="o">=</span><span class="m">20000</span><span class="p">,</span><span class="w"> </span><span class="n">progress.bar</span><span class="o">=</span><span class="s">&quot;none&quot;</span><span class="p">)</span>

<span class="nf">plot</span><span class="p">(</span><span class="n">samp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/693cd66f30f72c5cf3264974936730ab02b9ebf78bd18ce02f58f73f74bd63e5.png"><img alt="../_images/693cd66f30f72c5cf3264974936730ab02b9ebf78bd18ce02f58f73f74bd63e5.png" src="../_images/693cd66f30f72c5cf3264974936730ab02b9ebf78bd18ce02f58f73f74bd63e5.png" style="width: 300px; height: 360px;" /></a>
</div>
</div>
<p>This is a very fuzzy caterpillar!</p>
<p>We can also use the summary function to examine the samples generated:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">summary</span><span class="p">(</span><span class="n">samp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Iterations = 11001:31000
Thinning interval = 1 
Number of chains = 1 
Sample size per chain = 20000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

          Mean             SD       Naive SE Time-series SE 
      1.804998       0.052754       0.000373       0.000373 

2. Quantiles for each variable:

 2.5%   25%   50%   75% 97.5% 
1.702 1.769 1.805 1.840 1.908 
</pre></div>
</div>
</div>
</div>
<p>Let’s compare these draws to what we got with our analytic solution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">1.3</span><span class="p">,</span><span class="m">2.3</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="o">=</span><span class="m">1000</span><span class="p">)</span>
<span class="nf">hist</span><span class="p">(</span><span class="n">samp</span><span class="p">[[</span><span class="m">1</span><span class="p">]],</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;mu&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1.3</span><span class="p">,</span><span class="w"> </span><span class="m">2.3</span><span class="p">),</span>
<span class="w">  </span><span class="n">freq</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">8</span><span class="p">),</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="s">&quot;posterior samples&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="nf">lines</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nf">dnorm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="o">=</span><span class="n">mu0</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="o">=</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">s20</span><span class="p">)),</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="c1">## prior</span>
<span class="nf">lines</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nf">dnorm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="o">=</span><span class="n">mp</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="o">=</span><span class="nf">sqrt</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="n">tp</span><span class="p">)),</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="c1">## posterior</span>
<span class="nf">legend</span><span class="p">(</span><span class="s">&quot;topleft&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;prior&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;analytic posterior&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">lty</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/a3ab903c4e2aa8efdfb9f321783beccbf9156541418d55fb9055558ef6ad136a.png"><img alt="../_images/a3ab903c4e2aa8efdfb9f321783beccbf9156541418d55fb9055558ef6ad136a.png" src="../_images/a3ab903c4e2aa8efdfb9f321783beccbf9156541418d55fb9055558ef6ad136a.png" style="width: 300px; height: 360px;" /></a>
</div>
</div>
<p>It worked!</p>
<p>As with the analytic approach, it’s always a good idea when you run your analyses to see how sensitive is your result to the priors you choose. Unless you are purposefully choosing an informative prior, we usually want the prior and posterior to look different.</p>
</section>
</section>
<section id="estimating-the-population-variance">
<h3>Estimating the population variance<a class="headerlink" href="#estimating-the-population-variance" title="Link to this heading">#</a></h3>
<p>One advantage of the numerical approach is that we can choose almost anything we want for the priors on multiple parameters without worrying if they are conjugate, or if we want to include additional information. For example, let’s say that, not, we want to force the mean to be positive (and also the data, perhaps), and concurrently estimate the variance. Here is a possible model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">model2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;model{</span>

<span class="s"> # Likelihood</span>
<span class="s"> for(i in 1:n){</span>
<span class="s"> Y[i] ~ dnorm(mu,tau) T(0,) ## truncates at 0</span>
<span class="s"> }</span>

<span class="s"> # Prior for mu</span>
<span class="s"> mu ~ dnorm(mu0,tau0)</span>

<span class="s"> # Prior for the precision</span>
<span class="s"> tau ~ dgamma(a, b)</span>

<span class="s"> # Compute the variance</span>
<span class="s"> s2  &lt;- 1/tau</span>
<span class="s">}&quot;</span>

<span class="c1">## hyperparams for tau</span>
<span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.01</span>
<span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.01</span>

<span class="n">m2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">jags.model</span><span class="p">(</span><span class="nf">textConnection</span><span class="p">(</span><span class="n">model2</span><span class="p">),</span><span class="w"> </span>
<span class="w">     </span><span class="n">n.chains</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span>
<span class="w">     </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
<span class="w">        </span><span class="n">mu0</span><span class="o">=</span><span class="n">mu0</span><span class="p">,</span><span class="w"> </span><span class="n">tau0</span><span class="o">=</span><span class="m">1</span><span class="o">/</span><span class="n">s20</span><span class="p">,</span><span class="w"> </span><span class="c1">## mu hyperparams</span>
<span class="w">        </span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="w"> </span><span class="c1">## tau hyperparams</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">     </span><span class="n">inits</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">tau</span><span class="o">=</span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="c1">## starting vals</span>
<span class="w">    </span><span class="p">)</span>

<span class="n">samp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">coda.samples</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="n">variable.names</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;mu&quot;</span><span class="p">,</span><span class="s">&quot;s2&quot;</span><span class="p">),</span><span class="w"> </span>
<span class="w">  </span><span class="n">n.iter</span><span class="o">=</span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="n">progress.bar</span><span class="o">=</span><span class="s">&quot;none&quot;</span><span class="p">)</span>

<span class="nf">plot</span><span class="p">(</span><span class="n">samp</span><span class="p">)</span>

<span class="nf">summary</span><span class="p">(</span><span class="n">samp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 9
   Unobserved stochastic nodes: 2
   Total graph size: 740

Initializing model
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Iterations = 1001:2000
Thinning interval = 1 
Number of chains = 1 
Sample size per chain = 1000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

      Mean      SD  Naive SE Time-series SE
mu 0.06889 0.10389 0.0032853       0.016476
s2 0.01029 0.01799 0.0005689       0.002442

2. Quantiles for each variable:

        2.5%      25%      50%     75%  97.5%
mu -0.288547 0.071837 0.103609 0.11822 0.1525
s2  0.001188 0.002328 0.003969 0.01011 0.0590
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/9e384ef562d2b0515a830d5eab1fc1ca5a884d7d2b676733dd5a7857e7e05d58.png"><img alt="../_images/9e384ef562d2b0515a830d5eab1fc1ca5a884d7d2b676733dd5a7857e7e05d58.png" src="../_images/9e384ef562d2b0515a830d5eab1fc1ca5a884d7d2b676733dd5a7857e7e05d58.png" style="width: 300px; height: 360px;" /></a>
</div>
</div>
<p>Now we plot each with their priors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">bty</span><span class="o">=</span><span class="s">&quot;n&quot;</span><span class="p">)</span>

<span class="nf">hist</span><span class="p">(</span><span class="n">samp</span><span class="p">[[</span><span class="m">1</span><span class="p">]][,</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;samples of mu&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s">&quot;mu&quot;</span><span class="p">)</span>
<span class="nf">lines</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nf">dnorm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="o">=</span><span class="n">mu0</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="o">=</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">s20</span><span class="p">)),</span><span class="w"> </span>
<span class="w">  </span><span class="n">col</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="c1">## prior</span>

<span class="n">x2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">200</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="o">=</span><span class="m">1000</span><span class="p">)</span>
<span class="nf">hist</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="n">samp</span><span class="p">[[</span><span class="m">1</span><span class="p">]][,</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;samples of tau&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s">&quot;tau&quot;</span><span class="p">)</span>
<span class="nf">lines</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="nf">dgamma</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">rate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">),</span><span class="w"> </span>
<span class="w">  </span><span class="n">col</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="c1">## prior</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/da04a465632984a89145836411b30332d6cf3a408db2941806bf78918ac37cd4.png"><img alt="../_images/da04a465632984a89145836411b30332d6cf3a408db2941806bf78918ac37cd4.png" src="../_images/da04a465632984a89145836411b30332d6cf3a408db2941806bf78918ac37cd4.png" style="width: 300px; height: 360px;" /></a>
</div>
</div>
<p>We also want to look at the joint distribution of <span class="math notranslate nohighlight">\(\mu\)</span> and <span class="math notranslate nohighlight">\(\sigma^2\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">plot</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">samp</span><span class="p">[[</span><span class="m">1</span><span class="p">]][,</span><span class="m">1</span><span class="p">]),</span><span class="w"> </span><span class="n">samp</span><span class="p">[[</span><span class="m">1</span><span class="p">]][,</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;mu&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;s2&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/5b2b64d5b9a8237f607c3a1003626aab282bec9d33120e7255e7135a1abbf03a.png"><img alt="../_images/5b2b64d5b9a8237f607c3a1003626aab282bec9d33120e7255e7135a1abbf03a.png" src="../_images/5b2b64d5b9a8237f607c3a1003626aab282bec9d33120e7255e7135a1abbf03a.png" style="width: 300px; height: 360px;" /></a>
</div>
</div>
</section>
<section id="exercise-updating-the-bayesian-model">
<h3>Exercise: Updating the Bayesian model<a class="headerlink" href="#exercise-updating-the-bayesian-model" title="Link to this heading">#</a></h3>
<p>Redo the previous analysis placing a gamma prior on <span class="math notranslate nohighlight">\(\mu\)</span> as well. Set the prior so that the mean and variance are the same as in the normal example from above (use moment matching). Do you get something similar?</p>
</section>
</section>
<section id="aedes-data-revisited-using-bayesian-fitting">
<h2>Aedes data revisited using Bayesian fitting<a class="headerlink" href="#aedes-data-revisited-using-bayesian-fitting" title="Link to this heading">#</a></h2>
<p>Now let’s do some Bayesian model fitting to * Aedes * thermal performance data. Lets try out the <code class="docutils literal notranslate"><span class="pre">R2jags</span></code> package for this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">require</span><span class="p">(</span><span class="n">R2jags</span><span class="p">)</span><span class="w"> </span><span class="c1"># fitting</span>
<span class="nf">require</span><span class="p">(</span><span class="n">coda</span><span class="p">)</span><span class="w"> </span><span class="c1"># diagnostic plots</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">1234</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loading required package: R2jags

Loading required package: rjags

Linked to JAGS 4.3.0

Loaded modules: basemod,bugs


Attaching package: ‘R2jags’


The following object is masked from ‘package:coda’:

    traceplot
</pre></div>
</div>
</div>
</div>
<p>Load the data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">Aaeg.data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read.csv</span><span class="p">(</span><span class="s">&quot;../data/AeaegyptiTraitData.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="the-data">
<h3>The Data<a class="headerlink" href="#the-data" title="Link to this heading">#</a></h3>
<p>These data are traits from * Aedes aegypti * mosquitoes measured across temperature in lab experiments. The traits we have data on thermal performance are:</p>
<ul class="simple">
<li><p>pEA: proportion surviving from egg to adulthood</p></li>
<li><p>MDR: mosquito development rate</p></li>
<li><p>PDR: parasite development rate (= 1/EIP the extrinsic incubation period)</p></li>
<li><p><span class="math notranslate nohighlight">\(\mu\)</span> (mu): death rate (= 1/longevity)</p></li>
</ul>
<p>Note that some of the traits come in multiple forms (e.g., <span class="math notranslate nohighlight">\(\mu\)</span> and 1/<span class="math notranslate nohighlight">\(\mu\)</span>, PDR and EIP).</p>
<p>Have a look at the data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">head</span><span class="p">(</span><span class="n">Aaeg.data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<caption>A data.frame: 6 × 6</caption>
<thead>
	<tr><th></th><th scope=col>trait.name</th><th scope=col>T</th><th scope=col>trait</th><th scope=col>ref</th><th scope=col>trait2</th><th scope=col>trait2.name</th></tr>
	<tr><th></th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>pEA</td><td>22</td><td>0.90812</td><td>Westbrook_Thesis_2010</td><td>NA</td><td>NA</td></tr>
	<tr><th scope=row>2</th><td>pEA</td><td>27</td><td>0.93590</td><td>Westbrook_Thesis_2010</td><td>NA</td><td>NA</td></tr>
	<tr><th scope=row>3</th><td>pEA</td><td>32</td><td>0.81944</td><td>Westbrook_Thesis_2010</td><td>NA</td><td>NA</td></tr>
	<tr><th scope=row>4</th><td>MDR</td><td>22</td><td>0.09174</td><td>Westbrook_Thesis_2010</td><td>NA</td><td>NA</td></tr>
	<tr><th scope=row>5</th><td>MDR</td><td>27</td><td>0.13587</td><td>Westbrook_Thesis_2010</td><td>NA</td><td>NA</td></tr>
	<tr><th scope=row>6</th><td>MDR</td><td>32</td><td>0.15823</td><td>Westbrook_Thesis_2010</td><td>NA</td><td>NA</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mu.data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">subset</span><span class="p">(</span><span class="n">Aaeg.data</span><span class="p">,</span><span class="w"> </span><span class="n">trait.name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mu&quot;</span><span class="p">)</span>
<span class="n">lf.data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">subset</span><span class="p">(</span><span class="n">Aaeg.data</span><span class="p">,</span><span class="w"> </span><span class="n">trait.name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;1/mu&quot;</span><span class="p">)</span>
<span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">bty</span><span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="nf">plot</span><span class="p">(</span><span class="n">trait</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="bp">T</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mu.data</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;mu&quot;</span><span class="p">)</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">trait</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="bp">T</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lf.data</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;1/mu&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/ef7e49b73c6cb5b394ce1182dd9c40d5fc73dca63a8168cba5fdf184ccd696c9.png"><img alt="../_images/ef7e49b73c6cb5b394ce1182dd9c40d5fc73dca63a8168cba5fdf184ccd696c9.png" src="../_images/ef7e49b73c6cb5b394ce1182dd9c40d5fc73dca63a8168cba5fdf184ccd696c9.png" style="width: 300px; height: 360px;" /></a>
</div>
</div>
<p>Note that the <span class="math notranslate nohighlight">\(\mu\)</span> data is u-shaped and the lifespan data is unimodal (hump-shaped).</p>
<p>Since thermal biology theory is based on unimodal thermal responses, we want to fit the trait as lifespan instead of <span class="math notranslate nohighlight">\(\mu\)</span>. Thus, we’ll need to convert the <span class="math notranslate nohighlight">\(\mu\)</span> data to lifespan by taking the inverse. The combined data should have a nice unimodal shape that we can fit a function to:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mu.data.inv</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mu.data</span><span class="w"> </span><span class="c1"># make a copy of the mu data</span>
<span class="n">mu.data.inv</span><span class="o">$</span><span class="n">trait</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="n">mu.data</span><span class="o">$</span><span class="n">trait</span><span class="w"> </span><span class="c1"># take the inverse of the trait values to convert mu to lifespan</span>
<span class="n">lf.data.comb</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rbind</span><span class="p">(</span><span class="n">mu.data.inv</span><span class="p">,</span><span class="w"> </span><span class="n">lf.data</span><span class="p">)</span><span class="w"> </span><span class="c1"># combine both lifespan data sets together </span>
<span class="w"> </span>
<span class="nf">plot</span><span class="p">(</span><span class="n">trait</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="bp">T</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lf.data.comb</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;1/mu&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/24d9c15670bd1a8788d0629185fa78ea985be13baf049987315b261abbe88a85.png"><img alt="../_images/24d9c15670bd1a8788d0629185fa78ea985be13baf049987315b261abbe88a85.png" src="../_images/24d9c15670bd1a8788d0629185fa78ea985be13baf049987315b261abbe88a85.png" style="width: 300px; height: 360px;" /></a>
</div>
</div>
</section>
<section id="two-thermal-performance-curve-models">
<h3>Two thermal performance curve models<a class="headerlink" href="#two-thermal-performance-curve-models" title="Link to this heading">#</a></h3>
<p>Most thermal response curves can be reasonably fit using one of two thermal reponses. Traits that respond unimodally but symmetrically to temperature can be fit with a quadratic function:</p>
<p><span class="math notranslate nohighlight">\( B = q (T-T_0) (T-T_m)\)</span></p>
<p>Traits that respond unimodally but asymmetrically can be fitted with a Briere function (see definition <a class="reference internal" href="Appendix-MiniProj.html#miniproj-tpcs-models"><span class="std std-ref">here</span></a>).</p>
<p>In both models, <span class="math notranslate nohighlight">\(T_0\)</span> is the lower thermal limit, <span class="math notranslate nohighlight">\(T_m\)</span> is the upper thermal limit (i.e., where the trait value goes to zero on either end), and <span class="math notranslate nohighlight">\(q\)</span> scales the elevation of the curve, (and so also the value at the optimum temperature).</p>
</section>
<section id="the-thermal-response-model-file">
<h3>The thermal response model file<a class="headerlink" href="#the-thermal-response-model-file" title="Link to this heading">#</a></h3>
<p>Unlike the previous bayesian \example, here we will provide jags with the model written as a <code class="docutils literal notranslate"><span class="pre">.txt</span></code> file. THis can be in your working directory, or elsewhere (but then inout the full path to it — ideally a relative path).</p>
<p>You can either write the text yourself directly to the file, or create it using the sink() function via your R script (see below):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">sink</span><span class="p">(</span><span class="s">&quot;quad.txt&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1"># create a file</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;</span>
<span class="s"> model{</span>
<span class="s"> </span>
<span class="s"> ## Priors</span>
<span class="s"> cf.q ~ dunif(0, 1)</span>
<span class="s"> cf.T0 ~ dunif(0, 24)</span>
<span class="s"> cf.Tm ~ dunif(25, 45)</span>
<span class="s"> cf.sigma ~ dunif(0, 1000)</span>
<span class="s"> cf.tau &lt;- 1 / (cf.sigma * cf.sigma)</span>
<span class="s"> </span>
<span class="s"> ## Likelihood</span>
<span class="s"> for(i in 1:N.obs){</span>
<span class="s"> trait.mu[i] &lt;- -1 * cf.q * (temp[i] - cf.T0) * (temp[i] - cf.Tm) * (cf.Tm &gt; temp[i]) * (cf.T0 &lt; temp[i])</span>
<span class="s"> trait[i] ~ dnorm(trait.mu[i], cf.tau)</span>
<span class="s"> }</span>
<span class="s"> </span>
<span class="s"> ## Derived Quantities and Predictions</span>
<span class="s"> for(i in 1:N.Temp.xs){</span>
<span class="s"> z.trait.mu.pred[i] &lt;- -1 * cf.q * (Temp.xs[i] - cf.T0) * (Temp.xs[i] - cf.Tm) * (cf.Tm &gt; Temp.xs[i]) * (cf.T0 &lt; Temp.xs[i])</span>
<span class="s"> }</span>
<span class="s"> } # close model</span>
<span class="s">&quot;</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="nf">sink</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> model{
 
 ## Priors
 cf.q ~ dunif(0, 1)
 cf.T0 ~ dunif(0, 24)
 cf.Tm ~ dunif(25, 45)
 cf.sigma ~ dunif(0, 1000)
 cf.tau &lt;- 1 / (cf.sigma * cf.sigma)
 
 ## Likelihood
 for(i in 1:N.obs){
 trait.mu[i] &lt;- -1 * cf.q * (temp[i] - cf.T0) * (temp[i] - cf.Tm) * (cf.Tm &gt; temp[i]) * (cf.T0 &lt; temp[i])
 trait[i] ~ dnorm(trait.mu[i], cf.tau)
 }
 
 ## Derived Quantities and Predictions
 for(i in 1:N.Temp.xs){
 z.trait.mu.pred[i] &lt;- -1 * cf.q * (Temp.xs[i] - cf.T0) * (Temp.xs[i] - cf.Tm) * (cf.Tm &gt; Temp.xs[i]) * (cf.T0 &lt; Temp.xs[i])
 }
 } # close model
</pre></div>
</div>
</div>
</div>
<p>Note that the model file <code class="docutils literal notranslate"><span class="pre">quad.txt</span></code> has two mandatory sections (the priors and the likelihood) and one optional section (derived measures calculated from your fitted parameters).</p>
<p>In the example below for a quadratic function, most of the priors are specified via uniform distributions (the two arguments specific the lower and upper bounds, respectively). Note that unlike in R and most other programs, in jags, the inverse of the variance of the normal distribution is used, denoted by <span class="math notranslate nohighlight">\(\tau (= \frac{1}{\sigma^2}\)</span>).</p>
<p>The likelihood for can be interpreted as follows: the observed data are normally distributed where the mean at a given temperature follows the quadratic equation.</p>
<p>Now, prepare the data for jags:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameters to Estimate</span>
<span class="n">parameters</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;cf.q&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cf.T0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cf.Tm&quot;</span><span class="p">,</span><span class="s">&quot;cf.sigma&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;z.trait.mu.pred&quot;</span><span class="p">)</span>

<span class="c1"># Initial values for the parameters</span>
<span class="n">inits</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(){</span><span class="nf">list</span><span class="p">(</span>
<span class="w"> </span><span class="n">cf.q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">,</span>
<span class="w"> </span><span class="n">cf.Tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">35</span><span class="p">,</span>
<span class="w"> </span><span class="n">cf.T0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span>
<span class="w"> </span><span class="n">cf.sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rlnorm</span><span class="p">(</span><span class="m">1</span><span class="p">))}</span>

<span class="c1"># MCMC Settings: number of posterior dist elements = [(ni - nb) / nt ] * nc</span>
<span class="n">ni</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">25000</span><span class="w"> </span><span class="c1"># number of iterations in each chain</span>
<span class="n">nb</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">5000</span><span class="w"> </span><span class="c1"># number of &#39;burn in&#39; iterations to discard</span>
<span class="n">nt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="c1"># thinning rate - jags saves every nt iterations in each chain</span>
<span class="n">nc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="c1"># number of chains</span>

<span class="c1"># Temperature sequence for derived quantity calculations</span>
<span class="n">Temp.xs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">45</span><span class="p">,</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span>
<span class="n">N.Temp.xs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">Temp.xs</span><span class="p">)</span>

<span class="c1">### Fitting the trait thermal response; Pull out data columns as vectors</span>
<span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lf.data.comb</span><span class="w"> </span><span class="c1"># this lets us reuse the same generic code: we only change this first line</span>
<span class="n">trait</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">trait</span>
<span class="n">N.obs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">trait</span><span class="p">)</span>
<span class="n">temp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="bp">T</span>

<span class="c1"># Bundle all data in a list for JAGS</span>
<span class="n">jag.data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">trait</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trait</span><span class="p">,</span><span class="w"> </span><span class="n">N.obs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N.obs</span><span class="p">,</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">Temp.xs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Temp.xs</span><span class="p">,</span><span class="w"> </span><span class="n">N.Temp.xs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N.Temp.xs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now run the fitting using jags:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">lf.fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">jags</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">jag.data</span><span class="p">,</span><span class="w"> </span><span class="n">inits</span><span class="o">=</span><span class="n">inits</span><span class="p">,</span><span class="w"> </span><span class="n">parameters.to.save</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">model.file</span><span class="o">=</span><span class="s">&quot;quad.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">n.thin</span><span class="o">=</span><span class="n">nt</span><span class="p">,</span><span class="w"> </span><span class="n">n.chains</span><span class="o">=</span><span class="n">nc</span><span class="p">,</span><span class="w"> </span><span class="n">n.burnin</span><span class="o">=</span><span class="n">nb</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">n.iter</span><span class="o">=</span><span class="n">ni</span><span class="p">,</span><span class="w"> </span><span class="n">DIC</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span><span class="w"> </span><span class="n">working.directory</span><span class="o">=</span><span class="nf">getwd</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>module glm loaded

Warning message in jags.model(model.file, data = data, inits = init.values, n.chains = n.chains, :
“Unused variable &quot;trait&quot; in data”
Warning message in jags.model(model.file, data = data, inits = init.values, n.chains = n.chains, :
“Unused variable &quot;N.obs&quot; in data”
Warning message in jags.model(model.file, data = data, inits = init.values, n.chains = n.chains, :
“Unused variable &quot;temp&quot; in data”
Warning message in jags.model(model.file, data = data, inits = init.values, n.chains = n.chains, :
“Unused variable &quot;Temp.xs&quot; in data”
Warning message in jags.model(model.file, data = data, inits = init.values, n.chains = n.chains, :
“Unused variable &quot;N.Temp.xs&quot; in data”
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Compiling model graph
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="n">jags</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span> <span class="n">inits</span> <span class="o">=</span> <span class="n">init</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">chains</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">chains</span><span class="p">,</span> <span class="p">:</span> <span class="n">Nothing</span> <span class="n">to</span> <span class="nb">compile</span>


<span class="ne">Traceback</span>:

<span class="mi">1</span><span class="o">.</span> <span class="n">jags</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">jag</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">inits</span> <span class="o">=</span> <span class="n">inits</span><span class="p">,</span> <span class="n">parameters</span><span class="o">.</span><span class="n">to</span><span class="o">.</span><span class="n">save</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">,</span> 
 <span class="o">.</span>     <span class="n">model</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="s2">&quot;quad.txt&quot;</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">thin</span> <span class="o">=</span> <span class="n">nt</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">chains</span> <span class="o">=</span> <span class="n">nc</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">burnin</span> <span class="o">=</span> <span class="n">nb</span><span class="p">,</span> 
 <span class="o">.</span>     <span class="n">n</span><span class="o">.</span><span class="n">iter</span> <span class="o">=</span> <span class="n">ni</span><span class="p">,</span> <span class="n">DIC</span> <span class="o">=</span> <span class="n">T</span><span class="p">,</span> <span class="n">working</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">getwd</span><span class="p">())</span>
<span class="mi">2</span><span class="o">.</span> <span class="n">jags</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span> <span class="n">inits</span> <span class="o">=</span> <span class="n">init</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">chains</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">chains</span><span class="p">,</span> 
 <span class="o">.</span>     <span class="n">n</span><span class="o">.</span><span class="n">adapt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Change into “mcmc” type samples for visualization with the <code class="docutils literal notranslate"><span class="pre">coda</span></code> package:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">lf.fit.mcmc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.mcmc</span><span class="p">(</span><span class="n">lf.fit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="k">as</span><span class="o">.</span><span class="n">mcmc</span><span class="p">(</span><span class="n">lf</span><span class="o">.</span><span class="n">fit</span><span class="p">):</span> <span class="nb">object</span> <span class="s1">&#39;lf.fit&#39;</span> <span class="ow">not</span> <span class="n">found</span>
<span class="ne">Traceback</span>:

<span class="mi">1</span><span class="o">.</span> <span class="k">as</span><span class="o">.</span><span class="n">mcmc</span><span class="p">(</span><span class="n">lf</span><span class="o">.</span><span class="n">fit</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="running-diagnostics">
<h3>Running diagnostics<a class="headerlink" href="#running-diagnostics" title="Link to this heading">#</a></h3>
<p>View the parameters (only the first 5 lines, or it will also show you all of your derived quantities):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">lf.fit</span><span class="o">$</span><span class="n">BUGSoutput</span><span class="o">$</span><span class="n">summary</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="nb">eval</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">envir</span><span class="p">,</span> <span class="n">enclos</span><span class="p">):</span> <span class="nb">object</span> <span class="s1">&#39;lf.fit&#39;</span> <span class="ow">not</span> <span class="n">found</span>
<span class="ne">Traceback</span>:
</pre></div>
</div>
</div>
</div>
<p>Plot the chains:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">plot</span><span class="p">(</span><span class="n">lf.fit.mcmc</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="n">plot</span><span class="p">(</span><span class="n">lf</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="n">mcmc</span><span class="p">[,</span> <span class="n">c</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]):</span> <span class="nb">object</span> <span class="s1">&#39;lf.fit.mcmc&#39;</span> <span class="ow">not</span> <span class="n">found</span>
<span class="ne">Traceback</span>:

<span class="mi">1</span><span class="o">.</span> <span class="n">plot</span><span class="p">(</span><span class="n">lf</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="n">mcmc</span><span class="p">[,</span> <span class="n">c</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plot-the-fits">
<h3>Plot the fits<a class="headerlink" href="#plot-the-fits" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">plot</span><span class="p">(</span><span class="n">trait</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="bp">T</span><span class="p">,</span><span class="w"> </span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">45</span><span class="p">),</span><span class="w"> </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">42</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lf.data.comb</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Lifespan for Ae. aegypti&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Temperature&quot;</span><span class="p">)</span>
<span class="nf">lines</span><span class="p">(</span><span class="n">lf.fit</span><span class="o">$</span><span class="n">BUGSoutput</span><span class="o">$</span><span class="n">summary</span><span class="p">[</span><span class="m">6</span><span class="o">:</span><span class="p">(</span><span class="m">6</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">N.Temp.xs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;2.5%&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Temp.xs</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
<span class="nf">lines</span><span class="p">(</span><span class="n">lf.fit</span><span class="o">$</span><span class="n">BUGSoutput</span><span class="o">$</span><span class="n">summary</span><span class="p">[</span><span class="m">6</span><span class="o">:</span><span class="p">(</span><span class="m">6</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">N.Temp.xs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;97.5%&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Temp.xs</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
<span class="nf">lines</span><span class="p">(</span><span class="n">lf.fit</span><span class="o">$</span><span class="n">BUGSoutput</span><span class="o">$</span><span class="n">summary</span><span class="p">[</span><span class="m">6</span><span class="o">:</span><span class="p">(</span><span class="m">6</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">N.Temp.xs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;mean&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Temp.xs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="nb">eval</span><span class="p">(</span><span class="n">predvars</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span> <span class="nb">object</span> <span class="s1">&#39;lf.fit&#39;</span> <span class="ow">not</span> <span class="n">found</span>
<span class="ne">Traceback</span>:

<span class="mi">1</span><span class="o">.</span> <span class="n">lines</span><span class="p">(</span><span class="n">lf</span><span class="o">.</span><span class="n">fit</span><span class="err">$</span><span class="n">BUGSoutput</span><span class="err">$</span><span class="n">summary</span><span class="p">[</span><span class="mi">6</span><span class="p">:(</span><span class="mi">6</span> <span class="o">+</span> <span class="n">N</span><span class="o">.</span><span class="n">Temp</span><span class="o">.</span><span class="n">xs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;2.5%&quot;</span><span class="p">]</span> <span class="o">~</span> 
 <span class="o">.</span>     <span class="n">Temp</span><span class="o">.</span><span class="n">xs</span><span class="p">,</span> <span class="n">lty</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="mi">2</span><span class="o">.</span> <span class="n">lines</span><span class="o">.</span><span class="n">formula</span><span class="p">(</span><span class="n">lf</span><span class="o">.</span><span class="n">fit</span><span class="err">$</span><span class="n">BUGSoutput</span><span class="err">$</span><span class="n">summary</span><span class="p">[</span><span class="mi">6</span><span class="p">:(</span><span class="mi">6</span> <span class="o">+</span> <span class="n">N</span><span class="o">.</span><span class="n">Temp</span><span class="o">.</span><span class="n">xs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> 
 <span class="o">.</span>     <span class="s2">&quot;2.5%&quot;</span><span class="p">]</span> <span class="o">~</span> <span class="n">Temp</span><span class="o">.</span><span class="n">xs</span><span class="p">,</span> <span class="n">lty</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="mi">3</span><span class="o">.</span> <span class="nb">eval</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">eframe</span><span class="p">)</span>
<span class="mi">4</span><span class="o">.</span> <span class="nb">eval</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">eframe</span><span class="p">)</span>
<span class="mi">5</span><span class="o">.</span> <span class="p">(</span><span class="n">function</span> <span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">,</span> <span class="n">subset</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">,</span> <span class="n">na</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">na</span><span class="o">.</span><span class="n">fail</span><span class="p">,</span> 
 <span class="o">.</span>     <span class="n">drop</span><span class="o">.</span><span class="n">unused</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">xlev</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span> 
 <span class="o">.</span> <span class="p">{</span>
 <span class="o">.</span>     <span class="n">possible_newdata</span> <span class="o">&lt;-</span> <span class="o">!</span>missing<span class="o">(</span>data<span class="o">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>is.data.frame<span class="o">(</span>data<span class="o">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>
 <span class="o">.</span>         <span class="n">identical</span><span class="p">(</span><span class="n">substitute</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">quote</span><span class="p">(</span><span class="n">newdata</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">nr</span> <span class="o">&lt;-</span> <span class="n">nrow</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">&gt;</span> 
 <span class="o">.</span>         <span class="mi">0</span>
 <span class="o">.</span>     <span class="k">if</span> <span class="p">(</span><span class="o">!</span>missing<span class="o">(</span>formula<span class="o">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>nargs<span class="o">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>is.list<span class="o">(</span>formula<span class="o">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>
 <span class="o">.</span>         <span class="o">!</span>is.null<span class="o">(</span>m<span class="w"> </span>&lt;-<span class="w"> </span>formula<span class="nv">$model</span><span class="o">))</span><span class="w"> </span>
 <span class="o">.</span>         <span class="k">return</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
 <span class="o">.</span>     <span class="k">if</span> <span class="p">(</span><span class="o">!</span>missing<span class="o">(</span>formula<span class="o">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>nargs<span class="o">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>is.list<span class="o">(</span>formula<span class="o">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>
 <span class="o">.</span>         <span class="nb">all</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="s2">&quot;terms&quot;</span><span class="p">,</span> <span class="s2">&quot;call&quot;</span><span class="p">)</span> <span class="o">%</span><span class="k">in</span>% names(formula))) {
 <span class="o">.</span>         <span class="n">fcall</span> <span class="o">&lt;-</span> <span class="n">formula</span><span class="err">$</span><span class="n">call</span>
 <span class="o">.</span>         <span class="n">m</span> <span class="o">&lt;-</span> <span class="n">match</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="s2">&quot;formula&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;subset&quot;</span><span class="p">,</span> <span class="s2">&quot;weights&quot;</span><span class="p">,</span> 
 <span class="o">.</span>             <span class="s2">&quot;na.action&quot;</span><span class="p">),</span> <span class="n">names</span><span class="p">(</span><span class="n">fcall</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
 <span class="o">.</span>         <span class="n">fcall</span> <span class="o">&lt;-</span> <span class="n">fcall</span><span class="p">[</span><span class="n">c</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="p">)]</span>
 <span class="o">.</span>         <span class="n">fcall</span><span class="p">[[</span><span class="mi">1</span><span class="n">L</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="n">quote</span><span class="p">(</span><span class="n">stats</span><span class="p">::</span><span class="n">model</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span>
 <span class="o">.</span>         <span class="n">env</span> <span class="o">&lt;-</span> <span class="n">environment</span><span class="p">(</span><span class="n">formula</span><span class="err">$</span><span class="n">terms</span><span class="p">)</span>
 <span class="o">.</span>         <span class="k">if</span> <span class="p">(</span><span class="ow">is</span><span class="o">.</span><span class="n">null</span><span class="p">(</span><span class="n">env</span><span class="p">))</span> 
 <span class="o">.</span>             <span class="n">env</span> <span class="o">&lt;-</span> <span class="n">parent</span><span class="o">.</span><span class="n">frame</span><span class="p">()</span>
 <span class="o">.</span>         <span class="k">return</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">fcall</span><span class="p">,</span> <span class="n">env</span><span class="p">))</span>
 <span class="o">.</span>     <span class="p">}</span>
 <span class="o">.</span>     <span class="k">if</span> <span class="p">(</span><span class="n">missing</span><span class="p">(</span><span class="n">formula</span><span class="p">))</span> <span class="p">{</span>
 <span class="o">.</span>         <span class="k">if</span> <span class="p">(</span><span class="o">!</span>missing<span class="o">(</span>data<span class="o">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>inherits<span class="o">(</span>data,<span class="w"> </span><span class="s2">&quot;data.frame&quot;</span><span class="o">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>
 <span class="o">.</span>             <span class="n">length</span><span class="p">(</span><span class="n">attr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;terms&quot;</span><span class="p">)))</span> 
 <span class="o">.</span>             <span class="k">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
 <span class="o">.</span>         <span class="n">formula</span> <span class="o">&lt;-</span> <span class="k">as</span><span class="o">.</span><span class="n">formula</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
 <span class="o">.</span>     <span class="p">}</span>
 <span class="o">.</span>     <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">missing</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">inherits</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;data.frame&quot;</span><span class="p">))</span> <span class="p">{</span>
 <span class="o">.</span>         <span class="k">if</span> <span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">attr</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;terms&quot;</span><span class="p">)))</span> 
 <span class="o">.</span>             <span class="k">return</span><span class="p">(</span><span class="n">formula</span><span class="p">)</span>
 <span class="o">.</span>         <span class="n">data</span> <span class="o">&lt;-</span> <span class="n">formula</span>
 <span class="o">.</span>         <span class="n">formula</span> <span class="o">&lt;-</span> <span class="k">as</span><span class="o">.</span><span class="n">formula</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
 <span class="o">.</span>     <span class="p">}</span>
 <span class="o">.</span>     <span class="k">else</span> <span class="n">formula</span> <span class="o">&lt;-</span> <span class="k">as</span><span class="o">.</span><span class="n">formula</span><span class="p">(</span><span class="n">formula</span><span class="p">)</span>
 <span class="o">.</span>     <span class="k">if</span> <span class="p">(</span><span class="n">missing</span><span class="p">(</span><span class="n">na</span><span class="o">.</span><span class="n">action</span><span class="p">))</span> <span class="p">{</span>
 <span class="o">.</span>         <span class="k">if</span> <span class="p">(</span><span class="o">!</span>is.null<span class="o">(</span>naa<span class="w"> </span>&lt;-<span class="w"> </span>attr<span class="o">(</span>data,<span class="w"> </span><span class="s2">&quot;na.action&quot;</span><span class="o">))</span><span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>mode<span class="o">(</span>naa<span class="o">)</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span>
 <span class="o">.</span>             <span class="s2">&quot;numeric&quot;</span><span class="p">)</span> 
 <span class="o">.</span>             <span class="n">na</span><span class="o">.</span><span class="n">action</span> <span class="o">&lt;-</span> <span class="n">naa</span>
 <span class="o">.</span>         <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span>is.null<span class="o">(</span>naa<span class="w"> </span>&lt;-<span class="w"> </span>getOption<span class="o">(</span><span class="s2">&quot;na.action&quot;</span><span class="o">)))</span><span class="w"> </span>
 <span class="o">.</span>             <span class="n">na</span><span class="o">.</span><span class="n">action</span> <span class="o">&lt;-</span> <span class="n">naa</span>
 <span class="o">.</span>     <span class="p">}</span>
 <span class="o">.</span>     <span class="k">if</span> <span class="p">(</span><span class="n">missing</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> 
 <span class="o">.</span>         <span class="n">data</span> <span class="o">&lt;-</span> <span class="n">environment</span><span class="p">(</span><span class="n">formula</span><span class="p">)</span>
 <span class="o">.</span>     <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span>is.data.frame<span class="o">(</span>data<span class="o">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>!is.environment<span class="o">(</span>data<span class="o">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>
 <span class="o">.</span>         <span class="o">!</span>is.null<span class="o">(</span>attr<span class="o">(</span>data,<span class="w"> </span><span class="s2">&quot;class&quot;</span><span class="o">)))</span><span class="w"> </span>
 <span class="o">.</span>         <span class="n">data</span> <span class="o">&lt;-</span> <span class="k">as</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
 <span class="o">.</span>     <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="ow">is</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> 
 <span class="o">.</span>         <span class="n">stop</span><span class="p">(</span><span class="s2">&quot;&#39;data&#39; must be a data.frame, not a matrix or an array&quot;</span><span class="p">)</span>
 <span class="o">.</span>     <span class="k">if</span> <span class="p">(</span><span class="o">!</span>is.data.frame<span class="o">(</span>data<span class="o">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>!is.environment<span class="o">(</span>data<span class="o">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>!is.list<span class="o">(</span>data<span class="o">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>
 <span class="o">.</span>         <span class="o">!</span>is.null<span class="o">(</span>data<span class="o">))</span><span class="w"> </span>
 <span class="o">.</span>         <span class="n">stop</span><span class="p">(</span><span class="s2">&quot;&#39;data&#39; must be a data.frame, environment, or list&quot;</span><span class="p">)</span>
 <span class="o">.</span>     <span class="k">if</span> <span class="p">(</span><span class="o">!</span>inherits<span class="o">(</span>formula,<span class="w"> </span><span class="s2">&quot;terms&quot;</span><span class="o">))</span><span class="w"> </span>
 <span class="o">.</span>         <span class="n">formula</span> <span class="o">&lt;-</span> <span class="n">terms</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">)</span>
 <span class="o">.</span>     <span class="n">env</span> <span class="o">&lt;-</span> <span class="n">environment</span><span class="p">(</span><span class="n">formula</span><span class="p">)</span>
 <span class="o">.</span>     <span class="n">rownames</span> <span class="o">&lt;-</span> <span class="o">.</span><span class="n">row_names_info</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="n">L</span><span class="p">)</span>
 <span class="o">.</span>     <span class="nb">vars</span> <span class="o">&lt;-</span> <span class="n">attr</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;variables&quot;</span><span class="p">)</span>
 <span class="o">.</span>     <span class="n">predvars</span> <span class="o">&lt;-</span> <span class="n">attr</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;predvars&quot;</span><span class="p">)</span>
 <span class="o">.</span>     <span class="k">if</span> <span class="p">(</span><span class="ow">is</span><span class="o">.</span><span class="n">null</span><span class="p">(</span><span class="n">predvars</span><span class="p">))</span> 
 <span class="o">.</span>         <span class="n">predvars</span> <span class="o">&lt;-</span> <span class="nb">vars</span>
 <span class="o">.</span>     <span class="n">varnames</span> <span class="o">&lt;-</span> <span class="n">vapply</span><span class="p">(</span><span class="nb">vars</span><span class="p">,</span> <span class="n">deparse2</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="n">L</span><span class="p">]</span>
 <span class="o">.</span>     <span class="n">variables</span> <span class="o">&lt;-</span> <span class="nb">eval</span><span class="p">(</span><span class="n">predvars</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
 <span class="o">.</span>     <span class="n">resp</span> <span class="o">&lt;-</span> <span class="n">attr</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;response&quot;</span><span class="p">)</span>
 <span class="o">.</span>     <span class="k">if</span> <span class="p">(</span><span class="ow">is</span><span class="o">.</span><span class="n">null</span><span class="p">(</span><span class="n">rownames</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">resp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="n">L</span><span class="p">)</span> <span class="p">{</span>
 <span class="o">.</span>         <span class="n">lhs</span> <span class="o">&lt;-</span> <span class="n">variables</span><span class="p">[[</span><span class="n">resp</span><span class="p">]]</span>
 <span class="o">.</span>         <span class="n">rownames</span> <span class="o">&lt;-</span> <span class="k">if</span> <span class="p">(</span><span class="ow">is</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">lhs</span><span class="p">))</span> 
 <span class="o">.</span>             <span class="n">rownames</span><span class="p">(</span><span class="n">lhs</span><span class="p">)</span>
 <span class="o">.</span>         <span class="k">else</span> <span class="n">names</span><span class="p">(</span><span class="n">lhs</span><span class="p">)</span>
 <span class="o">.</span>     <span class="p">}</span>
 <span class="o">.</span>     <span class="k">if</span> <span class="p">(</span><span class="n">possible_newdata</span> <span class="o">&amp;&amp;</span> <span class="n">length</span><span class="p">(</span><span class="n">variables</span><span class="p">))</span> <span class="p">{</span>
 <span class="o">.</span>         <span class="n">nr2</span> <span class="o">&lt;-</span> <span class="nb">max</span><span class="p">(</span><span class="n">sapply</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="n">NROW</span><span class="p">))</span>
 <span class="o">.</span>         <span class="k">if</span> <span class="p">(</span><span class="n">nr2</span> <span class="o">!=</span> <span class="n">nr</span><span class="p">)</span> 
 <span class="o">.</span>             <span class="n">warning</span><span class="p">(</span><span class="n">sprintf</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">ngettext</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span> <span class="s2">&quot;&#39;newdata&#39; had </span><span class="si">%d</span><span class="s2"> row&quot;</span><span class="p">,</span> 
 <span class="o">.</span>                 <span class="s2">&quot;&#39;newdata&#39; had </span><span class="si">%d</span><span class="s2"> rows&quot;</span><span class="p">),</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">ngettext</span><span class="p">(</span><span class="n">nr2</span><span class="p">,</span> 
 <span class="o">.</span>                 <span class="s2">&quot;but variable found had </span><span class="si">%d</span><span class="s2"> row&quot;</span><span class="p">,</span> <span class="s2">&quot;but variables found have </span><span class="si">%d</span><span class="s2"> rows&quot;</span><span class="p">)),</span> 
 <span class="o">.</span>                 <span class="n">nr</span><span class="p">,</span> <span class="n">nr2</span><span class="p">),</span> <span class="n">call</span><span class="o">.</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">domain</span> <span class="o">=</span> <span class="n">NA</span><span class="p">)</span>
 <span class="o">.</span>     <span class="p">}</span>
 <span class="o">.</span>     <span class="k">if</span> <span class="p">(</span><span class="ow">is</span><span class="o">.</span><span class="n">null</span><span class="p">(</span><span class="n">attr</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;predvars&quot;</span><span class="p">)))</span> <span class="p">{</span>
 <span class="o">.</span>         <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="ow">in</span> <span class="n">seq_along</span><span class="p">(</span><span class="n">varnames</span><span class="p">))</span> <span class="n">predvars</span><span class="p">[[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="n">L</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="n">makepredictcall</span><span class="p">(</span><span class="n">variables</span><span class="p">[[</span><span class="n">i</span><span class="p">]],</span> 
 <span class="o">.</span>             <span class="nb">vars</span><span class="p">[[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="n">L</span><span class="p">]])</span>
 <span class="o">.</span>         <span class="n">attr</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;predvars&quot;</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">predvars</span>
 <span class="o">.</span>     <span class="p">}</span>
 <span class="o">.</span>     <span class="n">extras</span> <span class="o">&lt;-</span> <span class="n">substitute</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="o">...</span><span class="p">))</span>
 <span class="o">.</span>     <span class="n">extranames</span> <span class="o">&lt;-</span> <span class="n">names</span><span class="p">(</span><span class="n">extras</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="n">L</span><span class="p">])</span>
 <span class="o">.</span>     <span class="n">extras</span> <span class="o">&lt;-</span> <span class="nb">eval</span><span class="p">(</span><span class="n">extras</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
 <span class="o">.</span>     <span class="n">subset</span> <span class="o">&lt;-</span> <span class="nb">eval</span><span class="p">(</span><span class="n">substitute</span><span class="p">(</span><span class="n">subset</span><span class="p">),</span> <span class="n">data</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
 <span class="o">.</span>     <span class="n">data</span> <span class="o">&lt;-</span> <span class="o">.</span><span class="n">External2</span><span class="p">(</span><span class="n">C_modelframe</span><span class="p">,</span> <span class="n">formula</span><span class="p">,</span> <span class="n">rownames</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> 
 <span class="o">.</span>         <span class="n">varnames</span><span class="p">,</span> <span class="n">extras</span><span class="p">,</span> <span class="n">extranames</span><span class="p">,</span> <span class="n">subset</span><span class="p">,</span> <span class="n">na</span><span class="o">.</span><span class="n">action</span><span class="p">)</span>
 <span class="o">.</span>     <span class="k">if</span> <span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">xlev</span><span class="p">))</span> <span class="p">{</span>
 <span class="o">.</span>         <span class="k">for</span> <span class="p">(</span><span class="n">nm</span> <span class="ow">in</span> <span class="n">names</span><span class="p">(</span><span class="n">xlev</span><span class="p">))</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span>is.null<span class="o">(</span>xl<span class="w"> </span>&lt;-<span class="w"> </span>xlev<span class="o">[[</span>nm<span class="o">]]))</span><span class="w"> </span><span class="o">{</span>
 <span class="o">.</span>             <span class="n">xi</span> <span class="o">&lt;-</span> <span class="n">data</span><span class="p">[[</span><span class="n">nm</span><span class="p">]]</span>
 <span class="o">.</span>             <span class="k">if</span> <span class="p">(</span><span class="ow">is</span><span class="o">.</span><span class="n">character</span><span class="p">(</span><span class="n">xi</span><span class="p">))</span> 
 <span class="o">.</span>                 <span class="n">xi</span> <span class="o">&lt;-</span> <span class="k">as</span><span class="o">.</span><span class="n">factor</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>
 <span class="o">.</span>             <span class="k">if</span> <span class="p">(</span><span class="o">!</span>is.factor<span class="o">(</span>xi<span class="o">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span>is.null<span class="o">(</span>nxl<span class="w"> </span>&lt;-<span class="w"> </span>levels<span class="o">(</span>xi<span class="o">)))</span><span class="w"> </span>
 <span class="o">.</span>                 <span class="n">warning</span><span class="p">(</span><span class="n">gettextf</span><span class="p">(</span><span class="s2">&quot;variable &#39;</span><span class="si">%s</span><span class="s2">&#39; is not a factor&quot;</span><span class="p">,</span> 
 <span class="o">.</span>                   <span class="n">nm</span><span class="p">),</span> <span class="n">domain</span> <span class="o">=</span> <span class="n">NA</span><span class="p">)</span>
 <span class="o">.</span>             <span class="k">else</span> <span class="p">{</span>
 <span class="o">.</span>                 <span class="n">ctr</span> <span class="o">&lt;-</span> <span class="n">attr</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="s2">&quot;contrasts&quot;</span><span class="p">)</span>
 <span class="o">.</span>                 <span class="n">xi</span> <span class="o">&lt;-</span> <span class="n">xi</span><span class="p">[,</span> <span class="n">drop</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">]</span>
 <span class="o">.</span>                 <span class="n">nxl</span> <span class="o">&lt;-</span> <span class="n">levels</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>
 <span class="o">.</span>                 <span class="k">if</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">m</span> <span class="o">&lt;-</span> <span class="ow">is</span><span class="o">.</span><span class="n">na</span><span class="p">(</span><span class="n">match</span><span class="p">(</span><span class="n">nxl</span><span class="p">,</span> <span class="n">xl</span><span class="p">))))</span> 
 <span class="o">.</span>                   <span class="n">stop</span><span class="p">(</span><span class="n">sprintf</span><span class="p">(</span><span class="n">ngettext</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="s2">&quot;factor </span><span class="si">%s</span><span class="s2"> has new level </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> 
 <span class="o">.</span>                     <span class="s2">&quot;factor </span><span class="si">%s</span><span class="s2"> has new levels </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">nm</span><span class="p">,</span> <span class="n">paste</span><span class="p">(</span><span class="n">nxl</span><span class="p">[</span><span class="n">m</span><span class="p">],</span> 
 <span class="o">.</span>                     <span class="n">collapse</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="p">)),</span> <span class="n">domain</span> <span class="o">=</span> <span class="n">NA</span><span class="p">)</span>
 <span class="o">.</span>                 <span class="n">data</span><span class="p">[[</span><span class="n">nm</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="n">factor</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="n">xl</span><span class="p">,</span> <span class="n">exclude</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">)</span>
 <span class="o">.</span>                 <span class="k">if</span> <span class="p">(</span><span class="o">!</span>identical<span class="o">(</span>attr<span class="o">(</span>data<span class="o">[[</span>nm<span class="o">]]</span>,<span class="w"> </span><span class="s2">&quot;contrasts&quot;</span><span class="o">)</span>,<span class="w"> </span>
 <span class="o">.</span>                   <span class="n">ctr</span><span class="p">))</span> 
 <span class="o">.</span>                   <span class="n">warning</span><span class="p">(</span><span class="n">gettext</span><span class="p">(</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">&quot;contrasts dropped from factor </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> 
 <span class="o">.</span>                     <span class="n">nm</span><span class="p">),</span> <span class="n">domain</span> <span class="o">=</span> <span class="n">NA</span><span class="p">),</span> <span class="n">call</span><span class="o">.</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span>
 <span class="o">.</span>             <span class="p">}</span>
 <span class="o">.</span>         <span class="p">}</span>
 <span class="o">.</span>     <span class="p">}</span>
 <span class="o">.</span>     <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">drop</span><span class="o">.</span><span class="n">unused</span><span class="o">.</span><span class="n">levels</span><span class="p">)</span> <span class="p">{</span>
 <span class="o">.</span>         <span class="k">for</span> <span class="p">(</span><span class="n">nm</span> <span class="ow">in</span> <span class="n">names</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="p">{</span>
 <span class="o">.</span>             <span class="n">x</span> <span class="o">&lt;-</span> <span class="n">data</span><span class="p">[[</span><span class="n">nm</span><span class="p">]]</span>
 <span class="o">.</span>             <span class="k">if</span> <span class="p">(</span><span class="ow">is</span><span class="o">.</span><span class="n">factor</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">!</span>is.na<span class="o">(</span>x<span class="o">)]))</span><span class="w"> </span>&lt;<span class="w"> </span>
 <span class="o">.</span>                 <span class="n">length</span><span class="p">(</span><span class="n">levels</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span> <span class="p">{</span>
 <span class="o">.</span>                 <span class="n">ctr</span> <span class="o">&lt;-</span> <span class="n">attr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;contrasts&quot;</span><span class="p">)</span>
 <span class="o">.</span>                 <span class="n">data</span><span class="p">[[</span><span class="n">nm</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="n">x</span><span class="p">[,</span> <span class="n">drop</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">]</span>
 <span class="o">.</span>                 <span class="k">if</span> <span class="p">(</span><span class="o">!</span>identical<span class="o">(</span>attr<span class="o">(</span>data<span class="o">[[</span>nm<span class="o">]]</span>,<span class="w"> </span><span class="s2">&quot;contrasts&quot;</span><span class="o">)</span>,<span class="w"> </span>
 <span class="o">.</span>                   <span class="n">ctr</span><span class="p">))</span> 
 <span class="o">.</span>                   <span class="n">warning</span><span class="p">(</span><span class="n">gettext</span><span class="p">(</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">&quot;contrasts dropped from factor </span><span class="si">%s</span><span class="s2"> due to missing levels&quot;</span><span class="p">,</span> 
 <span class="o">.</span>                     <span class="n">nm</span><span class="p">),</span> <span class="n">domain</span> <span class="o">=</span> <span class="n">NA</span><span class="p">),</span> <span class="n">call</span><span class="o">.</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span>
 <span class="o">.</span>             <span class="p">}</span>
 <span class="o">.</span>         <span class="p">}</span>
 <span class="o">.</span>     <span class="p">}</span>
 <span class="o">.</span>     <span class="n">attr</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="s2">&quot;dataClasses&quot;</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">vapply</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">.</span><span class="n">MFclass</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
 <span class="o">.</span>     <span class="n">attr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;terms&quot;</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">formula</span>
 <span class="o">.</span>     <span class="n">data</span>
 <span class="o">.</span> <span class="p">})(</span><span class="n">formula</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">fit</span><span class="err">$</span><span class="n">BUGSoutput</span><span class="err">$</span><span class="n">summary</span><span class="p">[</span><span class="mi">6</span><span class="p">:(</span><span class="mi">6</span> <span class="o">+</span> <span class="n">N</span><span class="o">.</span><span class="n">Temp</span><span class="o">.</span><span class="n">xs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> 
 <span class="o">.</span>     <span class="s2">&quot;2.5%&quot;</span><span class="p">]</span> <span class="o">~</span> <span class="n">Temp</span><span class="o">.</span><span class="n">xs</span><span class="p">,</span> <span class="n">na</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">)</span>
<span class="mi">6</span><span class="o">.</span> <span class="nb">eval</span><span class="p">(</span><span class="n">predvars</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
<span class="mi">7</span><span class="o">.</span> <span class="nb">eval</span><span class="p">(</span><span class="n">predvars</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/28152b8ac46b56351feb85bc8b1c7bc30b670793df6b89cb1fd75a6e66563d19.png"><img alt="../_images/28152b8ac46b56351feb85bc8b1c7bc30b670793df6b89cb1fd75a6e66563d19.png" src="../_images/28152b8ac46b56351feb85bc8b1c7bc30b670793df6b89cb1fd75a6e66563d19.png" style="width: 300px; height: 360px;" /></a>
</div>
</div>
</section>
<section id="additional-analyses">
<h3>Additional analyses<a class="headerlink" href="#additional-analyses" title="Link to this heading">#</a></h3>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">which.max()</span></code> function to find the optimal temperature for adult lifespan:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">Temp.xs</span><span class="p">[</span><span class="nf">which.max</span><span class="p">(</span><span class="nf">as.vector</span><span class="p">(</span><span class="n">lf.fit</span><span class="o">$</span><span class="n">BUGSoutput</span><span class="o">$</span><span class="n">summary</span><span class="p">[</span><span class="m">6</span><span class="o">:</span><span class="p">(</span><span class="m">6</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">N.Temp.xs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;mean&quot;</span><span class="p">]))]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="k">as</span><span class="o">.</span><span class="n">vector</span><span class="p">(</span><span class="n">lf</span><span class="o">.</span><span class="n">fit</span><span class="err">$</span><span class="n">BUGSoutput</span><span class="err">$</span><span class="n">summary</span><span class="p">[</span><span class="mi">6</span><span class="p">:(</span><span class="mi">6</span> <span class="o">+</span> <span class="n">N</span><span class="o">.</span><span class="n">Temp</span><span class="o">.</span><span class="n">xs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;mean&quot;</span><span class="p">]):</span> <span class="nb">object</span> <span class="s1">&#39;lf.fit&#39;</span> <span class="ow">not</span> <span class="n">found</span>
<span class="ne">Traceback</span>:

<span class="mi">1</span><span class="o">.</span> <span class="n">which</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="k">as</span><span class="o">.</span><span class="n">vector</span><span class="p">(</span><span class="n">lf</span><span class="o">.</span><span class="n">fit</span><span class="err">$</span><span class="n">BUGSoutput</span><span class="err">$</span><span class="n">summary</span><span class="p">[</span><span class="mi">6</span><span class="p">:(</span><span class="mi">6</span> <span class="o">+</span> <span class="n">N</span><span class="o">.</span><span class="n">Temp</span><span class="o">.</span><span class="n">xs</span> <span class="o">-</span> 
 <span class="o">.</span>     <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;mean&quot;</span><span class="p">]))</span>
<span class="mi">2</span><span class="o">.</span> <span class="k">as</span><span class="o">.</span><span class="n">vector</span><span class="p">(</span><span class="n">lf</span><span class="o">.</span><span class="n">fit</span><span class="err">$</span><span class="n">BUGSoutput</span><span class="err">$</span><span class="n">summary</span><span class="p">[</span><span class="mi">6</span><span class="p">:(</span><span class="mi">6</span> <span class="o">+</span> <span class="n">N</span><span class="o">.</span><span class="n">Temp</span><span class="o">.</span><span class="n">xs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;mean&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>You can also pull out the lifespan values for each iteration of the MCMC chain over the temperature gradient to calculate <span class="math notranslate nohighlight">\(R_0\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">lf.grad</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lf.fit</span><span class="o">$</span><span class="n">BUGSoutput</span><span class="o">$</span><span class="n">sims.list</span><span class="o">$</span><span class="n">z.trait.mu.pred</span>
<span class="nf">dim</span><span class="p">(</span><span class="n">lf.grad</span><span class="p">)</span><span class="w"> </span><span class="c1"># A matrix with 7500 iterations of the MCMC chains at 226 temperatures</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="nb">eval</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">envir</span><span class="p">,</span> <span class="n">enclos</span><span class="p">):</span> <span class="nb">object</span> <span class="s1">&#39;lf.fit&#39;</span> <span class="ow">not</span> <span class="n">found</span>
<span class="ne">Traceback</span>:
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="fitting-of-abundance-data">
<h2>Fitting of abundance data<a class="headerlink" href="#fitting-of-abundance-data" title="Link to this heading">#</a></h2>
<p>We will now perform a bayesian analysis of population growth data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">require</span><span class="p">(</span><span class="n">R2jags</span><span class="p">)</span><span class="w"> </span><span class="c1"># does the fitting</span>
<span class="nf">require</span><span class="p">(</span><span class="n">coda</span><span class="p">)</span><span class="w"> </span><span class="c1"># makes diagnostic plots</span>
<span class="nf">library</span><span class="p">(</span><span class="n">IDPmisc</span><span class="p">)</span><span class="w"> </span><span class="c1"># makes nice colored pairs plots to look at joint posteriors</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loading required package: R2jags

Loading required package: rjags

Loading required package: coda

Linked to JAGS 4.3.0

Loaded modules: basemod,bugs


Attaching package: ‘R2jags’


The following object is masked from ‘package:coda’:

    traceplot
</pre></div>
</div>
</div>
</div>
<section id="id1">
<h3>The Data<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>These data are observations of the amphibian fungal pathogen <em>Batrachochytrium dendrobatidis</em> being grown in liquid culture at multiple different temperatures. The experiment is conducted in 96 well plates with a fixed initial innoculation of fungal spores in each well, and the plate placed in a constant temperature incubator. Each day, 8 wells per plate are observed and the optical density (OD) is measured. We will focus on a single temperature trial across mulitple plates with OD as the response.</p>
<p>We will fit a logistic model to these growth data.</p>
<p>Let’s have a look at the data first:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read.csv</span><span class="p">(</span><span class="s">&quot;../data/lb_ab_temps.csv&quot;</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<caption>A data.frame: 6 × 10</caption>
<thead>
	<tr><th></th><th scope=col>X</th><th scope=col>EXP</th><th scope=col>TEMP</th><th scope=col>DAY</th><th scope=col>ISOLATE</th><th scope=col>PLATE</th><th scope=col>WELL</th><th scope=col>OD</th><th scope=col>NC_AVG</th><th scope=col>OD_SUB</th></tr>
	<tr><th></th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>1</td><td>2</td><td>5</td><td>1</td><td>LB_AB</td><td>P.16</td><td>1</td><td>0.120</td><td>0.1195</td><td>0.0005</td></tr>
	<tr><th scope=row>2</th><td>2</td><td>2</td><td>5</td><td>1</td><td>LB_AB</td><td>P.16</td><td>2</td><td>0.120</td><td>0.1195</td><td>0.0005</td></tr>
	<tr><th scope=row>3</th><td>3</td><td>2</td><td>5</td><td>1</td><td>LB_AB</td><td>P.16</td><td>3</td><td>0.122</td><td>0.1195</td><td>0.0025</td></tr>
	<tr><th scope=row>4</th><td>4</td><td>2</td><td>5</td><td>1</td><td>LB_AB</td><td>P.16</td><td>4</td><td>0.123</td><td>0.1195</td><td>0.0035</td></tr>
	<tr><th scope=row>5</th><td>5</td><td>2</td><td>5</td><td>1</td><td>LB_AB</td><td>P.16</td><td>5</td><td>0.125</td><td>0.1195</td><td>0.0055</td></tr>
	<tr><th scope=row>6</th><td>6</td><td>2</td><td>5</td><td>1</td><td>LB_AB</td><td>P.16</td><td>6</td><td>0.125</td><td>0.1195</td><td>0.0055</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>We are only interested in a subset of these data, so we will subset out only those from experiment 2, and a temperature of 12<span class="math notranslate nohighlight">\(^\circ\)</span>C.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">d2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dat</span><span class="p">[</span><span class="nf">which</span><span class="p">(</span><span class="n">dat</span><span class="o">$</span><span class="n">EXP</span><span class="o">==</span><span class="m">2</span><span class="p">),</span><span class="m">2</span><span class="o">:</span><span class="m">8</span><span class="p">]</span>
<span class="n">d2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">d2</span><span class="p">[</span><span class="nf">which</span><span class="p">(</span><span class="n">d2</span><span class="o">$</span><span class="n">TEMP</span><span class="o">==</span><span class="m">12</span><span class="p">),]</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      EXP         TEMP         DAY          ISOLATE             PLATE          
 Min.   :2   Min.   :12   Min.   : 1.00   Length:730         Length:730        
 1st Qu.:2   1st Qu.:12   1st Qu.: 9.00   Class :character   Class :character  
 Median :2   Median :12   Median :19.00   Mode  :character   Mode  :character  
 Mean   :2   Mean   :12   Mean   :19.04                                        
 3rd Qu.:2   3rd Qu.:12   3rd Qu.:29.00                                        
 Max.   :2   Max.   :12   Max.   :39.00                                        
      WELL             OD        
 Min.   :1.000   Min.   :0.0930  
 1st Qu.:2.000   1st Qu.:0.1630  
 Median :4.000   Median :0.2580  
 Mean   :4.315   Mean   :0.2437  
 3rd Qu.:6.000   3rd Qu.:0.3170  
 Max.   :8.000   Max.   :0.4600  
</pre></div>
</div>
</div>
</div>
<p>Now plot it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">Temps</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="nf">max</span><span class="p">(</span><span class="n">d2</span><span class="o">$</span><span class="n">DAY</span><span class="p">)</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="m">0.05</span><span class="p">)</span>
<span class="n">mycol</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>
<span class="n">my.ylim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span>
<span class="n">my.title</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;LB-AB isolate, T=12C&quot;</span>

<span class="nf">plot</span><span class="p">(</span><span class="n">d2</span><span class="o">$</span><span class="n">DAY</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="n">d2</span><span class="o">$</span><span class="n">OD</span><span class="p">,</span><span class="w"> </span><span class="n">xlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="nf">max</span><span class="p">(</span><span class="n">Temps</span><span class="p">)),</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="n">my.ylim</span><span class="p">,</span>
<span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="p">(</span><span class="n">mycol</span><span class="m">+20</span><span class="p">),</span>
<span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;time (days)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="n">my.title</span><span class="p">,</span>
<span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="n">mycol</span><span class="m">+1</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">1.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/8881d7f34bf93a117324c5799f0419097918a5d59d9b7f22b50f82eae65aea42.png"><img alt="../_images/8881d7f34bf93a117324c5799f0419097918a5d59d9b7f22b50f82eae65aea42.png" src="../_images/8881d7f34bf93a117324c5799f0419097918a5d59d9b7f22b50f82eae65aea42.png" style="width: 300px; height: 360px;" /></a>
</div>
</div>
</section>
<section id="specifying-the-growth-curve">
<h3>Specifying the growth curve<a class="headerlink" href="#specifying-the-growth-curve" title="Link to this heading">#</a></h3>
<p>Although logistic growth is often written as a differential equation, here we will work with the analytic solution of the model:</p>
<div class="math notranslate nohighlight">
\[
\mu(t) = \frac{KY_0}{Y_0+(K-Y_0)\exp{(-rt)}}
\]</div>
<p>This gives the mean function that we want to fit. We will assume log-normal noise around this response, as the optical density is bounded to be greater than 0 and since we also have increasing variance over time (as the optical density increases).</p>
</section>
<section id="id2">
<h3>The thermal response model file<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<p>JAGS needs the model written as a <code class="docutils literal notranslate"><span class="pre">.txt</span></code> or <code class="docutils literal notranslate"><span class="pre">.bug</span></code> file inside the working directory. You can either make the text file directly, or create it using the <code class="docutils literal notranslate"><span class="pre">sink()</span></code> function in your R script, as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">sink</span><span class="p">(</span><span class="s">&quot;jags-logistic.bug&quot;</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;</span>
<span class="s"> model {</span>
<span class="s"> </span>
<span class="s"> ## Likelihood</span>
<span class="s"> for (i in 1:N) {</span>
<span class="s">  Y[i] ~ dlnorm(log(mu[i]), tau)</span>
<span class="s">  mu[i] &lt;- K * Y0/(Y0+(K-Y0) * exp(-r * t[i]))</span>
<span class="s"> }</span>

<span class="s"> ## Priors</span>
<span class="s"> r~dexp(1000)</span>
<span class="s"> K ~ dunif(0.01, 0.6)</span>
<span class="s"> Y0 ~ dunif(0.09, 0.15)</span>
<span class="s"> tau &lt;- 1/sigma^2</span>
<span class="s"> sigma ~ dexp(0.1)</span>

<span class="s"> } # close model</span>
<span class="s"> &quot;</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="nf">sink</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  model {
    
    ## Likelihood
    for (i in 1:N) {
        Y[i] ~ dlnorm(log(mu[i]), tau)
        mu[i] &lt;- K*Y0/(Y0+(K-Y0)*exp(-r*t[i]))
    }

    ## Priors
    r~dexp(1000)
    K ~ dunif(0.01, 0.6)
    Y0 ~ dunif(0.09, 0.15)
    tau&lt;-1/sigma^2
    sigma ~ dexp(0.1)

  } # close model
    
</pre></div>
</div>
</div>
</div>
<p>Note that the model file has two mandatory sections (the priors and the likelihood) and one optional section (derived quantiaties calculated from your fitted parameters).</p>
<p>In the example below we will build the model function with the log-normal likelihood for the logistic growth function. Priors are a combination of uniform and exponential distributions. As with the normal distribution, jags uses <span class="math notranslate nohighlight">\(\tau\)</span> to parameterize the variance of the normal distribution (<span class="math notranslate nohighlight">\(\tau = 1/(\sigma^2)\)</span>). However it can be easier to specify the prior on sigma directly. In this example we will generate posterior samples of derived quantities outside of JAGS (so you can see what this is actually doing).</p>
</section>
<section id="additional-settings-for-jags">
<h3>Additional settings for jags<a class="headerlink" href="#additional-settings-for-jags" title="Link to this heading">#</a></h3>
<p>Now for some additional settings/specifications for jags:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameters to Estimate</span>
<span class="n">parameters</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;Y0&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;K&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;sigma&#39;</span><span class="p">)</span>

<span class="c1"># Initial values for the parameters</span>
<span class="n">inits</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(){</span><span class="nf">list</span><span class="p">(</span>
<span class="w"> </span><span class="n">Y0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span>
<span class="w"> </span><span class="n">K</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.4</span><span class="p">,</span>
<span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span>
<span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rlnorm</span><span class="p">(</span><span class="m">1</span><span class="p">))}</span>

<span class="c1"># MCMC Settings: number of posterior dist elements = [(ni - nb) / nt ] * nc</span>
<span class="n">ni</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">6000</span><span class="w"> </span><span class="c1"># number of iterations in each chain</span>
<span class="n">nb</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="c1"># number of &#39;burn in&#39; iterations to discard</span>
<span class="n">nt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c1"># thinning rate - jags saves every nt iterations in each chain</span>
<span class="n">nc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="c1"># number of chains</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="fitting-the-model">
<h3>Fitting the model<a class="headerlink" href="#fitting-the-model" title="Link to this heading">#</a></h3>
<p>Now we can run jags:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pull out data columns as vectors</span>
<span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">d2</span><span class="w"> </span><span class="c1"># this lets us reuse the same generic code: we only change this first line</span>
<span class="n">Y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">OD</span>
<span class="n">N</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
<span class="n">t</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">DAY</span>

<span class="c1"># Bundle all data in a list for JAGS</span>
<span class="n">jag.data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run JAGS</span>
<span class="n">OD.12C</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">jags</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">jag.data</span><span class="p">,</span><span class="w"> </span><span class="n">inits</span><span class="o">=</span><span class="n">inits</span><span class="p">,</span><span class="w"> </span><span class="n">parameters.to.save</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">model.file</span><span class="o">=</span><span class="s">&quot;jags-logistic.bug&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">n.thin</span><span class="o">=</span><span class="n">nt</span><span class="p">,</span><span class="w"> </span><span class="n">n.chains</span><span class="o">=</span><span class="n">nc</span><span class="p">,</span><span class="w"> </span><span class="n">n.burnin</span><span class="o">=</span><span class="n">nb</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">n.iter</span><span class="o">=</span><span class="n">ni</span><span class="p">,</span><span class="w"> </span><span class="n">DIC</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span><span class="w"> </span><span class="n">working.directory</span><span class="o">=</span><span class="nf">getwd</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning message in jags.model(model.file, data = data, inits = init.values, n.chains = n.chains, :
“Unused variable &quot;Y&quot; in data”
Warning message in jags.model(model.file, data = data, inits = init.values, n.chains = n.chains, :
“Unused variable &quot;N&quot; in data”
Warning message in jags.model(model.file, data = data, inits = init.values, n.chains = n.chains, :
“Unused variable &quot;t&quot; in data”
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Compiling model graph
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="n">jags</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span> <span class="n">inits</span> <span class="o">=</span> <span class="n">init</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">chains</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">chains</span><span class="p">,</span> <span class="p">:</span> <span class="n">Nothing</span> <span class="n">to</span> <span class="nb">compile</span>


<span class="ne">Traceback</span>:

<span class="mi">1</span><span class="o">.</span> <span class="n">jags</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">jag</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">inits</span> <span class="o">=</span> <span class="n">inits</span><span class="p">,</span> <span class="n">parameters</span><span class="o">.</span><span class="n">to</span><span class="o">.</span><span class="n">save</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">,</span> 
 <span class="o">.</span>     <span class="n">model</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="s2">&quot;jags-logistic.bug&quot;</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">thin</span> <span class="o">=</span> <span class="n">nt</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">chains</span> <span class="o">=</span> <span class="n">nc</span><span class="p">,</span> 
 <span class="o">.</span>     <span class="n">n</span><span class="o">.</span><span class="n">burnin</span> <span class="o">=</span> <span class="n">nb</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">iter</span> <span class="o">=</span> <span class="n">ni</span><span class="p">,</span> <span class="n">DIC</span> <span class="o">=</span> <span class="n">T</span><span class="p">,</span> <span class="n">working</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">getwd</span><span class="p">())</span>
<span class="mi">2</span><span class="o">.</span> <span class="n">jags</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span> <span class="n">inits</span> <span class="o">=</span> <span class="n">init</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">chains</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">chains</span><span class="p">,</span> 
 <span class="o">.</span>     <span class="n">n</span><span class="o">.</span><span class="n">adapt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Change into “mcmc” type samples for visualization with <code class="docutils literal notranslate"><span class="pre">coda</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">OD.12C.mcmc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.mcmc</span><span class="p">(</span><span class="n">OD.12C</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="k">as</span><span class="o">.</span><span class="n">mcmc</span><span class="p">(</span><span class="n">OD</span><span class="mf">.12</span><span class="n">C</span><span class="p">):</span> <span class="nb">object</span> <span class="s1">&#39;OD.12C&#39;</span> <span class="ow">not</span> <span class="n">found</span>
<span class="ne">Traceback</span>:

<span class="mi">1</span><span class="o">.</span> <span class="k">as</span><span class="o">.</span><span class="n">mcmc</span><span class="p">(</span><span class="n">OD</span><span class="mf">.12</span><span class="n">C</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="diagnostics">
<h3>Diagnostics<a class="headerlink" href="#diagnostics" title="Link to this heading">#</a></h3>
<p>As you did in the <a class="reference internal" href="#Aedes-data-revisited-using-Bayesian-fitting"><span class="xref myst">Traits bayesian fitting example</span></a>, there are a number of model diagnostics that we need to check. First we want to look at the chains and confirm that they look like “fuzzy caterpillars” – no linear/non-linear patterns across the chains, low auto-correlation, etc.</p>
<p>First view the fitted parameters:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">OD.12C</span><span class="o">$</span><span class="n">BUGSoutput</span><span class="o">$</span><span class="n">summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="nb">eval</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">envir</span><span class="p">,</span> <span class="n">enclos</span><span class="p">):</span> <span class="nb">object</span> <span class="s1">&#39;OD.12C&#39;</span> <span class="ow">not</span> <span class="n">found</span>
<span class="ne">Traceback</span>:
</pre></div>
</div>
</div>
</div>
<p>Plot the chains using the coda package:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">plot</span><span class="p">(</span><span class="n">OD.12C.mcmc</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">4</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="n">h</span><span class="p">(</span><span class="n">simpleError</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">call</span><span class="p">)):</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">evaluating</span> <span class="n">the</span> <span class="n">argument</span> <span class="s1">&#39;x&#39;</span> <span class="ow">in</span> <span class="n">selecting</span> <span class="n">a</span> <span class="n">method</span> <span class="k">for</span> <span class="n">function</span> <span class="s1">&#39;plot&#39;</span><span class="p">:</span> <span class="nb">object</span> <span class="s1">&#39;OD.12C.mcmc&#39;</span> <span class="ow">not</span> <span class="n">found</span>
<span class="ne">Traceback</span>:

<span class="mi">1</span><span class="o">.</span> <span class="n">plot</span><span class="p">(</span><span class="n">OD</span><span class="mf">.12</span><span class="n">C</span><span class="o">.</span><span class="n">mcmc</span><span class="p">[,</span> <span class="n">c</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)])</span>
<span class="mi">2</span><span class="o">.</span> <span class="o">.</span><span class="n">handleSimpleError</span><span class="p">(</span><span class="n">function</span> <span class="p">(</span><span class="n">cond</span><span class="p">)</span> 
 <span class="o">.</span> <span class="o">.</span><span class="n">Internal</span><span class="p">(</span><span class="n">C_tryCatchHelper</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="mi">1</span><span class="n">L</span><span class="p">,</span> <span class="n">cond</span><span class="p">)),</span> <span class="s2">&quot;object &#39;OD.12C.mcmc&#39; not found&quot;</span><span class="p">,</span> 
 <span class="o">.</span>     <span class="n">base</span><span class="p">::</span><span class="n">quote</span><span class="p">(</span><span class="n">plot</span><span class="p">(</span><span class="n">OD</span><span class="mf">.12</span><span class="n">C</span><span class="o">.</span><span class="n">mcmc</span><span class="p">[,</span> <span class="n">c</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)])))</span>
<span class="mi">3</span><span class="o">.</span> <span class="n">h</span><span class="p">(</span><span class="n">simpleError</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">call</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>We can examine the ACF of the chains as well, similarly to a time series:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">s1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.data.frame</span><span class="p">(</span><span class="n">OD.12C.mcmc</span><span class="p">[[</span><span class="m">1</span><span class="p">]])</span>
<span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span>
<span class="nf">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">2</span><span class="o">:</span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="nf">acf</span><span class="p">(</span><span class="n">s1</span><span class="p">[,</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">lag.max</span><span class="o">=</span><span class="m">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="k">as</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="n">OD</span><span class="mf">.12</span><span class="n">C</span><span class="o">.</span><span class="n">mcmc</span><span class="p">[[</span><span class="mi">1</span><span class="p">]]):</span> <span class="nb">object</span> <span class="s1">&#39;OD.12C.mcmc&#39;</span> <span class="ow">not</span> <span class="n">found</span>
<span class="ne">Traceback</span>:

<span class="mi">1</span><span class="o">.</span> <span class="k">as</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="n">OD</span><span class="mf">.12</span><span class="n">C</span><span class="o">.</span><span class="n">mcmc</span><span class="p">[[</span><span class="mi">1</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<p>There is still a bit of autocorrelation, but it isn’t too bad. The chain for <span class="math notranslate nohighlight">\(\sigma\)</span> is mixing best. We could reduce the autocorrelation even further by thinning the chain (i.e., change the <code class="docutils literal notranslate"><span class="pre">nt</span></code> parameter to 5 or 10).</p>
<p>The last important diagnostic is to compare the prior and posterior distributions. Various packages in R have bespoke functions to do this. Here we use functions that we provide in the <code class="docutils literal notranslate"><span class="pre">mcmc_utils.R</span></code> file provided on the website.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">source</span><span class="p">(</span><span class="s">&quot;../code/mcmc_utils.R&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning message in file(filename, &quot;r&quot;, encoding = encoding):
“cannot open file &#39;../code/mcmc_utils.R&#39;: No such file or directory”
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="n">file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span><span class="p">):</span> <span class="n">cannot</span> <span class="nb">open</span> <span class="n">the</span> <span class="n">connection</span>
<span class="ne">Traceback</span>:

<span class="mi">1</span><span class="o">.</span> <span class="n">source</span><span class="p">(</span><span class="s2">&quot;../code/mcmc_utils.R&quot;</span><span class="p">)</span>
<span class="mi">2</span><span class="o">.</span> <span class="n">file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We also can write a function to put the samples into a convenient format for visualizing, etc:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">samps</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span>
<span class="nf">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">nc</span><span class="p">){</span>
<span class="w"> </span><span class="n">samps</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rbind</span><span class="p">(</span><span class="n">samps</span><span class="p">,</span><span class="w"> </span><span class="nf">as.data.frame</span><span class="p">(</span><span class="n">OD.12C.mcmc</span><span class="p">[[</span><span class="n">i</span><span class="p">]]))</span>
<span class="p">}</span>

<span class="n">samps</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">samps</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="k">as</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="n">OD</span><span class="mf">.12</span><span class="n">C</span><span class="o">.</span><span class="n">mcmc</span><span class="p">[[</span><span class="n">i</span><span class="p">]]):</span> <span class="nb">object</span> <span class="s1">&#39;OD.12C.mcmc&#39;</span> <span class="ow">not</span> <span class="n">found</span>
<span class="ne">Traceback</span>:

<span class="mi">1</span><span class="o">.</span> <span class="n">rbind</span><span class="p">(</span><span class="n">samps</span><span class="p">,</span> <span class="k">as</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="n">OD</span><span class="mf">.12</span><span class="n">C</span><span class="o">.</span><span class="n">mcmc</span><span class="p">[[</span><span class="n">i</span><span class="p">]]))</span>
<span class="mi">2</span><span class="o">.</span> <span class="k">as</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="n">OD</span><span class="mf">.12</span><span class="n">C</span><span class="o">.</span><span class="n">mcmc</span><span class="p">[[</span><span class="n">i</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<p>And also, we can building a list to hold all the information about the priors for each parameter:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">priors</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">()</span>
<span class="n">priors</span><span class="o">$</span><span class="n">names</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Y0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;K&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;r&quot;</span><span class="p">,</span><span class="s">&quot;sigma&quot;</span><span class="p">)</span>
<span class="n">priors</span><span class="o">$</span><span class="n">fun</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;uniform&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;uniform&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;exp&quot;</span><span class="p">,</span><span class="s">&quot;exp&quot;</span><span class="p">)</span>
<span class="n">priors</span><span class="o">$</span><span class="n">hyper</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="n">priors</span><span class="o">$</span><span class="n">hyper</span><span class="p">[,</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.09</span><span class="p">,</span><span class="w"> </span><span class="m">0.15</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">)</span>
<span class="n">priors</span><span class="o">$</span><span class="n">hyper</span><span class="p">[,</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.01</span><span class="p">,</span><span class="w"> </span><span class="m">0.6</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">)</span>
<span class="n">priors</span><span class="o">$</span><span class="n">hyper</span><span class="p">[,</span><span class="m">3</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">)</span><span class="w"> </span>
<span class="n">priors</span><span class="o">$</span><span class="n">hyper</span><span class="p">[,</span><span class="m">4</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can plot the histograms of the posterior samples together with the prior distributions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">plot.hists</span><span class="p">(</span><span class="n">samps</span><span class="p">,</span><span class="w"> </span><span class="n">my.par</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">n.hists</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">priors</span><span class="o">=</span><span class="n">priors</span><span class="p">,</span><span class="w"> </span><span class="n">mai</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0.25</span><span class="p">,</span><span class="w"> </span><span class="m">0.2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="n">plot</span><span class="o">.</span><span class="n">hists</span><span class="p">(</span><span class="n">samps</span><span class="p">,</span> <span class="n">my</span><span class="o">.</span><span class="n">par</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">n</span><span class="o">.</span><span class="n">hists</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">priors</span> <span class="o">=</span> <span class="n">priors</span><span class="p">,</span> <span class="p">:</span> <span class="n">could</span> <span class="ow">not</span> <span class="n">find</span> <span class="n">function</span> <span class="s2">&quot;plot.hists&quot;</span>
<span class="ne">Traceback</span>:
</pre></div>
</div>
</div>
</div>
<p>The prior distribution here is very different from the posterior. These data are highly informative for the parameters of interest and are very unlikely to be influenced much by the prior distribution (although you can always change the priors to check this). However, notice that <span class="math notranslate nohighlight">\(Y_0\)</span> (the initial condition) is truncated by the prior. This is a fairly strong prior, because we know something about the initial optical density that is typical for the esperimental set up with the density of innoculum used and with a properly calibrated set-up.</p>
</section>
<section id="visualizing-the-joint-posterior-of-parameters">
<h3>Visualizing the joint posterior of parameters<a class="headerlink" href="#visualizing-the-joint-posterior-of-parameters" title="Link to this heading">#</a></h3>
<p>It’s often useful to also look at the joint distbution of all of your parameters together. Of course, if you have a high dimensional posterior, rendering a 2-D representation can be difficult. Instead, the standard is to examine the pair-wise posterior distribution, for instance as follows (using the <code class="docutils literal notranslate"><span class="pre">s1</span></code> data frame we created above):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">ipairs</span><span class="p">(</span><span class="n">s1</span><span class="p">[,</span><span class="m">2</span><span class="o">:</span><span class="m">5</span><span class="p">],</span><span class="w"> </span><span class="n">ztransf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="n">x</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span><span class="nf">log2</span><span class="p">(</span><span class="n">x</span><span class="p">)})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="ow">is</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="nb">object</span> <span class="s1">&#39;s1&#39;</span> <span class="ow">not</span> <span class="n">found</span>
<span class="ne">Traceback</span>:

<span class="mi">1</span><span class="o">.</span> <span class="n">ipairs</span><span class="p">(</span><span class="n">s1</span><span class="p">[,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span> <span class="n">ztransf</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
 <span class="o">.</span>     <span class="n">x</span><span class="p">[</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="mi">1</span>
 <span class="o">.</span>     <span class="n">log2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
 <span class="o">.</span> <span class="p">})</span>
<span class="mi">2</span><span class="o">.</span> <span class="ow">is</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>As you can see, estimates of <span class="math notranslate nohighlight">\(r\)</span> and <span class="math notranslate nohighlight">\(K\)</span> are highly correlated – not surprising given the interplay between them in the logistic growth function. This correlation is an important feature of the system, and we use the full posterior distribution that includes this correlation when we want to build the corresponding posterior distribution of the behavior of the logistic function.</p>
</section>
<section id="the-posterior-distribution-of-the-mean-function">
<h3>The posterior distribution of the mean function<a class="headerlink" href="#the-posterior-distribution-of-the-mean-function" title="Link to this heading">#</a></h3>
<p>The final step is to check how well we are fitting the data. To do this we usually examine the posterior distribution of the mean function of our system, in this case the distribution of the logistic solution and compare this to the data. To do this, for each of our posterior samples (or a thinned subset), we plug the parameters for the <span class="math notranslate nohighlight">\(i^{\mathrm th}\)</span> sample <span class="math notranslate nohighlight">\(\theta_i\)</span> into our function of interest, and evaluate the function as a desired set of <span class="math notranslate nohighlight">\(x\)</span>’s. For instance, for logistic growth, we’ll evaluate
$<span class="math notranslate nohighlight">\(
\mu(t) = \frac{K_iY_{0,i}}{Y_{0,i}+(K_i-Y_{0,i})\exp{(-r_it)}}
\)</span><span class="math notranslate nohighlight">\(
for the \)</span>i^{\mathrm th}<span class="math notranslate nohighlight">\( set of parameters for a sequence of times, \)</span>t<span class="math notranslate nohighlight">\(. This we obtain points describing the curve \)</span>\mu_i(t)$ for each set of parameters. Here is one way to do this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">my.logistic</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">Y0</span><span class="p">,</span><span class="w"> </span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">){</span>
<span class="w"> </span><span class="nf">return</span><span class="p">(</span><span class="n">K</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Y0</span><span class="o">/</span><span class="p">(</span><span class="n">Y0</span><span class="o">+</span><span class="p">(</span><span class="n">K</span><span class="o">-</span><span class="n">Y0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">)))</span>
<span class="p">}</span>

<span class="n">ts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">40</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="o">=</span><span class="m">100</span><span class="p">)</span>
<span class="n">ss</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">samps</span><span class="p">)[</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="m">10</span><span class="p">)</span>
<span class="n">my.curves</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="nf">length</span><span class="p">(</span><span class="n">ss</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="nf">length</span><span class="p">(</span><span class="n">ts</span><span class="p">))</span>

<span class="nf">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">ss</span><span class="p">)){</span>
<span class="w"> </span><span class="n">my.curves</span><span class="p">[</span><span class="n">i</span><span class="p">,]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">my.logistic</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">ts</span><span class="p">,</span><span class="w"> </span><span class="n">Y0</span><span class="o">=</span><span class="n">samps</span><span class="o">$</span><span class="n">Y0</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">K</span><span class="o">=</span><span class="n">samps</span><span class="o">$</span><span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">r</span><span class="o">=</span><span class="n">samps</span><span class="o">$</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="n">seq</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dim</span><span class="p">(</span><span class="n">samps</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">by</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span> <span class="s1">&#39;to&#39;</span> <span class="n">must</span> <span class="n">be</span> <span class="n">of</span> <span class="n">length</span> <span class="mi">1</span>
<span class="ne">Traceback</span>:

<span class="mi">1</span><span class="o">.</span> <span class="n">seq</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dim</span><span class="p">(</span><span class="n">samps</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">by</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="mi">2</span><span class="o">.</span> <span class="n">seq</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dim</span><span class="p">(</span><span class="n">samps</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">by</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="mi">3</span><span class="o">.</span> <span class="n">stop</span><span class="p">(</span><span class="s2">&quot;&#39;to&#39; must be of length 1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can now plot all of these curves:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span><span class="w"> </span><span class="n">my.curves</span><span class="p">[</span><span class="m">1</span><span class="p">,],</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;l&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0.09</span><span class="p">,</span><span class="w"> </span><span class="m">0.36</span><span class="p">),</span><span class="w"> </span>
<span class="w">  </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;predicted OD&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;time (days)&quot;</span><span class="p">)</span>
<span class="nf">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">2</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">ss</span><span class="p">))</span><span class="w"> </span><span class="nf">lines</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span><span class="w"> </span><span class="n">my.curves</span><span class="p">[</span><span class="n">i</span><span class="p">,],</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="n">h</span><span class="p">(</span><span class="n">simpleError</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">call</span><span class="p">)):</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">evaluating</span> <span class="n">the</span> <span class="n">argument</span> <span class="s1">&#39;y&#39;</span> <span class="ow">in</span> <span class="n">selecting</span> <span class="n">a</span> <span class="n">method</span> <span class="k">for</span> <span class="n">function</span> <span class="s1">&#39;plot&#39;</span><span class="p">:</span> <span class="nb">object</span> <span class="s1">&#39;my.curves&#39;</span> <span class="ow">not</span> <span class="n">found</span>
<span class="ne">Traceback</span>:

<span class="mi">1</span><span class="o">.</span> <span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">my</span><span class="o">.</span><span class="n">curves</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">],</span> <span class="n">col</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="n">ylim</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="mf">0.09</span><span class="p">,</span> 
 <span class="o">.</span>     <span class="mf">0.36</span><span class="p">),</span> <span class="n">ylab</span> <span class="o">=</span> <span class="s2">&quot;predicted OD&quot;</span><span class="p">,</span> <span class="n">xlab</span> <span class="o">=</span> <span class="s2">&quot;time (days)&quot;</span><span class="p">)</span>
<span class="mi">2</span><span class="o">.</span> <span class="o">.</span><span class="n">handleSimpleError</span><span class="p">(</span><span class="n">function</span> <span class="p">(</span><span class="n">cond</span><span class="p">)</span> 
 <span class="o">.</span> <span class="o">.</span><span class="n">Internal</span><span class="p">(</span><span class="n">C_tryCatchHelper</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="mi">1</span><span class="n">L</span><span class="p">,</span> <span class="n">cond</span><span class="p">)),</span> <span class="s2">&quot;object &#39;my.curves&#39; not found&quot;</span><span class="p">,</span> 
 <span class="o">.</span>     <span class="n">base</span><span class="p">::</span><span class="n">quote</span><span class="p">(</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">my</span><span class="o">.</span><span class="n">curves</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">],</span> <span class="n">col</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;l&quot;</span><span class="p">,</span> 
 <span class="o">.</span>         <span class="n">ylim</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.36</span><span class="p">),</span> <span class="n">ylab</span> <span class="o">=</span> <span class="s2">&quot;predicted OD&quot;</span><span class="p">,</span> <span class="n">xlab</span> <span class="o">=</span> <span class="s2">&quot;time (days)&quot;</span><span class="p">)))</span>
<span class="mi">3</span><span class="o">.</span> <span class="n">h</span><span class="p">(</span><span class="n">simpleError</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">call</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Then we can summarize this posterior using the <code class="docutils literal notranslate"><span class="pre">apply</span></code> function to find the mean and the (for simplicity) quantile based 95% CI:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">m.log</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">my.curves</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span>
<span class="n">l.log</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">my.curves</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">quantile</span><span class="p">,</span><span class="w"> </span><span class="n">probs</span><span class="o">=</span><span class="m">0.025</span><span class="p">)</span>
<span class="n">u.log</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">my.curves</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">quantile</span><span class="p">,</span><span class="w"> </span><span class="n">probs</span><span class="o">=</span><span class="m">0.975</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="n">apply</span><span class="p">(</span><span class="n">my</span><span class="o">.</span><span class="n">curves</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">mean</span><span class="p">):</span> <span class="nb">object</span> <span class="s1">&#39;my.curves&#39;</span> <span class="ow">not</span> <span class="n">found</span>
<span class="ne">Traceback</span>:

<span class="mi">1</span><span class="o">.</span> <span class="n">apply</span><span class="p">(</span><span class="n">my</span><span class="o">.</span><span class="n">curves</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">mean</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>For comparison, here is how to find the 95% HPD Interval across time, using the <code class="docutils literal notranslate"><span class="pre">HPDinterval</span></code> function from the <code class="docutils literal notranslate"><span class="pre">coda</span></code> package:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">hpd.log</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span>
<span class="nf">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">ts</span><span class="p">)){</span>
<span class="w"> </span><span class="n">hpd.log</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">cbind</span><span class="p">(</span><span class="n">hpd.log</span><span class="p">,</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">HPDinterval</span><span class="p">(</span><span class="nf">mcmc</span><span class="p">(</span><span class="n">my.curves</span><span class="p">[,</span><span class="n">i</span><span class="p">]))))</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="n">mcmc</span><span class="p">(</span><span class="n">my</span><span class="o">.</span><span class="n">curves</span><span class="p">[,</span> <span class="n">i</span><span class="p">]):</span> <span class="nb">object</span> <span class="s1">&#39;my.curves&#39;</span> <span class="ow">not</span> <span class="n">found</span>
<span class="ne">Traceback</span>:

<span class="mi">1</span><span class="o">.</span> <span class="n">cbind</span><span class="p">(</span><span class="n">hpd</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="k">as</span><span class="o">.</span><span class="n">numeric</span><span class="p">(</span><span class="n">HPDinterval</span><span class="p">(</span><span class="n">mcmc</span><span class="p">(</span><span class="n">my</span><span class="o">.</span><span class="n">curves</span><span class="p">[,</span> <span class="n">i</span><span class="p">]))))</span>
<span class="mi">2</span><span class="o">.</span> <span class="n">HPDinterval</span><span class="p">(</span><span class="n">mcmc</span><span class="p">(</span><span class="n">my</span><span class="o">.</span><span class="n">curves</span><span class="p">[,</span> <span class="n">i</span><span class="p">]))</span>
<span class="mi">3</span><span class="o">.</span> <span class="n">mcmc</span><span class="p">(</span><span class="n">my</span><span class="o">.</span><span class="n">curves</span><span class="p">[,</span> <span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>And plot these together with the data (in this case the HPD and quantile based intervals are indistinguishable):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">my.ylim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.09</span><span class="p">,</span><span class="w"> </span><span class="m">0.45</span><span class="p">)</span>
<span class="n">my.title</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;LB-AB isolate, T=12C&quot;</span>

<span class="nf">plot</span><span class="p">(</span><span class="n">d2</span><span class="o">$</span><span class="n">DAY</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="n">d2</span><span class="o">$</span><span class="n">OD</span><span class="p">,</span><span class="w"> </span><span class="n">xlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="nf">max</span><span class="p">(</span><span class="n">Temps</span><span class="p">)),</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="n">my.ylim</span><span class="p">,</span>
<span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="p">(</span><span class="n">mycol</span><span class="m">+20</span><span class="p">),</span>
<span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;time (days)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="n">my.title</span><span class="p">,</span>
<span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s">&quot;grey&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">1.5</span><span class="p">)</span>
<span class="nf">lines</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span><span class="w"> </span><span class="n">m.log</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="nf">lines</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span><span class="w"> </span><span class="n">l.log</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="nf">lines</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span><span class="w"> </span><span class="n">u.log</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>

<span class="nf">lines</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span><span class="w"> </span><span class="n">hpd.log</span><span class="p">[</span><span class="m">1</span><span class="p">,],</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="nf">lines</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span><span class="w"> </span><span class="n">hpd.log</span><span class="p">[</span><span class="m">2</span><span class="p">,],</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="ow">in</span> <span class="n">xy</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="nb">object</span> <span class="s1">&#39;m.log&#39;</span> <span class="ow">not</span> <span class="n">found</span>
<span class="ne">Traceback</span>:

<span class="mi">1</span><span class="o">.</span> <span class="n">lines</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lwd</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="mi">2</span><span class="o">.</span> <span class="n">lines</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">log</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lwd</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="mi">3</span><span class="o">.</span> <span class="n">plot</span><span class="o">.</span><span class="n">xy</span><span class="p">(</span><span class="n">xy</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="nb">type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="mi">4</span><span class="o">.</span> <span class="n">xy</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/5dfba90c11e5a7038765225eae2b18fdff81028766c746d1b657038d8914d0a4.png"><img alt="../_images/5dfba90c11e5a7038765225eae2b18fdff81028766c746d1b657038d8914d0a4.png" src="../_images/5dfba90c11e5a7038765225eae2b18fdff81028766c746d1b657038d8914d0a4.png" style="width: 300px; height: 360px;" /></a>
</div>
</div>
<p>Note that this only shows the uncertainty in the * mean function * – the assumed model with log normal noise says that the observations simply have this mean. The fit is attributing the majority of the observed noise to process error rather than parameter uncertainty.</p>
</section>
</section>
<section id="readings-and-resources">
<h2>Readings and Resources <a id='Readings'></a><a class="headerlink" href="#readings-and-resources" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Bolker, B. Ecological models and data in R. (Princeton University Press, 2008).</p></li>
<li><p><a class="reference external" href="https://cran.r-project.org/web/packages/bayestestR/vignettes/bayestestR.html">https://cran.r-project.org/web/packages/bayestestR/vignettes/bayestestR.html</a></p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            name: "ir",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-likelihoods-exercise">A Likelihoods exercise</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-binomial-distribution">The Binomial Distribution</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#simulating-from-the-binomial-using-r">Simulating from the Binomial using R</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#method-of-moments-mom-estimators">Method of Moments (MoM) Estimators</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mle-for-binomial-distribution">MLE for Binomial Distribution</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#likelihood-and-log-likelihood">Likelihood and Log Likelihood</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-the-likelihood-and-mle-in-r">Computing the likelihood and MLE in R</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-midge-wing-length">Example: Midge Wing Length</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non-bayesian-analysis">Non-Bayesian analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-the-bayesian-model">Setting up the Bayesian Model</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#prior-information">Prior Information</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analytic-posterior">Analytic Posterior</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-prior-sensitivity">Exercise: Prior sensitivity</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#numerical-evaluation-of-the-posterior-with-jags">Numerical evaluation of the posterior with JAGS</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-the-model">Specifying the model</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-the-population-variance">Estimating the population variance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-updating-the-bayesian-model">Exercise: Updating the Bayesian model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aedes-data-revisited-using-bayesian-fitting">Aedes data revisited using Bayesian fitting</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-data">The Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#two-thermal-performance-curve-models">Two thermal performance curve models</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-thermal-response-model-file">The thermal response model file</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-diagnostics">Running diagnostics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-fits">Plot the fits</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-analyses">Additional analyses</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-of-abundance-data">Fitting of abundance data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">The Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-the-growth-curve">Specifying the growth curve</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">The thermal response model file</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-settings-for-jags">Additional settings for jags</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-the-model">Fitting the model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#diagnostics">Diagnostics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-joint-posterior-of-parameters">Visualizing the joint posterior of parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-posterior-distribution-of-the-mean-function">The posterior distribution of the mean function</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#readings-and-resources">Readings and Resources <a id="Readings"></a></a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By MulQuaBio collective!
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>